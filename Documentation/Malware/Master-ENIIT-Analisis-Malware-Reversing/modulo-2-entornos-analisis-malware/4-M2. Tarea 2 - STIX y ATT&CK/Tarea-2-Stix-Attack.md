
![Portada](capturas/portada-tarea2-modulo2-.jpg)


--------------------------------------

# Análisis del artículo

## 1. Fuente y metadatos del reporte
- Fuente primaria: Google Threat Analysis Group (TAG), post “Internet Explorer 0-day exploited by North Korean actor APT37”.
- Fecha de publicación del post: 07-dic-2022. 
- Autores: Clément Lecigne y Benoît Sevens (TAG). 


<mark>En STIX esto se modela típicamente como un objeto `report` con:</mark> 
- name: "Internet Explorer 0-day exploited by North Korean actor APT37".
- published: "2022-12-07T00:00:00Z".
- Agrupará todos los SDOs (Standard Data Objects) generados, incluyendo referencias externas al post original


## 2. Descripción del artículo - Ámbito (scope)
TAG documenta una campaña de explotación 0-day:
- Vulnerabilidad 0-day en Internet Explorer (motor JScript), usada in-the-wild.
- Entrega mediante documentos maliciosos de Microsoft Office (cadena Office → plantilla remota → HTML → IE).
- Objetivo principal: usuarios en Corea del Sur.
  

## 3. Atribución
- TAG atribuye la actividad al grupo norcoreano APT37, actor respaldado por el Estado. 
- Además, indica que no es la primera vez que APT37 usa 0-days de Internet Explorer y que, históricamente, se enfoca en:
    - Usuarios surcoreanos.
    - Desertores norcoreanos.
    - Responsables de políticas públicas (policy makers).
    - Periodistas.
    - Activistas de derechos humanos.

<mark>En STIX esto se modela típicamente como:</mark>
- Un `intrusion-set` para APT37.
- Un objeto `identity  para representar a las víctimas.


## 4. Cronología de interés
TAG da tres fechas claras, útiles para `first_seen/last_seen` o narrativa:
- 31-oct-2022: TAG recibe/observa el/los documentos, subidas a VirusTotal por múltiples submitters en Corea del Sur y reporta el 0-day a Microsoft. 
- 03-nov-2022: asignación del `CVE-2022-41128`. 
- 08-nov-2022: parche publicado por Microsoft. 

<mark>Para STIX, estas fechas se reflejan normalmente como:</mark>
- Campos `first_seen` y `last_seen` en el objeto `intrusion-set`
- Campo `published` en el objeto `vulnerability`.


## 5. Cadena de ataque - Kill chain
### 5.1. Señuelo (lure) y documento inicial
- El 31-oct-2022 se sube a VirusTotal un documento Office titulado: “221031 Seoul Yongsan Itaewon accident response situation (06:00).docx”
- El señuelo referencia el incidente de Itaewon (Seúl) del 29-oct-2022 y aprovecha el interés público. 

<mark>En STIX esto se modela típicamente como:</mark>
- El documento puede modelarse como `indicator`, basado en el hash SHA-256 publicado por TAG (patrón file:hashes.'SHA-256' = '...').


### 5.2 Requisito de interacción del usuario (Protected View)
- En un escenario típico, el documento tiene Mark-of-the-Web (MOTW).
- Eso implica que el usuario debe desactivar Protected View para que se obtenga la plantilla remota. 

<mark>En STIX esto se modela típicamente como:</mark>
- No es un IOC como tal pero se refleja en la narrativa del `report` (o en `notes`) como que existe una dependencia de interacción del usuario.




### 5.3 Template remota (RTF) → HTML remoto
- El documento descarga una plantilla remota RTF (remote template).
- Esa plantilla remota a su vez obtiene contenido HTML remoto. 
- Office renderiza ese HTML usando Internet Explorer, y esta técnica se usa para distribuir exploits IE vía Office.

<mark>En STIX:</mark>
- La plantilla remota puede modelarse como `indicator` (por hash) y/o como `filep  dentro de `observed-data`.
- El “hosting” del contenido remoto (RTF/HTML) puede representarse como `infrastructure`.


<mark>Como TTP (ATT&CK):</mark> Esto encaja muy bien con `Template Injection (T1221)`.






### 5.4 Ejecución del exploit: IE JScript (jscript9.dll)
- El 0-day está en **jscript9.dll** (motor JavaScript de IE).
- Permite ejecución de código al renderizar una web controlada por el atacante.
- Naturaleza del bug: incorrecta optimización JIT → type confusion, similar a CVE-2021-34480.


<mark>En STIX:</mark>
- Se modela con un objeto vulnerability para CVE-2022-41128.


<mark>Como TTP (ATT&CK):</mark> La técnica más adecuada es `Exploitation for Client Execution (T1203)`: Explotación de una vulnerabilidad en una aplicación cliente para ejecutar código.


### 5.5 Control de entrega: cookie “anti-análisis” y telemetría al C2
- Al servir la RTF remota, el servidor pone una cookie única.
- Esa cookie se reenvía cuando se solicita el HTML remoto; probablemente para detectar “fetches” directos del exploit (análisis). 
- El JavaScript del exploit:
    - Verifica que la cookie esté presente antes de explotar, y
    - reporta al C2 dos veces: antes de lanzar y después de éxito. 

<mark>En STIX:</mark>
- Modela la infraestructura como `infrastructure`, por ejemplo, “C2/hosting asociado a la cadena RTF→HTML”.
- Relación: `intrusion-set` uses `infrastructure`.
- Los dominios publicados se modelan como `indicator` (con patrón domain-name:value = '...') y se relacionan como:
    - `indicator` indicates `infrastructure`.


### 5.6 Post-explotación inmediata: shellcode, evasión y siguiente etapa
- El shellcode usa un hashing custom para resolver Windows APIs. 
- Borra rastros limpiando caché e historial de Internet Explorer antes de bajar la siguiente etapa. 
- La siguiente etapa se descarga usando la misma cookie.

<mark>En STIX:</mark>
- Si no hay un payload identificable (hash/nombre), estos elementos se reflejan principalmente en:
    - `report.description`, o un objeto `note`, como comportamiento post-explotación.

<mark>Para TTP ATT&CK:</mark>
- La limpieza de caché/historial encaja con Indicator Removal on Host (T1070) (defense evasion).
- El hashing de APIs se puede considerar como ofuscación/resolución dinámica.


### 5.7 Payload final y malware asociado
- TAG indica que no recuperó el payload final de esa campaña.
- Pero atribuye al mismo actor el uso previo de implantes:
    - ROKRAT
    - BLUELIGHT
    - DOLPHIN
- Añade que APT37 suele abusar de servicios cloud legítimos como canal C2, con capacidades típicas de backdoor.

<mark>En STIX:</mark>
- Para simplificar, no vamos a crear `malware` para ROKRAT/BLUELIGHT/DOLPHIN como parte de esta intrusión.
- Los mencionaremos únicamente en `report.description` como “históricamente asociado”.



| Etapa Técnica | Hallazgo en el Informe | Objeto STIX | Técnica ATT&CK |
| -- | -- | -- | -- |
| Acceso Inicial | Documento Word sobre el accidente en Itaewon. | indicator (File Hash) | Phishing: Spearphishing Attachment (T1566.001) |
| Evasión | Inyección de plantilla remota (RTF) para evadir análisis estático. | indicator (URL/Domain) | Template Injection (T1221) |
| Explotación | Vulnerabilidad JIT en jscript9.dll (CVE-2022-41128). | vulnerability | Exploitation for Client Execution (T1203) |
| Persistencia | "Descarga de payloads adicionales (implantes previos: RokRAT, Dolphin)." | malware | N/A (Payload no recuperado en esta campaña) |
| Defensa | Limpieza de caché e historial de IE antes de la siguiente fase. | attack-pattern | Indicator Removal on Host (T1070) |




## 6. Inventario de IOCs publicados (datos “duros”)
### 6.1 Hashes de “Initial documents” (SHA-256)
- 56ca24b57c4559f834c190d50b0fe89dd4a4040a078ca1f267d0bbc7849e9ed7
- af5fb99d3ff18bc625fb63f792ed7cd955171ab509c2f8e7c7ee44515e09cebf
- 926a947ea2b59d3e9a5a6875b4de2bd071b15260370f4da5e2a60ece3517a32f
- 3bff571823421c013e79cc10793f238f4252f7d7ac91f9ef41435af0a8c09a39
- c49b4d370ad0dcd1e28ee8f525ac8e3c12a34cfcf62ebb733ec74cca59b29f82
  
<mark>En STIX:</mark> Vemos a modelar 1 `indicator` por hash:
- [file:hashes.'SHA-256' = '56ca24b57c4559f834c190d50b0fe89dd4a4040a078ca1f267d0bbc7849e9ed7']
- [file:hashes.'SHA-256' = 'af5fb99d3ff18bc625fb63f792ed7cd955171ab509c2f8e7c7ee44515e09cebf']
- [file:hashes.'SHA-256' = '926a947ea2b59d3e9a5a6875b4de2bd071b15260370f4da5e2a60ece3517a32f']
- [file:hashes.'SHA-256' = '3bff571823421c013e79cc10793f238f4252f7d7ac91f9ef41435af0a8c09a39']
- [file:hashes.'SHA-256' = 'c49b4d370ad0dcd1e28ee8f525ac8e3c12a34cfcf62ebb733ec74cca59b29f82']
- name: Initial documents SHA-256
- description: texto tipo Hash de la plantilla initial documents.
- labels: ["file-hash", "rtf", "initial-documents"]


### 6.2. Hash de la “Remote RTF template” (SHA-256)
- TAG publica 1 hash: 08f93351d0d3905bee5b0c2b9215d448abb0d3cf49c0f8b666c46df4fcc007cb

<mark>En STIX:</mark>
- “remote template RTF” en `description` del `indicador`.
- [file:hashes.'SHA-256' = '08f93351d0d3905bee5b0c2b9215d448abb0d3cf49c0f8b666c46df4fcc007cb']
- name: Remote RTF template SHA-256
- description: texto tipo Hash de la plantilla remota RTF usada en la cadena de infección
- labels: ["file-hash", "rtf", "remote-template"]

### 6.3. Dominios C2
TAG publica 5 dominios que están ofuscados con [.]:
- word-template[.]net
- openxmlformat[.]org
- ms-office[.]services
- ms-offices[.]com
- template-openxml[.]com
  
<mark>En STIX:</mark>
- [domain-name:value = 'word-template.net']
- [domain-name:value = 'openxmlformat.org']
- [domain-name:value = 'ms-office.services']
- [domain-name:value = 'ms-offices.com']
- [domain-name:value = 'template-openxml.com']

Nota: en STIX los dominios deben ir desofuscados.


## 7. Elementos “técnicos” adicionales del RCA
El RCA de Project Zero/TAG añade información técnica relevante:
- Clase de vulnerabilidad: optimización incorrecta del JIT que deriva en type confusion.
- Explicación del supuesto de tipos y cómo el exploit lo rompe, cambio de tipo durante la ejecución bajo supuestos del JIT.
- Estrategia de explotación: construcción de primitivas de lectura/escritura (R/W), fugas para sortear ASLR, manipulación de estructuras (p. ej., vtables) y uso de APIs como VirtualProtect para habilitar ejecución de shellcode.
- Detalle operacional: la explotación observada se realiza mediante un documento de Office que carga HTML remoto con JavaScript, reiterando que normalmente requiere que el usuario desactive Protected View para permitir la descarga/ejecución del contenido remoto.

<mark>En STIX:</mark>
- Esta información sirve para enriquecer la `vulnerability.description`.
- También justifica modelar un `attack-pattern` asociado a `Exploitation for Client Execution (T1203)`, ya que describe explotación de una aplicación cliente para ejecutar código.


## 8. Lista de entidades para transformar a STIX
### 8.1. Entidades principales (core)
- Intrusion Set: APT37 (North Korean government-backed). 
- Vulnerability: CVE-2022-41128 (IE JScript / jscript9.dll; JIT type confusion; RCE). 
- Targeting: usuarios en Corea del Sur; lure sobre Itaewon. 


### 8.2. Artefactos/IOCs
- 5 SHA-256 de documentos iniciales. 
- 1 SHA-256 de plantilla remota RTF. 
- 5 dominios C2. 


### 8.3. Infraestructura y flujo
- Infraestructura web que sirve RTF/HTML y setea cookie única. 
- C2 con doble beacon (pre y post exploit). 


### 8.4. TTPs (para enlazar luego con ATT&CK si haces el extra)
- Template Injection (T1221). 
- Exploitation for Client Execution (T1203). 
- Spearphishing Attachment (T1566.001) como técnica plausible de entrega del doc (si decides incluirla como hipótesis razonable, dejando claro que el canal no está explicitado). 
- Indicator Removal on Host (T1070) por limpieza de caché/historial (defense evasion). 