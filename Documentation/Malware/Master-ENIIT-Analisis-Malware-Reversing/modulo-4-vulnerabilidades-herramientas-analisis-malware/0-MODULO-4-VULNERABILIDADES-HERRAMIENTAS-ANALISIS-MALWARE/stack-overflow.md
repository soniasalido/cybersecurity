# Desbordamientos de B√∫fer

En la explotaci√≥n binaria, nuestro objetivo principal es subvertir la ejecuci√≥n del binario de una manera que nos beneficie. Los desbordamientos de b√∫fer son el tipo m√°s com√∫n de explotaci√≥n binaria, pero existen otros tipos, como la explotaci√≥n de cadenas de formato (Format String) y la explotaci√≥n del Heap.

Un desbordamiento de b√∫fer ocurre cuando un programa recibe datos m√°s largos de lo esperado, de modo que esos datos sobrescriben todo el espacio de memoria del b√∫fer en la pila. Esto puede sobrescribir el siguiente puntero de instrucci√≥n (EIP/RIP), lo que hace que el programa falle porque intentar√° ejecutar instrucciones en una direcci√≥n de memoria inv√°lida. Forzar al programa a fallar es el ejemplo m√°s b√°sico de explotaci√≥n de desbordamientos de b√∫fer, conocido como un ataque de Denegaci√≥n de Servicio (DoS).

Otro ataque b√°sico consiste en sobrescribir un valor en la pila para cambiar el comportamiento del programa. Por ejemplo, si un programa de ex√°menes tuviera una vulnerabilidad de desbordamiento de b√∫fer, podr√≠amos sobrescribir el b√∫fer lo suficiente para sobrescribir nuestra puntuaci√≥n. Dado que la puntuaci√≥n est√° almacenada en la pila en este ejemplo, podr√≠amos aprovechar esta falla para cambiarla.

Si somos un poco m√°s sofisticados, podemos cambiar la direcci√≥n del EIP hacia una instrucci√≥n que ejecute nuestro shellcode. Esto permitir√≠a ejecutar cualquier comando que queramos, en lugar de solo hacer que el programa falle; esto se conoce como saltar al shellcode.

Con protecciones de memoria m√°s avanzadas, puede que no sea posible cargar nuestro shellcode completo y apuntar a √©l. En ese caso, podemos usar una combinaci√≥n de instrucciones del propio binario para ejecutar una funci√≥n concreta y sobrescribir varios punteros para cambiar el flujo de ejecuci√≥n del programa. Esto se conoce como un ataque Return Oriented Programming (ROP).

Finalmente, los programas y sistemas operativos modernos pueden usar el Heap en lugar de la pila para almacenar memoria de b√∫fer, lo que requerir√≠a desbordamientos o explotaci√≥n del Heap.

# Desbordamiento de la Pila (Stack Overflow)

Comencemos demostrando c√≥mo funciona la pila al almacenar datos. La pila tiene un dise√±o `LIFO (Last-In, First-Out)`, lo que significa que solo podemos extraer (pop) el √∫ltimo elemento insertado (push). Si insertamos un elemento, quedar√° en la parte superior de la pila. Si extraemos algo, ser√° ese elemento superior el que se retire.

La siguiente tabla muestra como funciona el stack:
![table-stack](capturas/table-stack.png)

xxx
![stack-overflow](capturas/stack-overflow.png)


Lo que ocurre cuando escribimos M√ÅS all√° del b√∫fer (desbordamiento):
```css
            B√∫fer v√°lido
            ‚ñº
0xabcdef   [ 01 | 23 | 45 | 67 ]
           [ 89 | 01 | 23 | 45 ]  ‚Üê comienzo del desbordamiento
           -----------------------
0x401000   [ 67 | 89 | 01 | 23 ]  ‚Üê üî• EIP sobrescrito
           -----------------------
0x12345678 [ 45 | 67 | 89 | 01 ]  ‚Üê ‚ö†Ô∏è EBP sobrescrito
``` 
