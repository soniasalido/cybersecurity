
# Ghidrathon
Ghidrathon es un plugin/extensión para Ghidra que sirve para poder usar Python 3 dentro de Ghidra. Ghidra trae de serie scripts en Java y en Python 2 (Jython). Hoy en día casi todas las librerías y herramientas de seguridad están en Python 3, y eso complicaba integrarlas con Ghidra. Ghidrathon usa Jep (Java Embedded Phyton) como "puente" entre Java (Ghidra) y phython3.

[Ghidrathon](https://github.com/mandiant/Ghidrathon), creado por el equipo FLARE de Mandiant, añade a Ghidra:
- Intérprete interactivo de Python 3 dentro de la ventana de Ghidra. 
- Posibilidad de escribir y ejecutar scripts de Ghidra en Python 3 desde el Script Manager.
- Soporte para usar librerías externas (capstone, unicorn, angr, **capa**, etc.) como si fuera un entorno Python normal. 

## Requerimientos
Es preciso la instalación previa de:
- Python3.
- Ghidra.
- Java.

## Instalacion de Ghidrathon

### Creación de un entorno Python3:
```
cd RUTA_Ghidra
python3 -m venv ghidra-py
source ghidra-py/bin/activate
pip install --upgrade pip
```




### Instalammos Ghidrathon
Descargamos Ghidrathon en nuestro Ghidra environment: https://github.com/mandiant/Ghidrathon/releases
Descomprimimos y ejecutamos:
```
cd RUTA_Ghidra
(seguimos en el entorno virtual de python)
pip install -r RUTA_Ghidrathon/requirements.txt
python RUTA_Ghidrathon/ghidrathon_configure.py RUTA_Ghidra
```

### Establecer las variables de entorno de Java:
Las variables típicas de Java son:
- JAVA_HOME → ubicación del JDK/JRE
- PATH → agregar el bin del JDK

Si no están establecidas, es preciso hacerlo:
```c
nano ~/.bashrc
```

Agrega al final:
```c
# Variables de entorno de Java
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH
```

### ????:
ghidrathon_configure.py by default attempts to write a file named ghidrathon.save to <absolute_path_to_ghidra_install_dir>.



### Instalar capa en el mismo Python que usa Ghidrathon
```
source ~/ghidra-py/venv/bin/activate
pip install --upgrade flare-capa
deactivate
```

### Comprobamos la version de capa instalado:
```
python -c "import importlib.util, pkgutil, sys; import capa; print('version:', getattr(capa,'__version__', 'unknown')); print('capa.main ->', importlib.util.find_spec('capa.main'))"
RUTA_Ghidra/ghidra-py/bin/capa --version
```

### Descargamos las reglas de capa
```
git clone https://github.com/mandiant/capa-rules.git ~/capa-rules
```


### Editar el script o introducir rutas al ejecutarlo
Al ejecutar capa_explorer.py o capa_ghidra.py Si es la primera vez, debe pedirnos el path a capa y rules dir. Si no lo hacen, puedes abrir el script y buscar las variables tipo:
```
capa_path = "/ruta/a/capa"
rules_dir = "/ruta/a/capa-rules"
```

### Vemos su funcionamiento
Una vez instalado, ejecutamos el script. Aparece el informe que genera la herramienta capa. Podemos acceder a las partes que detecta este informe, haciendo doble click en ellas.
![Plugin capa para Ghidra]([capturas/plugin-capa-ghidra.png](https://github.com/soniasalido/cybersecurity/blob/main/Documentation/Malware/Learning%20Malware%20Annalysis/capturas/plugin-capa-ghidra.png))

-------------------------------------------------
## Instalacion de plugin CAPA para Ghidra
El ZIP del plugin capa explorer no viene con Ghidra, tenemos que descargarlo del repositorio oficial de capa en GitHub.

Descargamos capa_explorer.py y capa_ghidra.py: https://github.com/mandiant/capa/tree/master/capa/ghidra

En la ventana de script manager de ghidra, creamos una nueva carpeta de plugins. Una vez creada pegamos esos ficheros en esa nueva carpeta.


Ejecutamos Ghidra
