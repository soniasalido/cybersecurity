
# La infraestructura
- Esquema de la Red:
    ![Esquema de la red](capturas/esquema-de-la-red.png)

- El Nuevo Equipo:
    - Se conecta a un Switch Ethernet OT a través de un puerto Fast Ethernet de 100Mbps.
    - Tiene SO propietario.
    - Sólo ofrece panel web de configuración.
    - No permite ejecutar comandos.
- El Switch Ethernet OT:
    - Tiene un enlace uplink de 10 Gbps con un Router OT-IT que le permite conectarse a la red IT de la organización.
    - No soporta port mirroring.
- Equipos de la red industrial:
    - Obtienen su dirección IPv4 y la configuración de red de un Servidor DHCP que está conectado al Router OT-IT.
    - Algunos equipos de la red industrial requieren que el servidor DHCP les proporcione parámetros de arranque.
    - Algunos equipos de la red industrial acceden a Internet.
- El Router OT-IT:
    - Interconecta las redes IT y OT.
    - Permite que los equipos industriales se comuniquen con un servidor DNS y un Proxy Web con conexión a Internet.
    - La infraestructura IT (incluyendo el router de interconexión) dispone de capacidades de port mirroring. Esto es es vital para capturar el tráfico que sale hacia la red IT o Internet.
- El Proxy Web:
    - Debe ser configurado en cada cliente.
    - El cliente debe disponer de un usuario y contraseña.
    - El proxy web es la única forma de salir a Internet desde dentro de la organización.
    - Almacena en un logs las URls a las que se conecta cada cliente
    - No almacena en el log el contenido (payload) de los mensajes HTTP que se intercambian.


# Se pide
- I. Analizar “todos y cada uno” de los mecanismos/técnicas del Capítulo 3.
    - Explicar cómo se podrían usar.
    - Explicar si son recomendables o no, para este caso.
    - Analizar los protocolos que emplea el nuevo equipo en sus comunicaciones internas y hacia Internet (incluyendo lo que se pueda inferir del uso del proxy HTTP y del servidor DHCP).
    - Analizar la información que se intercambia con el fabricante.


- II. Proponer un mecanismo de captura de tráfico que cumpla:
    - Configuración necesaria en la estación de captura.
    - Despliegue en la estación de captura.
    - Capturar todo el tráfico que envío o recibe el Equipo nuevo con otros equipos de la red.
    - Capturar todo el tráfico que envío o recibe el Equipo nuevo con Internet.
    - Tener impacto mínimo en OT.
    - No comprometer la fiabilidad. 
    - Quedar desplegado en la ventana corta de mantenimiento y no requerir cambios posteriores, incluso si hay incidencias con la captura.
    - Se puede contar con la colaboración de los administradors de red IT siempre que no se comprometa la fiabilidad de OT, porque abre la puerta a soluciones basadas en port mirroring en el router, TAPs, etc.


# Detalles a tener en cuenta
- Tráfico Local vs. Tráfico a Internet: El enunciado pide capturar todo el tráfico. El tráfico entre equipos de la red industrial (OT) que están conectados al mismo Switch no suele pasar por el Router. Como el Switch no tiene mirroring, tendremos que proponer algo específico para "ver" lo que pasa dentro del switch.

- Impacto y Fiabilidad: Este es el requisito más estricto. El mecanismo no puede interrumpir la red OT si falla una vez en producción. Esto nos obligará a elegir entre técnicas "activas" (como ARP Spoofing o DHCP Spoofing) o "pasivas" (como un Network TAP).


- El Servidor DHCP: El hecho de que el servidor DHCP permita "configuración personalizada" y "parámetros de arranque" es una pista para una posible técnica de captura basada en la reconfiguración de la red (por ejemplo, cambiar la puerta de enlace predeterminada o el servidor DNS mediante DHCP).


- La Propuesta Final: Hay que detallar la estación de captura (qué software usariamos, por ejemplo, Wireshark o tcpdump) y cómo se conectaría físicamente a la red según nuestra propuesta.


- Tráfico Local: Como el switch no colabora, tendremos que analizar técnicas como el uso de un Network TAP (pasivo y fiable) o técnicas de redirección de tráfico (activas como ARP Spoofing), evaluando cuál tiene menos impacto en la fiabilidad de OT.

- Uso del DHCP: Hemos detectado la "pista" del servidor DHCP. En redes industriales, manipular las opciones de DHCP puede permitir redirigir el tráfico del equipo hacia una estación de captura (haciendo que pase por ella antes de ir al router), pero debemoss analizar si esto compromete la fiabilidad.



# I. Análisis de las técnicas de captura de Tráfico de Red
Para cada una de las técnicas y herramientas del capítulo 3, vamos a ir respondiendo a las siguientes preguntas:
- Cómo se podría usar esa técnica | herramienta en este caso. Explicar la configuración y su despligue.
- Protocolos que podriamos ver usando esa técnica | herramienta.
- Información intercambiada con el fabricante.
- ¿Esta técnica | herramienta tiene un impacto mínimo en OT?
- ¿Esta técnica | herramienta compromete la fiabilidad?
- Conclusión: ¿Es recomendable esta técnica | herramienta en el ambito de este ejercicio?


## 1. Estrategias de Captura de Tráfico de Red


### 1.1 En el propio equipo

**Cómo se podría usar. Configuración y Despligue:**  
Consistiría en instalar en el `Nuevo equipo` un sniffer como `tcpdump` o `Wireshark`, y capturar el tráfico en todos sus interfaces, incluido `loopback`, para ver todo el tráfico que genera y recibe. Permitiría además combinar la captura con herramientas tipo `netstat` o `strace` para mapear sockets, puertos y llamadas a sistema, enriqueciendo mucho el análisis de protocolos e información que se envía al fabricante.
​


**Protocolos que podriamos ver:**
- Todo el tráfico IP del equipo:
    - Loopback IP y tráfico normal de LAN. 
    - DHCP para la obtención de IPv4 y parámetros de arranque.
    - Tráfico no-IP como ARP. 
    - DNS ya que el router permite comunicación con el servidor DNS. 
    - HTTP hacia el proxy.
​
- Podriamos analizar cabeceras y, si no hay cifrado, también el payload:
    - URLs completas.
    - Parámetros de actualización.
    - Contenido de informes de estado.
    - Identificadores de dispositivo, etc.
​
- Protocolos Industriales: Protocolos industriales del fabricante para la comunicación con otros equipos de la red OT.


**Información intercambiada con el fabricante:**
- Se podría identificar con precisión qué datos manda el equipo: versión de firmware, configuración, métricas de uso, logs, posibles datos sensibles y también cómo recibe datos, como ficheros de actualización, comandos de control, políticas.
​
​
- Al estar en el propio host no se pierde tráfico local, aunque ciertas optimizaciones de la `NIC` (`LSO`/`LRO`, `checksum offload`) pueden distorsionar tamaños y checksums en la captura, algo mitigable ajustando la configuración de `offloading`.

​

**Impacto en la OT:**
- Tiene un impacto alto en la OT, porque la ejecución de un proceso de captura consume recursos críticos de CPU y de memoria RAM, afectando el rendimiento del equipo monitorizado.


**Fiabilidad en la OT:**
- Compromete la fiabilidad: en un sistema propietario, cualquier proceso adicional no validado por el fabricante puede provocar bloqueos y no sería fácil de mantener si falla tras la ventana de mantenimiento


- Además, los efectos de `offloading` y `segmentación` pueden generar `ruido` en la captura como checksums incorrectos o paquetes demasiado grandes, y complicar la interpretación del tráfico.



**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  
Aunque la técnica es muy potente, en este escenario hay dos inconvenientes claros:
- Falta de acceso al equipo. No podemos instalar ni lanzar herramientas de captura.
- Requisitos estrictos de fiabilidad en la red OT.

**<mark>Por tanto, para nuestro ejercicio es teóricamente la mejor para visibilidad, pero no aplicable ni recomendable. Se deberían implementar estrategias externas como TAP, port mirroring en el router IT, etc. para cumplir los requisitos. Solo podría ser viable si el panel web ofreciese alguna funcionalidad de exportar logs o ficheros PCAP generados por el propio fabricante.</mark>**


----


### 1.2 Nivel físico o de Enlace

#### 1.2.1 Network TAP - Sonda de Red - Pasivo
Un TAP - Test Access Point - de red es un dispositivo hardware que se inserta directamente en un enlace de red para duplicar el tráfico que circula por él hacia una estación de monitorización sin alterar el flujo original.

![Sonda-Tap](capturas/sonda-tap.png)


**Cómo se podría usar. Configuración y despliegue:**  
- Se instalaría la sonda física, network TAP, entre el `Nuevo equipo` y el `Switch OT`, intercalándola en el enlace `Fast Ethernet 100 Mbps` para replicar todas las tramas entre ambos extremos hacia una o dos interfaces de la estación de captura.

- Switch OT ↔ TAP ↔ Nuevo equipo.
    - Switch → puerto A del TAP
    - Nuevo equipo → puerto B del TAP
​
- Estación de captura → puerto C (tráfico de A→B) y puerto D (tráfico de B→A).
    - La estación de captura se conectaría a los puertos de monitorización del TAP con sus interfaces en `modo promiscuo`, sin IP configurada, y con un sniffer como `tcpdump` o `Wireshark` grabando el tráfico. No se envía ningún paquete desde esos interfaces, sólo se recibe.
​

**Protocolos que podríamos ver:**  
- Todo el tráfico Ethernet del Equipo nuevo: tramas ARP, DHCP, DNS, tráfico IP interno con otros equipos OT y tráfico IP hacia el router OT‑IT, incluyendo HTTP/HTTPS hacia el proxy web.
​
- Al trabajar a nivel físico/enlace, se obtiene una copia íntegra de todas las tramas que salen y entran por ese enlace, independientemente de VLANs o protocolos de nivel superior, siempre que el TAP soporte la velocidad y el medio que en este caso es: cobre a 100 Mbps.


**Información intercambiada con el fabricante:**  

- Se podrían identificar todas las conexiones del equipo con servidores externos: dominios/IPs de fabricante, puertos utilizados y patrones de comunicación.

- Si las sesiones no están cifradas, se puede inspeccionar el payload para ver parámetros de actualización, informes de estado, identificadores de dispositivo y otra telemetría; si están cifradas, al menos se obtienen metadatos, como SNI, certificados, tamaños y frecuencia de mensajes.
​

**¿Tiene un impacto mínimo en OT?:**  
- Una sonda/TAP pasivo bien dimensionada tiene un impacto muy bajo, ya que actúa como un cable inteligente que sólo copia el tráfico sin introducir retardo apreciable ni modificar las tramas.
​
- Al colocarse en un enlace de 100 Mbps y diseñarse específicamente para esa velocidad, no debería introducir cuellos de botella siempre que sea hardware adecuado y se instale durante la ventana de mantenimiento.
​

**¿Compromete la fiabilidad?:**  
- Las sondas pasivas se consideran muy fiables: si son realmente pasivas o tienen bypass físico, el enlace entre el equipo y el switch sigue funcionando incluso si la sonda pierde alimentación o la estación de captura se cae.
​
- El principal riesgo es físico, como un mal conector o una instalación defectuosa, pero una vez desplegada correctamente es una solución estable que no requiere cambios posteriores en la red OT.

**Conclusión: ¿Es recomendable en el ámbito de este ejercicio?:**
- Sí, es una de las técnicas más recomendables para este caso, porque permite capturar todo el tráfico del nuevo equipo con impacto mínimo y sin tocar su configuración ni la del switch OT, que además no soporta port mirroring.
​
- Cumple bien los requisitos del cliente (cobertura completa del tráfico del equipo, mínimo impacto, alta fiabilidad y posibilidad de dejarlo desplegado tras la ventana de mantenimiento), aunque exige disponer de un TAP físico adecuado y acceso físico al cableado entre el equipo y el switch.

---

#### 1.2.2 Network TAP - Sonda de Red - Activo
Una sonda/TAP activo es un dispositivo físico que se inserta en línea entre el nuevo equipo y el switch para copiar el tráfico hacia una estación de captura. En enlaces de cobre de 1 Gbps o superiores se suele requerir este tipo de sonda frente a una pasiva; algunos modelos permiten agregar ambos sentidos en un único puerto de monitorización de mayor capacidad, a costa de necesitar alimentación, aunque suelen incluir un bypass físico A–B si se pierde la alimentación.


**Cómo se podría usar. Configuración y despliegue:**  
- Misma configuración que en el TAP pasivo.

- Diferencia práctica frente al activo
    - En el activo, C y D pueden ser opcionales, a veces hay un solo puerto agregado.
    - En el pasivo, normalmente tiene dos salidas independientes, una por sentido, y no hay agregación ni funciones extra: sólo copias de la señal.



**Protocolos que podríamos ver:**  
Se observaría exactamente el mismo tráfico que con un TAP pasivo en ese enlace.


**Información intercambiada con el fabricante:**  
Permitiría identificar las conexiones del equipo con servidores externos (direcciones, puertos, frecuencia) y, si el tráfico no está cifrado, inspeccionar el contenido de las peticiones y respuestas para ver parámetros de actualización, informes de estado, identificadores de dispositivo y otros datos que se envían al fabricante.


**Impacto y fiabilidad en OT:**
- Es fundamental que el TAP activo disponga de bypass físico entre los puertos A y B para cuando pierda la alimentación, de modo que el enlace equipo–switch siga funcionando aunque el TAP o la estación de captura fallen. Con este bypass el impacto sobre la fiabilidad es muy bajo.
​

- A diferencia del TAP pasivo, introduce una latencia mínima al regenerar la señal y añade una dependencia de la alimentación y del propio hardware, lo que implica algo más de complejidad operativa y de supervisión, aunque en la práctica la latencia suele ser despreciable en un enlace de 100 Mbps bien dimensionado.



**Conclusión: ¿Es recomendable en el ámbito de este ejercicio?:**
- Para el enlace de 100 Mbps entre el nuevo equipo y el switch, un TAP pasivo ya sería suficiente y ofrece el menor riesgo posible (no requiere alimentación y puede introducir todavía menos puntos de fallo), por lo que suele considerarse preferible.
​

- Sin embargo, un TAP activo con bypass también cumpliría los requisitos del ejercicio, por lo que se puede usar como alternativa. Aunque se reserva en general los TAP activos como opción necesaria en enlaces de 1 Gbps o superiores.


---

#### 1.2.3 Port mirroring (SPAN/RSPAN/ERSPAN)

Esta técnica consiste en configurar un switch o router para que envíe una copia de los paquetes vistos en uno o varios puertos (puertos origen) hacia un puerto específico (puerto destino o monitor) donde se conecta la estación de captura.

**Cómo se podría usar. Configuración y despliegue:**  
- Esta técnico no podemos usarla en el Switch OT porque el enunciado dice que no tiene port mirroring.
- Sí podría aplicarse en la infraestructura IT, incluido el router de interconexión, que sí tiene esta capacidad.
- Despliegue: Se solicitaría al administrador de red que configurase en el router OT‑IT una sesión de port mirroring (SPAN) que copie todo el tráfico de la interfaz conectada al uplink del switch OT hacia un puerto monitor, donde se conectaría la estación de captura, o bien lo envíe a otro switch/host remoto mediante RSPAN/ERSPAN, por ejemplo encapsulando el tráfico copiado en un túnel GRE.
- Configuración: La estación de captura se conectaría físicamente a ese puerto monitor para recibir la copia del tráfico
- Las interfaces de red que capturen el tráfico deben estar en modo promiscuo, ya que la mayoría de las tramas, salvo broadcast/multicast, no estarán destinadas a su dirección MAC.
- No se debe configurar una dirección IP en dichas interfaces, de forma que la estación de captura no pueda enviar tráfico a través de ellas.
- Se debe desactivar el reenvío de paquetes IP para evitar que la estación de captura actúe como router.
- No es recomendable utilizar un hub Ethernet para capturar tráfico, porque degrada significativamente el rendimiento de la red.


**Protocolos que podríamos ver:**  
- Protocolos de Internet: Tráfico HTTP dirigido al proxy.
- Configuración de Red: Intercambios de DHCP, ya que el servidor está conectado al router.
- Resolución de Nombres: Consultas y respuestas DNS.
- Pérdida Crítica: Sólo veremos el tráfico que pase por ese el Router IT.
- No veremos:
    - El tráfico OT local entre equipos conectados al mismo switch OT puede no pasar por el router, y además el switch OT no puede espejarlo.
    - El tráfico local entre el "Nuevo equipo" y otros equipos industriales en el mismo switch, ya que este tráfico no llega al router


**Información intercambiada con el fabricante:**  
- Permite identificar a qué servidores externos (dominios/IPs, puertos) se conecta el equipo, si usa el proxy, qué URLs o endpoints HTTP/HTTPS se alcanzan y con qué frecuencia.
- Si alguna comunicación no va cifrada, se podría inspeccionar el contenido para ver parámetros de actualización, informes de estado, identificadores de dispositivo o telemetría; si va cifrada, al menos se obtienen metadatos TLS (SNI, certificados, tamaños de registros).


**Impacto y fiabilidad en OT:**  
- Impacto en la OT: La copia SPAN se hace en dispositivos IT (router/switch IT) sin tocar la configuración del switch OT ni del nuevo equipo, por lo que el impacto directo sobre la red OT es mínimo.
- El mirroring consume recursos del equipo que espeja, porque debe copiar tramas, encolarlas y enviarlas por el puerto destino.
- ¿Compromete la fiabilidad?: No, el uso de port mirroring es una técnica no intrusiva que no interfiere con el flujo de datos original.



**Conclusión: ¿Es recomendable en el ámbito de este ejercicio?:**
- Como técnica única para cumplir el requisito: “capturar todo el tráfico del nuevo equipo”: No es recomendable.
- Como técnica complementaria: Sí puede ser recomendable. Es útil como complemento para observar todas las comunicaciones del nuevo equipo hacia DNS/proxy/Internet desde la parte IT, aprovechando que la infraestructura IT dispone de port mirroring.
- Posible complemento:
    - TAP en el enlace del equipo = mecanismo principal.
    - SPAN/ERSPAN en router = apoyo/backup y para visibilidad agregada, no para sustituir el TAP.



---


#### 1.2.4 Prácticas no recomendadas: Hubs Ethenet, Ataques MAC y Robo de puerto
- Hubs Ethernet - Concentradores: Aunque un Hub facilita la captura de tráfico al retransmitir todos los paquetes por todos sus puertos, su uso en entornos industriales modernos es contraproducente:
    - Un hub convierte el segmento en medio dúplex compartido: todas las estaciones comparten el mismo dominio de colisión, de modo que si varias estaciones transmiten a la vez se producen colisiones y hay que retransmitir, reduciendo mucho el rendimiento efectivo.
​   - La velocidad máxima de los hubs se quedó en 100 Mbps y degradan seriamente una red moderna, lo que choca frontalmente con el requisito de no afectar la disponibilidad ni el rendimiento de la red OT.

- Ataques MAC flooding: Esta técnica consiste en saturar la tabla CAM (Content Addressable Memory) del switch con direcciones MAC falsas para forzarlo a entrar en modo "fail-open" (comportándose como un hub).
    - Riesgo de denegación de servicio (DoS): Muchos switches industriales, al ser saturados, pueden bloquearse o reiniciarse en lugar de entrar en modo hub, lo que provocaría una interrupción total de la producción.
    - Inestabilidad del Switch OT: El enunciado prohíbe explícitamente cualquier acción que comprometa la fiabilidad de la red industrial. Un ataque de este tipo es una agresión directa a la infraestructura.
    - Impacto en otros equipos: Al convertir el switch en un hub mediante este ataque, el tráfico de todos los equipos industriales de la planta se vería afectado por colisiones, no solo el del Nuevo equipo.


- Robo de Puerto: Esta técnica implica enviar tramas con la dirección MAC de la víctima para "engañar" al switch y que este redirija el tráfico hacia el puerto del atacante.
    - Interrupción de las comunicaciones: Para que esta técnica funcione, se debe competir constantemente con el equipo legítimo por la propiedad de la MAC en la tabla del switch. Esto causa que el equipo original pierda paquetes de forma intermitente, rompiendo la comunicación.
    - Violación de la ventana de mantenimiento: El requisito indica que, una vez en producción, no es posible interrumpir la infraestructura. El robo de puerto es una técnica inestable por naturaleza que requiere ejecución continua y genera "ruido" en la red.
    - Detección y seguridad: Aunque se cuenta con la colaboración de los administradores, realizar ataques de este tipo puede disparar alertas de seguridad en el Router OT-IT o en los sistemas de monitorización de IT, complicando el análisis innecesariamente.



**Conclusión: ¿Es recomendable en el ámbito de este ejercicio?:**
Ninguna de estas técnicas son recomendables.
- Hub Ethernet: descartado por degradación de rendimiento/colisiones y por fiabilidad (dispositivo en línea). 
- Ataques MAC y robo de puerto: descartados por ser ataques activos, ruidosos, poco fiables, con riesgo real de degradar o desestabilizar la LAN OT y contrarios a los requisitos del enunciado.








### 1.3 Nivel de red
Es una alternativa cuando no es posible acceder al sistema local ni realizar una captura a nivel físico o de enlace, por falta de acceso al hardware o de capacidades de port mirroring en el switch. Esta estrategia se centra en redirigir el tráfico IP para que pase obligatoriamente por la estación de captura.


#### 1.3.1 Modificación de tablas de rutas.

Consiste en cambiar manualmente el "siguiente salto" en el equipo objetivo. No obstante, esto suele requerir permisos de superusuario, lo cual es poco probable si se está recurriendo a este nivel de captura.


**Cómo se podría usar. Configuración y Despligue:**  
- Debido a que el Nuevo equipo no permite la ejecución de comandos para modificar su tabla de rutas local, esta técnica debería implementarse de forma indirecta:
    - Aprovechando el Servidor DHCP: Se configuraría el servidor DHCP que está conectado al router, para que asigne a través de la Opción 3 (Router/Gateway) la dirección IP de nuestra estación de captura en lugar de la dirección IP del Router OT-IT.
    - Estación de Captura: Debe configurarse como un "gateway" intermedio, habilitando el reenvío de paquetes (IP Forwarding) para recibir el tráfico del equipo y reenviarlo al router real.
- Despliegue: Se realizaría durante la ventana de mantenimiento configurando el servidor DHCP y reiniciando la interfaz de red del equipo para que tome la nueva ruta.


**Protocolos que podriamos ver:**
- Tráfico hacia Internet: Comunicaciones HTTP dirigidas al Proxy Web.
- Servicios de Red: Consultas DNS.
- Configuración: Intercambios iniciales de DHCP.
- Limitación importante: No se vería el tráfico local entre el nuevo equipo y otros dispositivos del Switch OT. Sólo se observaría el tráfico que efectivamente pase por la estación de captura; el tráfico local dentro de la subred OT o el que no se desvíe por esas rutas no se vería.


**Información intercambiada con el fabricante:**
Al actuar como intermediario hacia Internet, se capturaría:
- Payloads de comunicación: El contenido íntegro de los mensajes enviados al fabricante para actualizaciones o informes de estado.
- Credenciales: Usuario y contraseña enviados para autenticarse en el Proxy Web.
- Incluso cuando el tráfico vaya cifrado, se obtiene visibilidad de metadatos (IPs, puertos, frecuencia y tamaño de las comunicaciones) similar a la de un router en línea.
​


**Impacto en la OT:**
Esta técnico no tienen un impacto mínimo en la OT. Obliga a cambiar la configuración de encaminamiento del equipo, directamente o vía DHCP, y hace que el tráfico pase “en línea” por la estación de captura que actúa como router.


**Fiabilidad en la OT:**
Compromete significativamente la fiabilidad: Si la estación de captura se apaga, se bloquea o tiene un fallo de software, el "Nuevo equipo" perderá totalmente la conectividad con el exterior.


**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  
No es recomendable. A pesar de ser técnicamente posible mediante la configuración del servidor DHCP, se descarta por dos razones fundamentales:
- Visibilidad incompleta: No permite cumplir el requisito de capturar el tráfico con "otros equipos de la red industrial" (tráfico local).
- Riesgo operativo: Crea una dependencia crítica de la estación de captura, comprometiendo la fiabilidad de la red OT en caso de fallo.




#### 1.3.2 Ataques AitM - Adversary in the middle
Esta técnica consiste en engañar a los dispositivos de una red local enviando mensajes ARP falsos para que asocien la dirección IP de una víctima (o del gateway) con la dirección MAC de la estación de captura. De este modo, el tráfico fluye a través del analista antes de llegar a su destino real.

**Cómo se podría usar. Configuración y Despligue:**  
- Preparación: Se conectaría una estación de captura a un puerto libre del Switch OT durante la ventana de mantenimiento.
- Configuración: La estación debe tener habilitado el reenvío de paquetes IP (IP forwarding) para no cortar la comunicación.
- Ejecución: Se utilizaría una herramienta como Ettercap o arpspoof para realizar un envenenamiento ARP bidireccional entre el Nuevo equipo y el Router OT-IT.
- Tráfico Local: Para capturar el tráfico con otros equipos industriales, se debería realizar el ataque contra cada uno de esos objetivos específicos dentro del Switch OT.



**Protocolos que podriamos ver:**
Al situarse en medio de la comunicación, esta técnica permite ver prácticamente todo el tráfico IP del Nuevo equipo hacia fuera de su subred: DNS, HTTP/HTTPS vía proxy, conexiones directas con el fabricante, etc. También las comunicaciones industriales




**Información intercambiada con el fabricante:**
Al ser una interceptación completa, se tiene acceso a:
- Payloads de mensajes: El contenido íntegro (cuerpo) de las comunicaciones con el fabricante (telemetría, estado, etc.).
- Credenciales: El usuario y la contraseña enviados para cruzar el Proxy HTTP.
- Actualizaciones: Posibles descargas de archivos o firmware por parte del equipo



**Impacto en la OT:**
Esta técnica tiene un impacto significativo y negativo:
- Sobrecarga de Red: Genera tráfico adicional constante (mensajes ARP falsos) para mantener el envenenamiento.
- Latencia: Al obligar a que todos los paquetes pasen por el procesador de la estación de captura antes de ser reenviados, se introduce un retardo que puede ser crítico en procesos industriales de tiempo real.



**Fiabilidad en la OT:**
Compromete la fiabilidad de forma crítica:
- Punto único de fallo: Si la estación de captura sufre un bloqueo, se apaga o simplemente es más lenta que el tráfico original, el Nuevo equipo queda incomunicado (Denegación de Servicio).
- Inestabilidad: Las tablas ARP de los equipos industriales pueden comportarse de forma impredecible ante ataques continuos, provocando desconexiones aleatorias que violan el requisito de fiabilidad del sistema.



**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  
No es recomendable:
- Viola el requisito de fiabilidad: Convierte a la estación de captura en un elemento crítico cuya falla detiene la producción.
- Impacto en el rendimiento: La introducción de latencia mediante una técnica "ofensiva" no es aceptable.




#### 1.3.3 Redirección ICMP
Esta técnica de nivel de red se basa en el envío de mensajes de control ICMP (Internet Control Message Protocol) para informar a un host de que existe una ruta más corta o "mejor" para alcanzar un destino específico, obligándolo a enviar su tráfico a través de una estación intermedia.

**Cómo se podría usar. Configuración y Despligue:**  
- Conexión: La estación de captura se conecta a un puerto libre del Switch OT.
- Suplantación: La estación de captura envía paquetes ICMP Redirect falsificados dirigidos al Nuevo equipo.
- Contenido del mensaje: El mensaje indicaría al equipo que para llegar a la dirección IP del Router OT-IT (o del Proxy), la mejor ruta es la dirección IP de la estación de captura.
- Reenvío: Es imprescindible que la estación de captura tenga habilitado el reenvío de paquetes (IP Forwarding) para que el tráfico llegue finalmente a su destino original y no se pierda la comunicación.


**Protocolos que podriamos ver:**
- Tráfico hacia Internet: Todas las peticiones HTTP dirigidas al Proxy Web.
- Resolución de nombres: Consultas DNS si el servidor DNS está fuera de la red local.
- Configuración de red: Tráfico DHCP (aunque este suele ser broadcast, la redirección afectaría a las comunicaciones posteriores unicast).
- Limitación crítica: No veríamos el tráfico local entre el nuevo equipo y otros dispositivos del Switch OT, ya que ese tráfico es de Nivel 2 y no consulta la tabla de rutas ni al gateway para entregarse.



**Información intercambiada con el fabricante:**
Al interceptar el tráfico hacia el proxy, se obtendría:
- Contenido íntegro (Payload): A diferencia de los logs del proxy, aquí veríamos el cuerpo de los mensajes HTTP intercambiados con el fabricante.
- Credenciales: El usuario y contraseña necesarios para autenticarse en el Proxy HTTP.
- Datos de telemetría: Informes de estado y solicitudes de actualización enviados al exterior.

**Impacto en la OT:**
No tienen un impacto mínimo en OT. Aunque el envío de mensajes ICMP es ligero, esta técnica:
- Introduce un salto adicional en la red, aumentando la latencia de las comunicaciones hacia el exterior.
- Consume recursos de red de forma innecesaria mediante la inyección de paquetes de control falsificados.


**Fiabilidad en la OT:**
Compromete la fiabilidad de forma grave:
- Punto único de fallo: Si la estación de captura falla o se apaga, el Nuevo equipo perderá la conectividad con el exterior, violando el requisito de no interrumpir la infraestructura.
- Muchos sistemas operativos modernos y dispositivos industriales tienen desactivada por defecto la aceptación de mensajes ICMP Redirect por motivos de seguridad (para evitar ataques AitM), por lo que la técnica podría simplemente no funcionar.
- Incompatibilidad: Dado que el equipo tiene un SO propietario, no podemos asegurar que acepte este tipo de redirecciones de ruta


**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  
No es recomendable. Esta técnica se descarta por las siguientes razones:
- Visibilidad incompleta: El cliente exige capturar el tráfico con "otros equipos de la red industrial", y esta técnica solo captura el tráfico que sale hacia el router.
- Inestabilidad: Depender de que un equipo industrial acepte redirecciones de ruta ICMP es muy arriesgado y poco profesional en entornos de misión crítica.
- Riesgo de interrupción: Crea una dependencia crítica de la estación de captura que compromete la fiabilidad de la red OT.



#### 1.3.4 DHCP Spoofing
Esta técnica consiste en introducir un servidor DHCP falso (rogue DHCP) en la red que responda a las solicitudes de configuración de los clientes antes que el servidor legítimo, permitiendo al analista asignar parámetros de red malintencionados para interceptar el tráfico.

**Cómo se podría usar. Configuración y Despligue:**  
- Despliegue: Se conectaría la estación de captura a un puerto libre del Switch OT durante la ventana de mantenimiento.
- Ataque de Carrera: La estación ejecutaría un software (como Ettercap o un script personalizado) para detectar mensajes DHCP Discover del Nuevo equipo y responder con un DHCP Offer más rápido que el servidor legítimo conectado al router.
- Configuración de Parámetros: Se configuraría el servidor falso para asignar al equipo su dirección IPv4, pero estableciendo la IP de la estación de captura como Puerta de Enlace Predeterminada (Gateway) y/o Servidor DNS.
- Reenvío: La estación de captura debe tener activo el IP Forwarding para redirigir el tráfico capturado hacia el router real y evitar que el equipo pierda conexión.
- Replicación de parámetros: Es vital que el servidor falso replique los "parámetros de arranque" personalizados que el equipo requiere del DHCP original para no impedir su inicio.


**Protocolos que podriamos ver:**
- Tráfico hacia el exterior: Todo el flujo HTTP dirigido al Proxy Web y comunicaciones con Internet. Resolución de nombres: Consultas DNS. Mensajes DHCP.
- Limitación: No capturaría el tráfico local entre el equipo y otros dispositivos industriales en el mismo switch (tráfico de Nivel 2), ya que este no pasa por el gateway.


**Información intercambiada con el fabricante:**
- Contenido de mensajes (Payload): A diferencia de los logs del proxy, se capturaría el cuerpo completo de los mensajes HTTP enviados al fabricante.
- Credenciales: El usuario y contraseña enviados para la autenticación en el Proxy HTTP.
- Reportes y Actualizaciones: Datos de estado y archivos de actualización descargados.


**Impacto en la OT:**
No tiene un impacto mínimo en OT. Esta técnica se considera intrusiva:
- Inestabilidad de red: Introduce una condición de carrera entre dos servidores DHCP, lo que puede causar que el equipo obtenga configuraciones inconsistentes.
- Latencia: Añade un salto intermedio procesado por software, lo que incrementa el retardo en las comunicaciones industriales.



**Fiabilidad en la OT:**
Compromete la fiabilidad de forma crítica:
- Punto único de fallo: Si la estación de captura falla, se apaga o se desconecta, el equipo pierde su salida a la red y a Internet al no tener un gateway funcional.
- Persistencia: Si el servidor DHCP legítimo "gana" la renovación de la IP más tarde, la captura se detendría repentinamente.
- Arranque del equipo: Si no se replican exactamente los parámetros de arranque especiales mencionados en el enunciado, el equipo podría ni siquiera iniciar correctamente.




**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  
No es recomendable.Aunque permite capturar el tráfico hacia Internet (el cual también podría capturarse mediante port mirroring en el router), se descarta por:
- Incapacidad de ver tráfico local: No cumple con el requisito de capturar comunicaciones con otros equipos de la red industrial.
- Riesgo Operativo: Es una técnica "activa" que puede impedir el arranque o funcionamiento del equipo, violando la exigencia de máxima fiabilidad y nula interrupción en la red OT.


#### 1.3.5 ARP/ND Poisoning


**Cómo se podría usar. Configuración y Despligue:**  

**Protocolos que podriamos ver:**

**Información intercambiada con el fabricante:**


**Impacto en la OT:**

**Fiabilidad en la OT:**

**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  

#### 1.3.6 Túneles IP/GRE y VPN


**Cómo se podría usar. Configuración y Despligue:**  

**Protocolos que podriamos ver:**

**Información intercambiada con el fabricante:**


**Impacto en la OT:**

**Fiabilidad en la OT:**

**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  



Este método NO es recomendable debido a:
- Este mecanismo se utiliza cuando no hay acceso físico ni al switch, cosa que no es nuetro caso.
- Este mecanismo no cumple con los requisitos del ejercicio:
    - Impacto mínimo.
    - Fiabilidad OT: forzar rutas/gateway o hacer MITM de red introduce dependencia operativa y riesgo.
    - Restricción operativa fuerte: después de la ventana de mantenimiento, no se puede interrumpir ni reconfigurar OT “incluso si hay problemas con el mecanismo de captura”. Eso penaliza cualquier solución que requiera ajustes o que pueda degradar la red si algo falla
- ARP poisoning / DHCP spoofing / ICMP Redirect: el propio capítulo lo trata como “última opción”
    - Además es especialmente inadecuado en OT por ruido, inestabilidad y riesgo.
    - Se debe terner el consentimiento expreso de los responsables de la infraestructura antes de realizarlo.






### 1.4 Nivel de aplicación


### 1.4.1 Uso de Proxies (HTTP, SOCKS)

**Cómo se podría usar. Configuración y Despligue:**  

**Protocolos que podriamos ver:**

**Información intercambiada con el fabricante:**


**Impacto en la OT:**

**Fiabilidad en la OT:**

**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  

### 1.4.2 Configuración global o por App

**Cómo se podría usar. Configuración y Despligue:**  

**Protocolos que podriamos ver:**

**Información intercambiada con el fabricante:**


**Impacto en la OT:**

**Fiabilidad en la OT:**

**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  


### 1.4.3 Proxy inverso


**Cómo se podría usar. Configuración y Despligue:**  

**Protocolos que podriamos ver:**

**Información intercambiada con el fabricante:**


**Impacto en la OT:**

**Fiabilidad en la OT:**

**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  

### 1.4.4 Interceptación DNS (Fichero HOTS, DNAT)

**Cómo se podría usar. Configuración y Despligue:**  

**Protocolos que podriamos ver:**

**Información intercambiada con el fabricante:**


**Impacto en la OT:**

**Fiabilidad en la OT:**

**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  

### 1.4.5 Paneles de desarrollo en navegadores

**Cómo se podría usar. Configuración y Despligue:**  

**Protocolos que podriamos ver:**

**Información intercambiada con el fabricante:**


**Impacto en la OT:**

**Fiabilidad en la OT:**

**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  




Muy relevante para “Internet”, pero como telemetría complementaria

Aquí el ejercicio te da una pista directa:
- Funciona en redes empresariales que no permiten la conexión directa de los equipos con Internet.
- La salida a Internet desde OT es solo mediante DNS + proxy, con usuario/contraseña configurado explícitamente en el cliente. 
- El proxy loggea URLs por cliente, pero no guarda contenido HTTP. 


Cómo conectarlo con tu resumen:

Qué sí puedes obtener (y es muy útil para responder al cliente):
- A qué dominios/URLs intenta acceder el equipo (vía logs del proxy y/o DNS).
- Patrones de beaconing, actualizaciones, endpoints del fabricante.

Qué no puedes obtener por defecto:
- El contenido de la comunicación (si hay TLS o si el proxy no registra cuerpos/respuestas).
- Y sobre mitmproxy (de tu resumen): En teoría, mitmproxy ayuda a inspeccionar aplicación y TLS, pero en este caso suele no ser viable porque requeriría:

Reconfigurar el cliente para que use tu proxy, y (si interceptas TLS) instalar una CA en el equipo, lo cual es improbable con SO propietario y además arriesgado para OT.

Veredicto razonable: no como mecanismo principal, y solo planteable en laboratorio/entorno de pruebas si el fabricante lo permite.





## 2 Herramientas de Captura y Análisis de Tráfico

**Cómo se podría usar. Configuración y Despligue:**  

**Protocolos que podriamos ver:**

**Información intercambiada con el fabricante:**


**Impacto en la OT:**

**Fiabilidad en la OT:**

**Conclusión: ¿Es recomendable en el ambito de este ejercicio?**  

### 2.1. Captura de tráfico con ‘tcpdump’

### 2.2. Análisis de tráfico con ‘Wireshark’

### 2.3. Análisis de tráfico a nivel de aplicación con ‘mitmproxy’



