
![Portada](capturas/portada-tarea2-modulo5.png)

- [1. Análisis del protocolo](#1-análisis-del-protocolo)
- [1. Filtrar el tráfico específico](#1-filtrar-el-tráfico-específico)
- [Localizamos las conversaciones reales de la app. Sesiones TCP](#localizamos-las-conversaciones-reales-de-la-app-sesiones-tcp)
- [Información intercambiada entre el cliente y el servidor](#información-intercambiada-entre-el-cliente-y-el-servidor)



Analizar el tráfico incluido en el fichero actividad2.pcap.

Esa captura de tráfico se ha realizado en la misma máquina (192.168.1.33) donde se ejecuta el servidor de la aplicación a analizar y que
corre en el puerto TCP/7000 (que no es el puerto estándar de ese protocolo). El fichero de captura también incluye otro tipo de tráfico, que no está relacionado con la aplicación, por lo que se deberían utilizar los filtros de visualización de Wireshark para encontrar el tráfico de la aplicación.

## 1. Análisis del protocolo
El objetivo de la práctica es:
- Estudiar el protocolo empleado por la aplicación.
- Identificar el tipo de mensajes intercambiados por el cliente y el servidor.
- Intentar interpretar el contenido y significado de los mismos.
- Obtener la información intercambiada.
- Intentar identificar el protocolo exacto que está siendo empleado por la aplicación.
- Incluir capturas de pantalla de Wireshark:
    - Especificación del protocolo de la aplicación
    - La información intercambiada entre el cliente y el servidor.



Para resolver este ejercicio de análisis de tráfico con Wireshark, necesitamos filtrar el ruido y centrarnos específicamente en la actividad del puerto 7000. Por ello debemos eliminar el tráfico de fondo como TLS e ICMP.

## 1. Filtrar el tráfico específico
Dado que el enunciado indica que la aplicación corre en el puerto TCP 7000, lo primero es limpiar la vista. En wireshark, aplicamos el filtro: `tcp.port == 7000`:

```
No.	Time	Source	Destination	Protocol	Length	Info
547	23.658353	192.168.1.110	servidor	TCP	66	62897 → 7000 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM
548	23.658377	servidor	192.168.1.110	TCP	66	7000 → 62897 [SYN, ACK] Seq=0 Ack=1 Win=64240 Len=0 MSS=1460 SACK_PERM WS=128
549	23.658573	192.168.1.110	servidor	TCP	54	62897 → 7000 [ACK] Seq=1 Ack=1 Win=2102272 Len=0
550	23.659351	192.168.1.110	servidor	TCP	56	62897 → 7000 [PSH, ACK] Seq=1 Ack=1 Win=2102272 Len=2
551	23.659418	servidor	192.168.1.110	TCP	54	7000 → 62897 [ACK] Seq=1 Ack=3 Win=64256 Len=0
552	23.662103	servidor	192.168.1.110	TCP	111	7000 → 62897 [PSH, ACK] Seq=1 Ack=3 Win=64256 Len=57
553	23.662161	servidor	192.168.1.110	TCP	220	7000 → 62897 [FIN, PSH, ACK] Seq=58 Ack=3 Win=64256 Len=166
554	23.662373	192.168.1.110	servidor	TCP	54	62897 → 7000 [ACK] Seq=3 Ack=225 Win=2102016 Len=0
555	23.662554	192.168.1.110	servidor	TCP	54	62897 → 7000 [FIN, ACK] Seq=3 Ack=225 Win=2102016 Len=0
556	23.662565	servidor	192.168.1.110	TCP	54	7000 → 62897 [ACK] Seq=225 Ack=4 Win=64256 Len=0
557	25.852265	192.168.1.110	servidor	TCP	66	62900 → 7000 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM
558	25.852296	servidor	192.168.1.110	TCP	66	7000 → 62900 [SYN, ACK] Seq=0 Ack=1 Win=64240 Len=0 MSS=1460 SACK_PERM WS=128
559	25.852649	192.168.1.110	servidor	TCP	54	62900 → 7000 [ACK] Seq=1 Ack=1 Win=2102272 Len=0
560	25.853468	192.168.1.110	servidor	TCP	66	62900 → 7000 [PSH, ACK] Seq=1 Ack=1 Win=2102272 Len=12
561	25.853479	servidor	192.168.1.110	TCP	54	7000 → 62900 [ACK] Seq=1 Ack=13 Win=64256 Len=0
562	25.858682	servidor	192.168.1.110	TCP	67	7000 → 62900 [PSH, ACK] Seq=1 Ack=13 Win=64256 Len=13
563	25.858754	servidor	192.168.1.110	TCP	54	7000 → 62900 [FIN, ACK] Seq=14 Ack=13 Win=64256 Len=0
564	25.859028	192.168.1.110	servidor	TCP	54	62900 → 7000 [ACK] Seq=13 Ack=15 Win=2102272 Len=0
565	25.859976	192.168.1.110	servidor	TCP	54	62900 → 7000 [FIN, ACK] Seq=13 Ack=15 Win=2102272 Len=0
566	25.859993	servidor	192.168.1.110	TCP	54	7000 → 62900 [ACK] Seq=15 Ack=14 Win=64256 Len=0
568	31.351551	192.168.1.110	servidor	TCP	66	62910 → 7000 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM
569	31.351573	servidor	192.168.1.110	TCP	66	7000 → 62910 [SYN, ACK] Seq=0 Ack=1 Win=64240 Len=0 MSS=1460 SACK_PERM WS=128
570	31.351799	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=1 Ack=1 Win=2102272 Len=0
571	31.352463	192.168.1.110	servidor	TCP	65	62910 → 7000 [PSH, ACK] Seq=1 Ack=1 Win=2102272 Len=11
572	31.352469	servidor	192.168.1.110	TCP	54	7000 → 62910 [ACK] Seq=1 Ack=12 Win=64256 Len=0
573	31.355524	servidor	192.168.1.110	TCP	4150	7000 → 62910 [PSH, ACK] Seq=1 Ack=12 Win=64256 Len=4096 [TCP PDU reassembled in 575]
574	31.355543	servidor	192.168.1.110	TCP	7354	7000 → 62910 [PSH, ACK] Seq=4097 Ack=12 Win=64256 Len=7300 [TCP PDU reassembled in 575]
575	31.355556	servidor	192.168.1.110	Gryphon	2974	
576	31.355954	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2087936 Len=0
577	31.355963	servidor	192.168.1.110	Gryphon	14654	- Invalid -- Invalid -
578	31.355967	servidor	192.168.1.110	Gryphon	14654	- Invalid -
579	31.355954	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2092032 Len=0
580	31.355954	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2096128 Len=0
581	31.355954	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2100224 Len=0
582	31.355954	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2102272 Len=0
583	31.356253	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2073088 Len=0
584	31.356259	servidor	192.168.1.110	Gryphon	29254	- Invalid -
585	31.356263	servidor	192.168.1.110	TCP	2974	7000 → 62910 [PSH, ACK] Seq=72717 Ack=12 Win=64256 Len=2920 [TCP PDU reassembled in 586]
586	31.356265	servidor	192.168.1.110	Gryphon	26334	- Invalid -- Invalid -
587	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2077184 Len=0
588	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2081280 Len=0
589	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2085376 Len=0
590	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2089472 Len=0
591	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2093568 Len=0
592	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2097664 Len=0
593	31.356274	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2101760 Len=0
594	31.356563	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2043392 Len=0
595	31.356572	servidor	192.168.1.110	Gryphon	35094	- Invalid -- Invalid -
596	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2048000 Len=0
597	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2052096 Len=0
598	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2056192 Len=0
599	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2060288 Len=0
600	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2064384 Len=0
601	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2068480 Len=0
602	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2072576 Len=0
603	31.356593	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2076672 Len=0
604	31.356593	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2080768 Len=0
605	31.356593	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2084864 Len=0
606	31.356673	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2088960 Len=0
607	31.356676	servidor	192.168.1.110	TCP	22842	7000 → 62910 [PSH, ACK] Seq=136957 Ack=12 Win=64256 Len=22788 [TCP PDU reassembled in 611]
608	31.356673	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2093056 Len=0
609	31.356673	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2097152 Len=0
610	31.356673	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2101248 Len=0
611	31.356715	servidor	192.168.1.110	Gryphon	23414	- Invalid -
612	31.356816	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2066176 Len=0
613	31.356822	servidor	192.168.1.110	Gryphon	43854	- Invalid -
614	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2071296 Len=0
615	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2075392 Len=0
616	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2079488 Len=0
617	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2083584 Len=0
618	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2087680 Len=0
619	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2091776 Len=0
620	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2095872 Len=0
621	31.356837	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2099968 Len=0
622	31.356837	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2102272 Len=0
623	31.356855	servidor	192.168.1.110	TCP	485	7000 → 62910 [FIN, PSH, ACK] Seq=226905 Ack=12 Win=64256 Len=431
624	31.356898	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2056192 Len=0
625	31.356898	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2060288 Len=0
626	31.356898	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2064384 Len=0
627	31.356898	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2068480 Len=0
628	31.356898	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2072576 Len=0
629	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2076672 Len=0
630	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2080768 Len=0
631	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2084864 Len=0
632	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2088960 Len=0
633	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2093056 Len=0
634	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2097152 Len=0
635	31.357037	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2052864 Len=0
636	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2056960 Len=0
637	31.357057	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2061056 Len=0
638	31.357057	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2065152 Len=0
639	31.357057	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2069248 Len=0
640	31.357058	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2073344 Len=0
641	31.357071	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2077440 Len=0
642	31.357087	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2081536 Len=0
643	31.357089	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2085632 Len=0
644	31.357112	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2089728 Len=0
645	31.357114	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2093824 Len=0
646	31.357131	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2097920 Len=0
647	31.357152	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2102016 Len=0
650	34.163277	192.168.1.110	servidor	TCP	54	62910 → 7000 [FIN, ACK] Seq=12 Ack=227337 Win=2102016 Len=0
651	34.163311	servidor	192.168.1.110	TCP	54	7000 → 62910 [ACK] Seq=227337 Ack=13 Win=64256 Len=0
1074	52.655474	192.168.1.110	servidor	TCP	66	62949 → 7000 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM
1075	52.655496	servidor	192.168.1.110	TCP	66	7000 → 62949 [SYN, ACK] Seq=0 Ack=1 Win=64240 Len=0 MSS=1460 SACK_PERM WS=128
1076	52.655718	192.168.1.110	servidor	TCP	54	62949 → 7000 [ACK] Seq=1 Ack=1 Win=2102272 Len=0
1077	52.656403	192.168.1.110	servidor	TCP	61	62949 → 7000 [PSH, ACK] Seq=1 Ack=1 Win=2102272 Len=7
1078	52.656409	servidor	192.168.1.110	TCP	54	7000 → 62949 [ACK] Seq=1 Ack=8 Win=64256 Len=0
1079	52.660410	servidor	192.168.1.110	TCP	101	7000 → 62949 [PSH, ACK] Seq=1 Ack=8 Win=64256 Len=47
1080	52.660437	servidor	192.168.1.110	TCP	54	7000 → 62949 [FIN, ACK] Seq=48 Ack=8 Win=64256 Len=0
1081	52.660994	192.168.1.110	servidor	TCP	54	62949 → 7000 [ACK] Seq=8 Ack=49 Win=2102272 Len=0
1082	52.661216	192.168.1.110	servidor	TCP	54	62949 → 7000 [FIN, ACK] Seq=8 Ack=49 Win=2102272 Len=0
1083	52.661226	servidor	192.168.1.110	TCP	54	7000 → 62949 [ACK] Seq=49 Ack=9 Win=64256 Len=0
```

En el primer paquete que aparece tras aplicar el filtro (547), vamos hacer un seguimiento con TCP stream: Hacemos click derecho en el paquete 547 y seleccionamos Follow (Seguir) → TCP Stream.
![tarea-2](capturas/tarea-2.png)

```
iWelcome to the 192.168.1.33:7000 server!	fake	(NULL)	0
i	fake	(NULL)	0
0Hello	/hello.txt	192.168.1.33	7000	+
1RFCs	/dir/	192.168.1.33	7000	+
gLena	/lena.gif	192.168.1.33	7000	+
1Quux Mega Server	/	142.4.200.132	7000
```
donde:
- **<mark>Vemos palabras legibles como "Welcome", "Hello", "Mega Server". Esto parece que es un protocolo basado en texto (ASCII), lo cual descarta protocolos complejos cifrados o puramente binarios.</mark>**
- **<mark>Tambien parece una comunicación en la que se piden recursos, como hello.txt, lena.gif</mark>**


## Localizamos las conversaciones reales de la app. Sesiones TCP
Aunque filtremo por 7000, es buena práctica confirmar cuántas conexiones hay y quién habla con quién:
- Vamos a Statistics → Conversations → TCP  → Ordenamos por Port o usamos el buscador para encontrar 7000.
- Apuntamos:
    - IP/puerto del cliente
    - IP/puerto del servidor (192.168.1.33:7000)
    - Número de bytes transferidos en cada sentido (te ayuda a identificar la sesión “importante”).

![tarea-2-1](capturas/tarea-2-1.png)
```
Dirección A,Puerto A,Dirección B,Puerto B,Paquetes,Bytes,Stream ID,Paquetes totales,Porcentaje filtrado,Packets A → B,Bytes A → B,Packets B → A,Bytes B → A,Inicio rel,Duración,Bits/s A → B,Bits/s B → A,Flows
"192.168.1.110",62897,"192.168.1.33",7000,10,789,6,10,100,5,284,5,505,23.658352999999998,0.004212000000002547,"","",3
"192.168.1.110",62900,"192.168.1.33",7000,10,589,7,10,100,5,294,5,295,25.852265,0.007728000000000179,304347,305383,2
"192.168.1.110",62910,"192.168.1.33",7000,82,231798,8,82,100,66,3587,16,228211,31.351551,2.8117599999999996,10205,649304,14
"192.168.1.110",62949,"192.168.1.33",7000,10,618,10,10,100,5,289,5,329,52.655474,0.00575200000000109,401947,457579,2
```

Esta vista de Conversaciones TCP es fundamental porque nos aporta una visión global de cómo interactuó el cliente con la aplicación. Al filtrar por el puerto 7000, vemos que se establecieron 4 flujos o sesiones independientes entre el cliente (192.168.1.110) y el servidor (192.168.1.33).

Y los volúmenes son muy diferentes:
- Stream 6: 10 paquetes / 789 bytes → muy corto
- Stream 7: 10 paquetes / 589 bytes → muy corto
- Stream 8: 82 paquetes / 231,798 bytes → con diferencia, el principal
- Stream 10: 10 paquetes / 618 bytes → muy corto

Además, en el Stream 8:
- A→B (cliente→servidor): 3,587 bytes
- B→A (servidor→cliente): 228,211 bytes

**<mark>Esto encaja con un patrón típico: el cliente hace una petición pequeña y el servidor responde con un contenido grande, que puede ser una descarga, listado, datos, o un archivo. Es por esto que vamos a apostar por este stream para seguir investigando `tcp.stream == 8`.</mark>**

Aplicamos el filtro: `tcp.stream == 8`
```
No.	Time	Source	Destination	Protocol	Length	Info
568	31.351551	192.168.1.110	servidor	TCP	66	62910 → 7000 [SYN] Seq=0 Win=64240 Len=0 MSS=1460 WS=256 SACK_PERM
569	31.351573	servidor	192.168.1.110	TCP	66	7000 → 62910 [SYN, ACK] Seq=0 Ack=1 Win=64240 Len=0 MSS=1460 SACK_PERM WS=128
570	31.351799	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=1 Ack=1 Win=2102272 Len=0
571	31.352463	192.168.1.110	servidor	TCP	65	62910 → 7000 [PSH, ACK] Seq=1 Ack=1 Win=2102272 Len=11
572	31.352469	servidor	192.168.1.110	TCP	54	7000 → 62910 [ACK] Seq=1 Ack=12 Win=64256 Len=0
573	31.355524	servidor	192.168.1.110	TCP	4150	7000 → 62910 [PSH, ACK] Seq=1 Ack=12 Win=64256 Len=4096 [TCP PDU reassembled in 575]
574	31.355543	servidor	192.168.1.110	TCP	7354	7000 → 62910 [PSH, ACK] Seq=4097 Ack=12 Win=64256 Len=7300 [TCP PDU reassembled in 575]
575	31.355556	servidor	192.168.1.110	Gryphon	2974	
576	31.355954	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2087936 Len=0
577	31.355963	servidor	192.168.1.110	Gryphon	14654	- Invalid -- Invalid -
578	31.355967	servidor	192.168.1.110	Gryphon	14654	- Invalid -
579	31.355954	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2092032 Len=0
580	31.355954	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2096128 Len=0
581	31.355954	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2100224 Len=0
582	31.355954	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=14317 Win=2102272 Len=0
583	31.356253	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2073088 Len=0
584	31.356259	servidor	192.168.1.110	Gryphon	29254	- Invalid -
585	31.356263	servidor	192.168.1.110	TCP	2974	7000 → 62910 [PSH, ACK] Seq=72717 Ack=12 Win=64256 Len=2920 [TCP PDU reassembled in 586]
586	31.356265	servidor	192.168.1.110	Gryphon	26334	- Invalid -- Invalid -
587	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2077184 Len=0
588	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2081280 Len=0
589	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2085376 Len=0
590	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2089472 Len=0
591	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2093568 Len=0
592	31.356253	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2097664 Len=0
593	31.356274	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=43517 Win=2101760 Len=0
594	31.356563	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2043392 Len=0
595	31.356572	servidor	192.168.1.110	Gryphon	35094	- Invalid -- Invalid -
596	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2048000 Len=0
597	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2052096 Len=0
598	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2056192 Len=0
599	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2060288 Len=0
600	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2064384 Len=0
601	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2068480 Len=0
602	31.356563	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2072576 Len=0
603	31.356593	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2076672 Len=0
604	31.356593	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2080768 Len=0
605	31.356593	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2084864 Len=0
606	31.356673	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2088960 Len=0
607	31.356676	servidor	192.168.1.110	TCP	22842	7000 → 62910 [PSH, ACK] Seq=136957 Ack=12 Win=64256 Len=22788 [TCP PDU reassembled in 611]
608	31.356673	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2093056 Len=0
609	31.356673	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2097152 Len=0
610	31.356673	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=101917 Win=2101248 Len=0
611	31.356715	servidor	192.168.1.110	Gryphon	23414	- Invalid -
612	31.356816	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2066176 Len=0
613	31.356822	servidor	192.168.1.110	Gryphon	43854	- Invalid -
614	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2071296 Len=0
615	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2075392 Len=0
616	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2079488 Len=0
617	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2083584 Len=0
618	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2087680 Len=0
619	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2091776 Len=0
620	31.356816	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2095872 Len=0
621	31.356837	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2099968 Len=0
622	31.356837	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=136957 Win=2102272 Len=0
623	31.356855	servidor	192.168.1.110	TCP	485	7000 → 62910 [FIN, PSH, ACK] Seq=226905 Ack=12 Win=64256 Len=431
624	31.356898	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2056192 Len=0
625	31.356898	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2060288 Len=0
626	31.356898	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2064384 Len=0
627	31.356898	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2068480 Len=0
628	31.356898	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2072576 Len=0
629	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2076672 Len=0
630	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2080768 Len=0
631	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2084864 Len=0
632	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2088960 Len=0
633	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2093056 Len=0
634	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=183105 Win=2097152 Len=0
635	31.357037	192.168.1.110	servidor	TCP	54	62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2052864 Len=0
636	31.357037	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2056960 Len=0
637	31.357057	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2061056 Len=0
638	31.357057	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2065152 Len=0
639	31.357057	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2069248 Len=0
640	31.357058	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2073344 Len=0
641	31.357071	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2077440 Len=0
642	31.357087	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2081536 Len=0
643	31.357089	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2085632 Len=0
644	31.357112	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2089728 Len=0
645	31.357114	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2093824 Len=0
646	31.357131	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2097920 Len=0
647	31.357152	192.168.1.110	servidor	TCP	54	[TCP Window Update] 62910 → 7000 [ACK] Seq=12 Ack=227337 Win=2102016 Len=0
650	34.163277	192.168.1.110	servidor	TCP	54	62910 → 7000 [FIN, ACK] Seq=12 Ack=227337 Win=2102016 Len=0
651	34.163311	servidor	192.168.1.110	TCP	54	7000 → 62910 [ACK] Seq=227337 Ack=13 Win=64256 Len=0

```

Reconstruimos el diálogo en el primer paquete que mustra este filtro → Analyze → Follow → TCP Stream
![tarea2-2](capturas/tarea-2-2.png)
donde: 
- El cliente envía la cadena /lena.gif (en rojo).
- El servidor devuelve un contenido que empieza por GIF87a, que es la firma (“magic bytes”) de un fichero GIF.
- La aplicación está sirviendo un recurso llamado lena.gif, y el cliente lo solicita indicando la ruta. Esto es muy compatible con HTTP (GET de un objeto), pero también podría ser un protocolo propio minimalista, en el que el cliente manda la ruta y el servidor devuelve bytes “a pelo”.

**<mark>Podemos deducir un patrón: el cliente pide un recurso por “ruta/selector” y el servidor devuelve el fichero en bruto.</mark>**



**Vamos a tirar por hacer un “Decode As… COMO HTTP” de un paque que ofrezca el puerto 7000 a ver que nos dice:**
De los dos primeros paquetes de este stream 8:
- Paquete 568: 62910 → 7000 [SYN]  
Es el SYN del cliente, donde el puerto “destino” es 7000 pero el paquete se origina desde el puerto 62910.  
![tarea-2-paquete568](capturas/tarea-2-paquete568.png)



- Paquete 569: 7000 → 62910 [SYN, ACK]  
Es el SYN/ACK del servidor, y aquí el paquete sale desde el puerto 7000. Al abrir Decode As desde este paquete, es mucho más probable que Wireshark te muestre TCP port = 7000, que es lo que necesitas para decirle: “trata el puerto 7000 como HTTP”.
![tarea-2-paquete569](capturas/tarea-2-paquete569-ok-2.png)
donde:
- **"Protocol", Wireshark etiqueta el paquete 575 como Gryphon.** Sin embargo, si investigamos este protocolo Gryphon, es un protocolo de red industrial utilizado principalmente en la automoción (para diagnósticos de vehículos y buses CAN). Es un protocolo binario.

**<mark>Aunque Wireshark intenta interpretarlo como Gryphon debido al puerto 7000, lo que vimos  en la captura donde veíamos palabras legibles en texto plano que decían "Welcome to the... server!", "hello.txt", "RFCs", "lena.gif" indica un protocolo de texto. Luego el protocolo que buscamos no es ese Gryphon.</mark>**


Como parece que es un protocolo de texto, vamos a intentar hacer un decode del paque 569, obligando a usar HTTP:
![decode http en paquete 569](capturas/tarea-2-paquete569-http.png)

Pero no cambia nada:
![decode http en paquete 569](capturas/tarea-2-paquete569-http-2.png)

**<mark>No usa el protocolo http. Veamos que responde google:</mark>**
![respuesta-google.png](capturas/respuesta-google.png)

Vamos a probar con FTP. Hacemos un decode de ese paquete 569 con el protocolo FTP:
![tarea-2-paquete569-ftp](capturas/tarea-2-paquete569-ftp.png)
donde:
- FTP (control) usa comandos tipo: USER, PASS, SYST, PWD, TYPE, RETR, PASV, etc.
- Normalmente en puerto 21, y además abre canales de datos separados.
- En el stream:
    - El “request” es solo /lena.gif
    - La “response” empieza por GIF87a (cabecera binaria de un GIF)
- **<mark>Tampoco es FTP.</mark>**
- **<mark>Lo que sí sabemos es que: Es un protocolo de petición/respuesta donde el cliente envía un “selector/ruta” y el servidor devuelve el recurso binario.</mark>**


Preguntamos a google por protocolos similares a http:
![respuesta-google-2.png](capturas/respuesta-google-2.png)
donde:
- https no puede ser.
- websocket no puede ser. xxxx
- FTP ya hemos visto que tampoco.


Probamos con Gopher: Un sistema de información distribuida más antiguo, con un protocolo ligero muy similar a HTTP, permitiendo la navegación en menús. Volvemos hacer en ese paquete un “Decode As… COMO Gopher :
![tarea-2-paquete569-gopher.png](capturas/tarea-2-paquete569-gopher.png)
donde:
- **<mark>Wireshark disecciona el tráfico como Gopher, y el comportamiento observado (cliente envía un selector /lena.gif y servidor devuelve bytes que empiezan por GIF87a) encaja exactamente con Gopher.</mark>**


Volvemos a aplicar el filtro: `tcp.port == 7000`:
![tarea-2-paquete569-gopher.png](capturas/tarea-2-paquete569-gopher-2.png)
donde:
- Con el filtro tcp.port == 7000 se observan varias conexiones donde Wireshark ya decodifica Gopher.
- Gopher Request: [Directory list] (listado de directorio/menú).
- Gopher Request: /hello.txt (petición de fichero de texto).
- Gopher Request: /lena.gif (petición de imagen GIF).
- Respuestas “Gopher Response” asociadas.
- **<mark>Conclusión: la aplicación usa el protocolo Gopher sobre TCP, pero en un puerto no estándar, el 7000 en vez de 70.</mark>**



## Información intercambiada entre el cliente y el servidor
Vamos a realizar una captura de pantalla en la que se vea la información intercambiada entre el cliente y el servidor:
- Aplicamos filtro: `tcp.port == 7000`.
- Seleccionaremos dos paquetes
    - “Gopher Request: /hello.txt”
    - “Gopher Request: /lena.gif”.
- Analyze → Follow → TCP Stream → Analizamos la información que se intercambia.


**Información que intercambia `hello.txt`:**
![tarea-2-comunicacion](capturas/tarea-2-comunicacion.png)
donde: 
- En la parte del cliente: la petición con el nombre del fichero y el lugar donde està: `/hello.txt`.
- En la parte del servidor: la respuesta del servidor que envía el contenido de ese fichero: `Hello world!`.


**Información que intercambia  `lena.gif`:**
![tarea-2-comunicacion](capturas/tarea-2-comunicacion-2.png)
donde:
- En la parte del cliente: la petición `/lena.gif`.
- En la parte del servidor: la respuesta: `GIF87a........a].LP.8D.]Y.]a.8H.YY.DL....Ua.0@.,@.@H.<D.......$<.......YP......P.4a.HP.4......Y.@a.4.....qa.4....D].De..m..}.PU..q..y.8a.La.uu.yi.yy.ye.DUq,a.mai,Y.@P.e].LP.ae.]].HP.8D.4D.]Y.U].DL.UY.@H.@P.YY....<D....,@. <m L....YPY LH.8H.8m.8a.@D.4..y..m].`. Que es el fichero en crudo.
- La respuesta del servidor empieza por GIF87a, que es la firma (“magic bytes”) de un fichero GIF. Eso indica que lo que viene a continuación son bytes binarios del propio fichero.


**Veamos la foto en crudo:** Estando en este paque 571, en la ventana: Analyze → Follow → TCP Stream → Cambiamos “Mostrar como”: Raw.
![tarea-2-comunicacion](capturas/tarea-2-comunicacion-3.png)  
donde:
- Vemos la petición del cliente y del servidor en crudo.

**Cambiamos unas opciones para poder guadar la foto:**  
![tarea-2-comunicacion](capturas/tarea-2-comunicacion-4.png)  
donde:
- Buscamos un desplegable tipo “Show data as / Mostrar datos como” y eligimos Raw.
- xxxxxxxxMuy importante: si aparece otro control tipo “Stream/Conversation” o “Direction”: 192.168.1.33:7000 --> 192.168.1.110
- Pulsamos el boton guardar y damos un nombre al fichero:

![lena](capturas/lena.gif)