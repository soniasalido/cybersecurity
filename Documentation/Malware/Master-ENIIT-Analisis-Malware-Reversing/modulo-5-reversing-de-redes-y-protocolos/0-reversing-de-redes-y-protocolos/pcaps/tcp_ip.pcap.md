![tcp_ip.pcap](capturas/tcp_ip.pcap.png)

En la captura de pantalla se ve una lista de tramas en Wireshark, que es un flujo tÃ­pico TCP/IP de navegaciÃ³n HTTP: primero ARP + DNS, luego 3-way handshake TCP, HTTP GET / respuesta 200 OK, y finalmente cierre ordenado (FIN/ACK).

## 1) Descubrimiento en LAN: ARP (paquetes 1â€“2)
- (1) ARP Request  
Who has 192.168.1.1? Tell 192.168.1.33  
Tu host (192.168.1.33) pregunta por la MAC del gateway 192.168.1.1 para poder salir a Internet.

- (2) ARP Reply  
192.168.1.1 is at 78:29:ed:dc:62:99  
Respuesta del router (fabricante Askey) indicando su MAC.  
Con esto ya puede encapsular trÃ¡fico IP hacia fuera de la LAN.


## 2) ResoluciÃ³n de nombre: DNS (paquetes 3â€“5)
- (3) DNS Query A (IPv4) a 80.58.61.250  
Pregunta por la IP de www.example.com.

- (4) DNS Query AAAA (IPv6)  
TambiÃ©n intenta resolver IPv6 (normal en muchos sistemas).

- (5) DNS Response A  
www.example.com = 93.184.216.34  
Con esta IP (IPv4) ya puede iniciar la conexiÃ³n TCP a ese destino.

En la traza se ve que finalmente se usa IPv4 (porque el TCP va a 93.184.216.34).


## 3) Establecimiento de conexiÃ³n TCP: 3-Way Handshake (paquetes 6â€“8)

AquÃ­ empieza la conexiÃ³n entre:
- Cliente: 192.168.1.33:51616 (puerto efÃ­mero)
- Servidor web: 93.184.216.34:80 (HTTP)

---

- (6) SYN (cliente â†’ servidor)  
51616 â†’ 80 [SYN]  
Opciones destacables:
  - MSS=1460 (tamaÃ±o mÃ¡ximo de segmento tÃ­pico con MTU 1500)
  - SACK Permitted (permite ACK selectivos)
  - Timestamps (TSval/TSecr) (mediciÃ³n RTT y PAWS)
  - WS=128 (Window Scaling: factor de escalado)

- (7) SYN,ACK (servidor â†’ cliente)  
80 â†’ 51616 [SYN, ACK]  
  - MSS=1452 (algo menor que 1460)
    Esto suele indicar que el servidor/anillo de red puede tener overhead extra (por ejemplo, PPPoE o ajustes de MTU), por lo que anuncia una MSS menor.

  - TambiÃ©n anuncia SACK, timestamps y WS=512.

- (8) ACK final (cliente â†’ servidor)  
51616 â†’ 80 [ACK]  
Handshake completado: a partir de aquÃ­ ya se puede intercambiar datos de aplicaciÃ³n (HTTP).


ðŸ“Œ RTT aproximado:  
Tiempo (6) â‰ˆ 0.107252 â†’ Tiempo (7) â‰ˆ 0.234735  
RTT ~ 127 ms (con la precisiÃ³n de la captura).  


## 4) Intercambio de datos: HTTP GET y respuesta 200 OK (paquetes 9â€“13)
- (9) HTTP GET (cliente â†’ servidor)  
GET / HTTP/1.1  
Esto es una peticiÃ³n web directa (sin TLS, porque es puerto 80).
![tcp_ip-paquete9](capturas/tcp_ip-paquete9.png)  
Vemos en el user-agent que es una peticiÃ³n con el comando wget.


- (10) ACK del servidor  
El servidor confirma recepciÃ³n del GET (Ack=143), sin datos.

- (11) Respuesta del servidor (primer segmento grande)  
80 â†’ 51616 [ACK] Len=1440  
Wireshark marca: â€œTCP PDU reassembled in 12â€  
Significa que la respuesta HTTP estÃ¡ fragmentada en varios segmentos TCP y Wireshark la reconstruye en el paquete donde la decodifica completa (el 12).

- (12) HTTP/1.1 200 OK  
HTTP/1.1 200 OK (text/html)  
AquÃ­ Wireshark ya puede interpretar la cabecera HTTP y el contenido HTML (parte o todo).

- (13) ACK del cliente  
El cliente confirma recepciÃ³n (Ack=1441, etc.).  
En resumen: la web se entrega correctamente.



## 5) Cierre de conexiÃ³n TCP (paquetes 14â€“17)
AquÃ­ vemos un cierre ordenado (no Reset).

- (14) ACK (cliente â†’ servidor)  
ACK intermedio, tÃ­pico al finalizar la transferencia.

- (15) FIN,ACK (cliente â†’ servidor)  
El cliente inicia el cierre:  
51616 â†’ 80 [FIN, ACK]

- (16) FIN,ACK (servidor â†’ cliente)  
El servidor responde cerrando su lado:  
80 â†’ 51616 [FIN, ACK]

- (17) ACK final (cliente â†’ servidor)  
51616 â†’ 80 [ACK]  
Cierre completo.

ðŸ“Œ ObservaciÃ³n: el cierre ocurre muy rÃ¡pido tras el 200 OK (la pÃ¡gina es pequeÃ±a).


## ConclusiÃ³n
Este pcap representa un flujo TCP/IP estÃ¡ndar de acceso web HTTP:
- ARP para conocer la MAC del gateway
- DNS para resolver www.example.com â†’ 93.184.216.34
- TCP 3-Way Handshake (SYN / SYN-ACK / ACK)
- HTTP GET y respuesta 200 OK (HTML) con segmentaciÃ³n TCP y reensamblado
- Cierre TCP correcto con FIN/ACK en ambas direcciones

## Filtros wireshark interesantes

| CategorÃ­a           | Objetivo                                                 | Filtro (Display Filter)                                           |   |        |   |        |
| ------------------- | -------------------------------------------------------- | ----------------------------------------------------------------- | - | ------ | - | ------ |
| **Base**            | Todo TCP                                                 | `tcp`                                                             |   |        |   |        |
| **Base**            | ConexiÃ³n con el servidor (example.com)                   | `ip.addr == 93.184.216.34 && tcp.port == 80`                      |   |        |   |        |
| **Base**            | Todo lo que toca tu host                                 | `ip.addr == 192.168.1.33`                                         |   |        |   |        |
| **Handshake**       | SYN (inicio conexiÃ³n)                                    | `tcp.flags.syn == 1 && tcp.flags.ack == 0`                        |   |        |   |        |
| **Handshake**       | SYN-ACK (respuesta servidor)                             | `tcp.flags.syn == 1 && tcp.flags.ack == 1`                        |   |        |   |        |
| **Handshake**       | Solo el handshake de esa conexiÃ³n (puerto cliente 51616) | `ip.addr == 93.184.216.34 && tcp.port == 80 && tcp.port == 51616` |   |        |   |        |
| **Cierre**          | FIN (cierre ordenado)                                    | `tcp.flags.fin == 1`                                              |   |        |   |        |
| **Cierre**          | RST (cierre abrupto/reset)                               | `tcp.flags.rst == 1`                                              |   |        |   |        |
| **AnÃ¡lisis TCP**    | Retransmisiones                                          | `tcp.analysis.retransmission`                                     |   |        |   |        |
| **AnÃ¡lisis TCP**    | Fast retransmission                                      | `tcp.analysis.fast_retransmission`                                |   |        |   |        |
| **AnÃ¡lisis TCP**    | Duplicate ACK                                            | `tcp.analysis.duplicate_ack`                                      |   |        |   |        |
| **AnÃ¡lisis TCP**    | Out of order                                             | `tcp.analysis.out_of_order`                                       |   |        |   |        |
| **AnÃ¡lisis TCP**    | Zero window                                              | `tcp.analysis.zero_window`                                        |   |        |   |        |
| **HTTP**            | Todo HTTP                                                | `http`                                                            |   |        |   |        |
| **HTTP**            | Solo GET                                                 | `http.request.method == "GET"`                                    |   |        |   |        |
| **HTTP**            | Respuestas 200 OK                                        | `http.response.code == 200`                                       |   |        |   |        |
| **HTTP**            | GET a la raÃ­z `/`                                        | `http.request.uri == "/"`                                         |   |        |   |        |
| **HTTP**            | Host contiene â€œexampleâ€                                  | `http.host contains "example"`                                    |   |        |   |        |
| **DNS/ARP**         | Todo DNS                                                 | `dns`                                                             |   |        |   |        |
| **DNS/ARP**         | Solo queries (preguntas)                                 | `dns.flags.response == 0`                                         |   |        |   |        |
| **DNS/ARP**         | Solo respuestas (answers)                                | `dns.flags.response == 1`                                         |   |        |   |        |
| **DNS/ARP**         | DNS solo de [www.example.com](http://www.example.com)    | `dns.qry.name == "www.example.com"`                               |   |        |   |        |
| **DNS/ARP**         | Todo ARP                                                 | `arp`                                                             |   |        |   |        |
| **TamaÃ±o**          | TCP con datos (sin ACK â€œvacÃ­osâ€)                         | `tcp.len > 0`                                                     |   |        |   |        |
| **TamaÃ±o**          | Segmentos TCP grandes (>1000 bytes)                      | `tcp.len > 1000`                                                  |   |        |   |        |
| **Direcciones**     | Cliente â†’ servidor (subida)                              | `ip.src == 192.168.1.33 && ip.dst == 93.184.216.34`               |   |        |   |        |
| **Direcciones**     | Servidor â†’ cliente (bajada)                              | `ip.src == 93.184.216.34 && ip.dst == 192.168.1.33`               |   |        |   |        |



- Combo (reporte) | Flujo web completo (DNS + TCP + HTTP) : `(dns && dns.qry.name == "www.example.com") || (ip.addr == 93.184.216.34 && (tcp || http))`
- Combo (reporte) | Solo TCP/HTTP con el servidor: `ip.addr == 93.184.216.34 && (tcp.port == 80 || http)`
