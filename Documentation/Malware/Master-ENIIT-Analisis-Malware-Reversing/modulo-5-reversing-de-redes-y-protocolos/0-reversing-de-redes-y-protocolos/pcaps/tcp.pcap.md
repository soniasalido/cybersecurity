
![tcp.pcap](capturas/tcp.pcap.png)

Esta captura muestra una comunicaci√≥n TCP local (LAN) muy ‚Äúlimpia‚Äù, con el patr√≥n t√≠pico request ‚Üí response:
- Cliente: 192.168.1.110:64118
- Servidor: 192.168.1.33:8000
- Y consta de: ARP ‚Üí 3-way handshake ‚Üí env√≠o peque√±o del cliente ‚Üí cierre del cliente (FIN) ‚Üí respuesta grande del servidor ‚Üí FIN del servidor ‚Üí ACK final.


## 1) Resoluci√≥n en la LAN: ARP (paquetes 1‚Äì2)
- (1) ARP Request   
Who has 192.168.1.33? Tell 192.168.1.110  
El cliente (192.168.1.110) necesita saber la MAC del host 192.168.1.33 antes de enviarle tr√°fico IP.

- (2) ARP Reply  
192.168.1.33 is at 00:15:5d:38:01:04  
Respuesta con la MAC del destino. A partir de aqu√≠ ya puede iniciar TCP.

## 2) Establecimiento de conexi√≥n TCP (3-way handshake) (paquetes 3‚Äì5)
- (3) SYN (cliente ‚Üí servidor)  
64118 ‚Üí 8000 [SYN]  
Opciones importantes:
  - MSS=1460
  - SACK Permitted
  - Window Scaling WS=256

- (4) SYN, ACK (servidor ‚Üí cliente)  
8000 ‚Üí 64118 [SYN, ACK]
Opciones importantes:
  - MSS=1460
  - SACK Permitted
  - WS=128

- (5) ACK (cliente ‚Üí servidor)  
64118 ‚Üí 8000 [ACK]  
Con esto, la conexi√≥n queda establecida.


üìå El handshake ocurre en microsegundos (tr√°fico local), sin retransmisiones.


## 3) Intercambio de datos: petici√≥n peque√±a del cliente (paquetes 6‚Äì7)
- (6) Datos del cliente (request)  
64118 ‚Üí 8000 [PSH, ACK] Len=12  
El cliente env√≠a 12 bytes (muy poco). Esto suele ser:
  - una consulta corta,
  - un comando,
  - o un ‚Äútrigger‚Äù para que el servidor responda.
![tcp.pcap-paquete-6](capturas/tcp.pcap-paquete6.png)

`[PSH, ACK] ... Len=12`
Eso significa:
  - No es un ACK vac√≠o (los ACK puros suelen tener Len=0)
  - Este segmento TCP lleva carga √∫til (payload) de 12 bytes
  - Por lo tanto, hay datos de aplicaci√≥n viajando en ese paquete
  - ‚úÖ Conclusi√≥n: si ves Len > 0, est√°s viendo intercambio de datos.

Los flags `PSH`, `ACK` son t√≠picos de ‚Äúenv√≠o inmediato‚Äù de datos. En TCP, cuando ves:
  - `PSH` ‚Üí ‚Äúempuja‚Äù los datos a la aplicaci√≥n cuanto antes (no esperes a llenar buffers)
  - `ACK` ‚Üí confirma datos recibidos previamente


Data: 7463705f636c69656e742e63:
  - En el hexdump se ven bytes que NO son cabeceras
  - En la parte derecha (hex/ASCII) del paquete 6 aparecen bytes del payload: `74 63 70 5f 63 6c 69 65 6e 74 2e 63`
  - Eso en ASCII corresponde a texto legible: tcp_client.c (12 caracteres)

üìå Es decir: el cliente est√° enviando literalmente la cadena "tcp_client.c" dentro del segmento TCP.


- (7) ACK del servidor  
8000 ‚Üí 64118 [ACK] Ack=13  
El servidor confirma que recibi√≥ esos 12 bytes.


## 4) El cliente cierra su env√≠o (half-close) (paquete 8)
- (8) FIN del cliente  
64118 ‚Üí 8000 [FIN, ACK] Seq=13  
Esto es clave: el cliente hace un FIN inmediatamente despu√©s del request.

‚úÖ Significa: ‚Äúyo ya no voy a enviar m√°s datos‚Äù pero todav√≠a puede recibir datos del servidor.

Este comportamiento es t√≠pico en protocolos tipo:
  - ‚Äúmando petici√≥n y espero respuesta‚Äù
  - descarga de datos tras una orden


## 5) Respuesta grande del servidor (paquetes 9‚Äì12)
Despu√©s del FIN del cliente, el servidor responde enviando bastante informaci√≥n:  
- (9) Segmento 1 del servidor  
8000 ‚Üí 64118 Len=1460 Ack=14  
Env√≠a datos y a la vez ACKea el FIN del cliente (Ack=14).

- (10) Segmento 2  
Len=1460  

- (11) Segmento 3  
[PSH, ACK] Len=1176

‚úÖ Hasta aqu√≠ el servidor env√≠a: 1460 + 1460 + 1176 = 4096 bytes exactos (4 KB)

- (12) √öltimo segmento + cierre del servidor  
[FIN, PSH, ACK] Len=882  
Env√≠a el √∫ltimo bloque (882 bytes)  
y en el mismo paquete incluye FIN (cierre del servidor)

üìå Total de datos del servidor: 4096 + 882 = 4978 bytes


## 6) ACK final del cliente (paquete 13)
- (13) ACK del cliente  
64118 ‚Üí 8000 [ACK] Ack=4980  
Este ACK confirma:
  - todos los datos recibidos
  - y el FIN del servidor (por eso el Ack llega a 4980)

‚úÖ Con esto la conexi√≥n queda cerrada correctamente (sin RST).

## Conclusi√≥n t√©cnica
Esta traza representa un flujo TCP perfectamente normal y sin errores, con patr√≥n:
- ARP para resolver MAC
- Handshake TCP (SYN/SYN-ACK/ACK)
- Cliente env√≠a 12 bytes (petici√≥n)
- Cliente hace FIN (cierra su lado de env√≠o)
- Servidor responde con ~5 KB y luego cierra (FIN)
- Cliente confirma con ACK final
