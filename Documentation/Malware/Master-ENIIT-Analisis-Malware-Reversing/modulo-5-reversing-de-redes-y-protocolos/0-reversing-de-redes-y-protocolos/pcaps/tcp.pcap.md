
![tcp.pcap](capturas/tcp.pcap.png)

Esta captura muestra una comunicaciÃ³n TCP local (LAN) muy â€œlimpiaâ€, con el patrÃ³n tÃ­pico request â†’ response:
- Cliente: 192.168.1.110:64118
- Servidor: 192.168.1.33:8000
- Y consta de: ARP â†’ 3-way handshake â†’ envÃ­o pequeÃ±o del cliente â†’ cierre del cliente (FIN) â†’ respuesta grande del servidor â†’ FIN del servidor â†’ ACK final.


## 1) ResoluciÃ³n en la LAN: ARP (paquetes 1â€“2)
- (1) ARP Request   
Who has 192.168.1.33? Tell 192.168.1.110  
El cliente (192.168.1.110) necesita saber la MAC del host 192.168.1.33 antes de enviarle trÃ¡fico IP.

- (2) ARP Reply  
192.168.1.33 is at 00:15:5d:38:01:04  
Respuesta con la MAC del destino. A partir de aquÃ­ ya puede iniciar TCP.

## 2) Establecimiento de conexiÃ³n TCP (3-way handshake) (paquetes 3â€“5)
- (3) SYN (cliente â†’ servidor)  
64118 â†’ 8000 [SYN]  
Opciones importantes:
  - MSS=1460
  - SACK Permitted
  - Window Scaling WS=256

- (4) SYN, ACK (servidor â†’ cliente)  
8000 â†’ 64118 [SYN, ACK]
Opciones importantes:
  - MSS=1460
  - SACK Permitted
  - WS=128

- (5) ACK (cliente â†’ servidor)  
64118 â†’ 8000 [ACK]  
Con esto, la conexiÃ³n queda establecida.


ğŸ“Œ El handshake ocurre en microsegundos (trÃ¡fico local), sin retransmisiones.


## 3) Intercambio de datos: peticiÃ³n pequeÃ±a del cliente (paquetes 6â€“7)
- (6) Datos del cliente (request)  
64118 â†’ 8000 [PSH, ACK] Len=12  
El cliente envÃ­a 12 bytes (muy poco). Esto suele ser:
  - una consulta corta,
  - un comando,
  - o un â€œtriggerâ€ para que el servidor responda.

- (7) ACK del servidor  
8000 â†’ 64118 [ACK] Ack=13  
El servidor confirma que recibiÃ³ esos 12 bytes.


## 4) El cliente cierra su envÃ­o (half-close) (paquete 8)
- (8) FIN del cliente  
64118 â†’ 8000 [FIN, ACK] Seq=13  
Esto es clave: el cliente hace un FIN inmediatamente despuÃ©s del request.

âœ… Significa: â€œyo ya no voy a enviar mÃ¡s datosâ€ pero todavÃ­a puede recibir datos del servidor.

Este comportamiento es tÃ­pico en protocolos tipo:
  - â€œmando peticiÃ³n y espero respuestaâ€
  - descarga de datos tras una orden


## 5) Respuesta grande del servidor (paquetes 9â€“12)
DespuÃ©s del FIN del cliente, el servidor responde enviando bastante informaciÃ³n:  
- (9) Segmento 1 del servidor  
8000 â†’ 64118 Len=1460 Ack=14  
EnvÃ­a datos y a la vez ACKea el FIN del cliente (Ack=14).

- (10) Segmento 2  
Len=1460  

- (11) Segmento 3  
[PSH, ACK] Len=1176

âœ… Hasta aquÃ­ el servidor envÃ­a: 1460 + 1460 + 1176 = 4096 bytes exactos (4 KB)

- (12) Ãšltimo segmento + cierre del servidor  
[FIN, PSH, ACK] Len=882  
EnvÃ­a el Ãºltimo bloque (882 bytes)  
y en el mismo paquete incluye FIN (cierre del servidor)

ğŸ“Œ Total de datos del servidor: 4096 + 882 = 4978 bytes
