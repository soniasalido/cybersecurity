
## SHA-1
**<mark>Las siglas SHA corresponden a Algoritmo de Hash Seguro</mark>**, un algoritmo de resumen propuesto por la `NSA` y adoptado como est√°ndar Federal por el `NIST` (National Institute of Standards and Technology) en 1993. Antes de los 2 a√±os se detectan vulnerabilidades por lo en 1995 proponen un nuevo algoritmo conocido como `SHA 1`, pasando el anterior a denominarse `SHA 0`, y no recomendarse su uso.


**<mark>El dise√±o de `SHA 1` es muy similar al de `md5`</mark>**. MD5 y SHA-1 son funciones hash criptogr√°ficas. Toman un mensaje de cualquier tama√±o (un archivo, un texto, etc.) y devuelven una `‚Äúhuella‚Äù fija llamada resumen o digest.`
- **Tama√±o del digest (resumen):**
  - MD5 produce 128 bits ‚Üí 16 bytes ‚Üí 32 caracteres hexadecimales.
  - SHA-1 produce 160 bits ‚Üí 20 bytes ‚Üí 40 caracteres hexadecimales.
    
  M√°s bits = m√°s combinaciones posibles de huellas. Cuantas m√°s combinaciones tengamos, m√°s dif√≠cil es encontrar dos mensajes distintos con la misma huella (colisi√≥n) o recuperar el mensaje original (preimagen).

**<mark>Una funci√≥n hash no cifra</mark>, sino que crea un resumen o ¬´firma¬ª de un conjunto de datos, que es pasado como par√°metro a esta funci√≥n.**

**<mark>SHA1 es √∫til para verificar la integridad</mark>, por ejemplo, de un archivo.** Aplicamos dicha funci√≥n sobre un archivo verificamos que el hash obtenido es el mismo que el anunciado por el emisor.


**<mark>Paradoja del cumplea√±os:</mark>** la dificultad de colisi√≥n crece como 2<sup>(n/2)</sup>, siendo n los bits del hash.
- MD5 (128 bits) ‚âà 2<sup>64</sup> intentos.
- SHA-1 (160 bits) ‚âà 2<sup>80</sup> intentos.
Por eso, SHA-1 era considerado m√°s robusto que MD5: su digest es m√°s largo y, en dise√±o, mejora algunas partes.


## Esquema del algoritmo SHA-1
Al igual que en md5, el mensaje se agrupa en bloques de 512 bits con 16 palabras de 32 bits. Para completar el √∫ltimo bloque de 512 bits, se aplicar√° un relleno de un 1, seguido de tantos 0 como sea necesario, reservando los √∫ltimos 64 bits para indicar el tama√±o del mensaje o archivo. Internamente **<mark>SHA1 trata las palabras en representaci√≥n Big Endian</mark>**, es decir, primero se leen los bytes m√°s significativos y despu√©s, los bytes menos significativos (manera natural a la que estamos acostumbrados).

Por ejemplo la palabra de 32 bits "amor", que en hexadecimal es: `41 6D 6F 72`, se leer√°: `41 6D 6F 72`.

**<mark>SHA1 usa 5 vectores p√∫blicos de 32 bits, conocidos como `A, B, C, D y E` que se mezclar√°n con las palabras del texto en claro, tambi√©n de 32 bits.</mark>** Realizando para cada bloque de entrada de 512 bits, un total de 80 vueltas. Terminadas las primeras 80 vueltas, los vectores iniciales `A, B, C, D y E` habr√°n cambiado varias veces de valor y ser√°n los nuevos 5 vectores que se mezclar√°n con el segundo bloque de 512 bits de entrada. Esta acci√≥n se va encadenando con los siguientes bloques, hasta que el √∫ltimo valor de los vectores `A, B, C, D y E` es el resumen de 160 bits de todo el documento.

## Las 80 vueltas de SHA1
A cada bloque del texto de entrada se le aplicar√°n 20 vueltas con 4 funciones distintas, de forma tal que el n√∫mero total de vueltas por bloque ser√° igual a 20 *4 = 80.

Pero, ¬øc√≥mo podemos generar 80 palabras de 32 bits a partir s√≥lo de los 512 bits de entrada? Cada bloque de 16 palabras del mensaje se expandir√° en 80 palabras, de forma que las palabras 0 a 15 se corresponden a los 512 bits del bloque y las 64 palabras restantes, de la 16 a la 79, se obtienen mediante una operaci√≥n l√≥gica entre las palabras anteriores.

## La fortaleza de SHA1

### ¬øQu√© es ‚Äúparadoja del cumplea√±os‚Äù en hashes?
**<mark>Para un hash de n bits, el coste esperado de encontrar una colisi√≥n por fuerza bruta (dos mensajes cualesquiera con el mismo hash) no es 2<sup>ùëõ</sup>, sino ~2<sup>ùëõ/2</sup>.  A esto se le llama l√≠mite de cumplea√±os.</mark>**

Para SHA-1, ùëõ = 160 ‚Üí l√≠mite ideal ‚âà 2<sup>80</sup> evaluaciones del hash.

### Qu√© pas√≥ con SHA-1 en la pr√°ctica

La criptoan√°lisis redujo ese coste muy por debajo de 2<sup>80</sup>:
- 2017 (SHAttered): colisi√≥n pr√°ctica con complejidad ~2<sup>63</sup> (orden de magnitud), muy inferior al ideal.
- 2020 (‚ÄúSHA-1 is a Shambles‚Äù): colisi√≥n de prefijo elegido tambi√©n con coste ~2<sup>63</sup> (orden de magnitud).

Es decir: no baj√≥ ‚Äúa menos de 2<sup>50</sup>‚Äù en ataques reales al SHA-1 completo; los mejores ataques pr√°cticos est√°n en torno a 2<sup>63</sup> (en equivalentes de evaluaciones de la funci√≥n de compresi√≥n), que ya es devastador para seguridad.

### Conclusi√≥n 
- Fortaleza de colisi√≥n de SHA-1: cay√≥ de ~2<sup>80</sup> (ideal) a ~2<sup>63</sup> (ataques pr√°cticos).
- Eso es preocupante (y suficiente para retirar SHA-1 de usos de seguridad: firmas, certificados, integridad con adversario).
- Se pas√≥ a SHA-256 (colisi√≥n ideal ~2<sup>128</sup> o SHA-3-256/BLAKE2/3.

### Tabla r√°pida (coste ideal por paradoja del cumplea√±os)
| Algoritmo               | Bits del hash (n) | Colisi√≥n ideal ‚âà (2<sup>n/2</sup>) | Nota pr√°ctica conocida                                                              |
| ----------------------- | ----------------: | -------------------------: | ----------------------------------------------------------------------------------- |
| **SHA-1**               |               160 |                   (2<sup>80</sup>) | Colisiones **pr√°cticas** ‚âà (2<sup>63</sup>) (SHAttered, 2017; CPC 2020) ‚Üí **desaconsejado** |
| **SHA-256** (SHA-2)     |               256 |                  (2<sup>128</sup>) | Sin colisiones conocidas                                                            |
| **SHA-3-256** (Keccak)  |               256 |                  (2<sup>128</sup>) | Sin colisiones conocidas                                                            |
| **SHA-512/256** (SHA-2) |               256 |                  (2<sup>128</sup>) | Sin colisiones conocidas                                                            |
| **BLAKE2s/BLAKE3-256**  |               256 |                  (2<sup>128</sup>) | Sin colisiones conocidas                                                            |


## Demostraci√≥n de colisi√≥n en SHA-1 - SHAttered
10 a√±os despu√©s de la introducci√≥n del algoritmo SHA-1 como funci√≥n hash, se anunci√≥ la primera t√©cnica pr√°ctica para generar una colisi√≥n. Esto es dado un ¬´archivo A¬´, generar otro ¬´archivo B¬ª que produzca el mismo hash que el del ¬´archivo A¬´.

Tras dos a√±os de investigaci√≥n y la colaboraci√≥n del CWI Institute en Amsterdamy Google, este equipo de investigadores consigui√≥ crear un m√©todo para generar colisiones. Como prueba del ataque, publican dos archivos PDF que tienen hash SHA-1 id√©nticos pero con contenido diferente (PDF 1 y PDF 2).


## Referencias
[P√≠ldora 45 - C√≥mo funciona el hash SHA-1]https://www.youtube.com/watch?v=pG8785ZEFuM&list=PL8bSwVy8_IcNNS5QDLjV7gUg8dIeMFSER&index=45


https://unaaldia.hispasec.com/2017/02/demostracion-practica-de-colision-en-sha-1.html
