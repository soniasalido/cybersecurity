## Para practicar con reglas sigma necesitamos:
- Un MV Windows.
- Sysmon de Sysinternals. https://learn.microsoft.com/es-es/sysinternals/downloads/sysmon
- Reglas sigma. https://github.com/SigmaHQ/sigma/tree/master/rules
- Chainsaw. https://github.com/WithSecureLabs/chainsaw

**Sysmon produce la telemetría, Sigma define lo que quemos detectar y Chainsaw aplica esas reglas a los logs.**

## Sysmon
Sysmon = el “sensor” que genera los datos.
Es un servicio en Windows que registra eventos enriquecidos (EVTX): creación de procesos, líneas de comando, árbol padre-hijo, hashes, conexiones de red, cargas de DLL, cambios en el sistema de archivos/registro, etc. (IDs típicos: 1 proceso, 3 red, 7 image load, 10 registry, 11 file create, 22 DNS…).

### Instalación de Sysmon.
- Descargamos Sysmon.
- Descargamos una buena configuración. Para ello usaremos `sysmonconfig-export.xml` del repo de SwiftOnSecurity (es una configuración popular y mantenida). https://github.com/SwiftOnSecurity/sysmon-config
- Instalamos con esa configuración (CMD/PowerShell como Admin)
  ```
  cd C:\ruta\al\zip\extraido
  .\sysmon64.exe -accepteula -i C:\ruta\sysmonconfig-export.xml
  ```
  Eso instala el servicio y activa los eventos más relevantes (procesos, red, etc.). 
- Verificamos que está registrando: Abrimos el Visor de eventos → Applications and Services Logs → Microsoft → Windows → Sysmon → Operational. Deben aparecer eventos (p. ej., Event ID 1 creación de procesos).

## Sigma
Son las “reglas” que describen patrones sospechosos sobre esos eventos. No recolecta ni ejecuta nada por sí sola: define qué buscar (p. ej., CommandLine contiene -EncodedCommand en Event ID 1).
Descargamos reglas sigma y las intalamos en el path `C:\sigma\rules\`. Puede ser un repo clonado de SigmaHQ: https://github.com/SigmaHQ/sigma/tree/master/rules

## Chainsaw
Chainsaw = el motor de “búsqueda” offline. Toma los EVTX que generó Sysmon y evalúa las reglas Sigma contra ellos (usando un mapping de campos) para decirte qué coincidencias hay.

Instalación de chainsaw:
- Descargamos chainsaw: https://github.com/WithSecureLabs/chainsaw/releases
- Creación de las carpetas:
  ```
  New-Item -ItemType Directory -Force -Path C:\tools\chainsaw | Out-Null
  New-Item -ItemType Directory -Force -Path C:\sigma\mappings | Out-Null
  ```
- Extraemos y movemos contenido al path C:\tools\chainsaw
- Verificamos que el binario está accesible: `C:\tools\chainsaw\chainsaw.exe --version`
- Descargamos un mapping listo para Windows. Chainsaw trae mapeos de ejemplo; el más cómodo para empezar es `mappings/sigma-event-logs-all.yml` del propio repo de Chainsaw. Copiamos este fichero al path: `C:\sigma\mappings\`.
- Pueba rápida: Con sysmon generando eventos, lanzamos una caza básica sobre los EVTX del sistema:
  ```
  chainsaw.exe hunt "C:\Windows\System32\winevt\Logs" `
  --sigma "C:\sigma\rules" `
  --mapping "C:\sigma\mappings\sigma-event-logs-all.yml" `
  --json -o C:\tools\chainsaw\findings.json
  ```

