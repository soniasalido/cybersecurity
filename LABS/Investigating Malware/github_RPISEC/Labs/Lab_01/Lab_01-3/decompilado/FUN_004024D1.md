```
                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             undefined __stdcall FUN_004024d1(void)
                               assume FS_OFFSET = 0xffdff000
             undefined         <UNASSIGNED>   <RETURN>
                             FUN_004024d1                                    XREF[1]:     FUN_00401681:0040170f(c)
        004024d1 53              PUSH       EBX
        004024d2 33 db           XOR        EBX,EBX
        004024d4 39 1d 48        CMP        dword ptr [DAT_00406e48],EBX                     = 00000001h
                 6e 40 00
        004024da 56              PUSH       ESI
        004024db 57              PUSH       EDI
        004024dc 75 05           JNZ        LAB_004024e3
        004024de e8 b1 14        CALL       FUN_00403994                                     undefined FUN_00403994(void)
                 00 00
                             LAB_004024e3                                    XREF[1]:     004024dc(j)
        004024e3 8b 35 40        MOV        ESI,dword ptr [DAT_00406940]
                 69 40 00
        004024e9 33 ff           XOR        EDI,EDI
                             LAB_004024eb                                    XREF[1]:     00402501(j)
        004024eb 8a 06           MOV        AL,byte ptr [ESI]
        004024ed 3a c3           CMP        AL,BL
        004024ef 74 12           JZ         LAB_00402503
        004024f1 3c 3d           CMP        AL,0x3d
        004024f3 74 01           JZ         LAB_004024f6
        004024f5 47              INC        EDI
                             LAB_004024f6                                    XREF[1]:     004024f3(j)
        004024f6 56              PUSH       ESI
        004024f7 e8 84 ef        CALL       _strlen                                          size_t _strlen(char * _Str)
                 ff ff
        004024fc 59              POP        ECX
        004024fd 8d 74 06 01     LEA        ESI,[ESI + EAX*0x1 + 0x1]
        00402501 eb e8           JMP        LAB_004024eb
                             LAB_00402503                                    XREF[1]:     004024ef(j)
        00402503 8d 04 bd        LEA        EAX,[EDI*0x4 + 0x4]
                 04 00 00 00
        0040250a 50              PUSH       EAX
        0040250b e8 45 0d        CALL       _malloc                                          void * _malloc(size_t _Size)
                 00 00
        00402510 8b f0           MOV        ESI,EAX
        00402512 59              POP        ECX
        00402513 3b f3           CMP        ESI,EBX
        00402515 89 35 80        MOV        dword ptr [DAT_00406980],ESI                     = 00A70E00h
                 69 40 00
        0040251b 75 08           JNZ        LAB_00402525
        0040251d 6a 09           PUSH       0x9
        0040251f e8 3c f2        CALL       __amsg_exit                                      void __amsg_exit(int param_1)
                 ff ff
        00402524 59              POP        ECX
                             LAB_00402525                                    XREF[1]:     0040251b(j)
        00402525 8b 3d 40        MOV        EDI,dword ptr [DAT_00406940]
                 69 40 00
        0040252b 38 1f           CMP        byte ptr [EDI],BL
        0040252d 74 39           JZ         LAB_00402568
        0040252f 55              PUSH       EBP
                             LAB_00402530                                    XREF[1]:     00402565(j)
        00402530 57              PUSH       EDI
        00402531 e8 4a ef        CALL       _strlen                                          size_t _strlen(char * _Str)
                 ff ff
        00402536 8b e8           MOV        EBP,EAX
        00402538 59              POP        ECX
        00402539 45              INC        EBP
        0040253a 80 3f 3d        CMP        byte ptr [EDI],0x3d
        0040253d 74 22           JZ         LAB_00402561
        0040253f 55              PUSH       EBP
        00402540 e8 10 0d        CALL       _malloc                                          void * _malloc(size_t _Size)
                 00 00
        00402545 3b c3           CMP        EAX,EBX
        00402547 59              POP        ECX
        00402548 89 06           MOV        dword ptr [ESI],EAX
        0040254a 75 08           JNZ        LAB_00402554
        0040254c 6a 09           PUSH       0x9
        0040254e e8 0d f2        CALL       __amsg_exit                                      void __amsg_exit(int param_1)
                 ff ff
        00402553 59              POP        ECX
                             LAB_00402554                                    XREF[1]:     0040254a(j)
        00402554 57              PUSH       EDI
        00402555 ff 36           PUSH       dword ptr [ESI]
        00402557 e8 84 0f        CALL       FUN_004034e0                                     uint * FUN_004034e0(uint * param
                 00 00
        0040255c 59              POP        ECX
        0040255d 83 c6 04        ADD        ESI,0x4
        00402560 59              POP        ECX
                             LAB_00402561                                    XREF[1]:     0040253d(j)
        00402561 03 fd           ADD        EDI,EBP
        00402563 38 1f           CMP        byte ptr [EDI],BL
        00402565 75 c9           JNZ        LAB_00402530
        00402567 5d              POP        EBP
                             LAB_00402568                                    XREF[1]:     0040252d(j)
        00402568 ff 35 40        PUSH       dword ptr [DAT_00406940]
                 69 40 00
        0040256e e8 38 0f        CALL       FUN_004034ab                                     undefined FUN_004034ab(uint para
                 00 00
        00402573 59              POP        ECX
        00402574 89 1d 40        MOV        dword ptr [DAT_00406940],EBX
                 69 40 00
        0040257a 89 1e           MOV        dword ptr [ESI],EBX
        0040257c 5f              POP        EDI
        0040257d 5e              POP        ESI
        0040257e c7 05 44        MOV        dword ptr [DAT_00406e44],0x1                     = 01h
                 6e 40 00
                 01 00 00 00
        00402588 5b              POP        EBX
        00402589 c3              RET
```

✅ Conclusión

FUN_004024D1 prepara una tabla dinámica con claves de entorno válidas, limpiando las originales y dejando todo en una estructura interna para su uso posterior.
Es muy probable que el malware use esa tabla para configurar sus conexiones, comportamiento o autenticación.

