```
                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             undefined __stdcall FUN_10001c20(HMODULE param_1, int pa
                               assume FS_OFFSET = 0xffdff000
             undefined         <UNASSIGNED>   <RETURN>
             HMODULE           Stack[0x4]:4   param_1                                 XREF[1]:     10001c39(R)  
             int               Stack[0x8]:4   param_2                                 XREF[1]:     10001c33(R)  
             undefined4        Stack[-0x8]:4  local_8                                 XREF[2]:     10001c30(W), 
                                                                                                   10001caf(R)  
             undefined1        Stack[-0x808   local_808                               XREF[2]:     10001c53(*), 
                                                                                                   10001c67(*)  
             undefined4        Stack[-0x80c   local_80c                               XREF[3]:     10001c77(W), 
                                                                                                   10001c7d(R), 
                                                                                                   10001c8b(R)  
                             FUN_10001c20                                    XREF[2]:     FUN_1000259a:100025fe(c), 
                                                                                          FUN_1000259a:10002616(c)  
        10001c20 55              PUSH       EBP
        10001c21 8b ec           MOV        EBP,ESP
        10001c23 81 ec 08        SUB        ESP,0x808
                 08 00 00
        10001c29 a1 04 60        MOV        EAX,[DAT_10006004]                               = BB40E64Eh
                 00 10
        10001c2e 33 c5           XOR        EAX,EBP
        10001c30 89 45 fc        MOV        dword ptr [EBP + local_8],EAX
        10001c33 83 7d 0c 01     CMP        dword ptr [EBP + param_2],0x1
        10001c37 75 71           JNZ        LAB_10001caa
        10001c39 8b 45 08        MOV        EAX,dword ptr [EBP + param_1]
        10001c3c a3 88 65        MOV        [DAT_10006588],EAX
                 00 10
        10001c41 8b 0d 88        MOV        ECX,dword ptr [DAT_10006588]
                 65 00 10
        10001c47 51              PUSH       ECX
        10001c48 ff 15 14        CALL       dword ptr [->KERNEL32.DLL::DisableThreadLibrar   = 000054c2
                 40 00 10
        10001c4e 68 00 04        PUSH       0x400
                 00 00
        10001c53 8d 95 fc        LEA        EDX=>local_808,[EBP + 0xfffff7fc]
                 f7 ff ff
        10001c59 52              PUSH       EDX
        10001c5a 6a 00           PUSH       0x0
        10001c5c ff 15 18        CALL       dword ptr [->KERNEL32.DLL::GetModuleFileNameW]   = 000054ac
                 40 00 10
        10001c62 68 00 04        PUSH       0x400
                 00 00
        10001c67 8d 85 fc        LEA        EAX=>local_808,[EBP + 0xfffff7fc]
                 f7 ff ff
        10001c6d 50              PUSH       EAX
        10001c6e ff 15 ec        CALL       dword ptr [->API-MS-WIN-CRT-STRING-L1-1-0.DLL:   = 00005696
                 40 00 10
        10001c74 83 c4 08        ADD        ESP,0x8
        10001c77 89 85 f8        MOV        dword ptr [EBP + local_80c],EAX
                 f7 ff ff
        10001c7d 83 bd f8        CMP        dword ptr [EBP + local_80c],0xc
                 f7 ff ff 0c
        10001c84 7e 24           JLE        LAB_10001caa
        10001c86 68 80 43        PUSH       u_explorer.exe_10004380                          = u"explorer.exe"
                 00 10
        10001c8b 8b 8d f8        MOV        ECX,dword ptr [EBP + local_80c]
                 f7 ff ff
        10001c91 8d 94 4d        LEA        EDX,[EBP + ECX*0x2 + 0xfffff7e4]
                 e4 f7 ff ff
        10001c98 52              PUSH       EDX
        10001c99 ff 15 f0        CALL       dword ptr [->API-MS-WIN-CRT-STRING-L1-1-0.DLL:   = 000056a0
                 40 00 10
        10001c9f 83 c4 08        ADD        ESP,0x8
        10001ca2 85 c0           TEST       EAX,EAX
        10001ca4 75 04           JNZ        LAB_10001caa
        10001ca6 33 c0           XOR        EAX,EAX
        10001ca8 eb 05           JMP        LAB_10001caf
                             LAB_10001caa                                    XREF[3]:     10001c37(j), 10001c84(j), 
                                                                                          10001ca4(j)  
        10001caa b8 01 00        MOV        EAX,0x1
                 00 00
                             LAB_10001caf                                    XREF[1]:     10001ca8(j)  
        10001caf 8b 4d fc        MOV        ECX,dword ptr [EBP + local_8]
        10001cb2 33 cd           XOR        ECX,EBP
        10001cb4 e8 85 06        CALL       __security_check_cookie                          undefined __security_check_cooki
                 00 00
        10001cb9 8b e5           MOV        ESP,EBP
        10001cbb 5d              POP        EBP
        10001cbc c2 0c 00        RET        0xc
        10001cbf cc              ??         CCh

```

erificaci√≥n de longitud y posible inserci√≥n de explorer.exe

CMP local_80c, 0xC
JLE skip
LEA EDX, [EBP + local_80c*2 - 0x81c]
PUSH offset u"explorer.exe"
CALL wcscpy_s

Si la ruta tiene m√°s de 12 caracteres, escribe "explorer.exe" al final del buffer (justo despu√©s de la ruta actual).

Esto puede estar preparando una cadena con la ruta seguida de "explorer.exe":

    Para ejecutar el binario explorer.exe desde esa ruta.

    O como parte de una manipulaci√≥n en memoria de comandos o persistencia (por ejemplo, registro o ejecuci√≥n indirecta desde esa ruta).

    ‚ö†Ô∏è Esto es sospechoso. Una DLL leg√≠tima no modifica su propia ruta para a√±adir ejecutables conocidos.

üîπ 7. Valor de retorno

MOV EAX, 1
...
RET 0xc

Retorna 1 (√©xito) si todo va bien, o 0 si hay error en wcscpy_s.
üîπ 8. Verificaci√≥n del cookie de seguridad

CALL __security_check_cookie

Protecci√≥n est√°ndar contra exploits de desbordamiento de pila. Este tipo de verificaci√≥n es com√∫n en compilaciones modernas (Visual Studio).
üß© Comportamiento sospechoso o malicioso
Comportamiento	Interpretaci√≥n
Manipulaci√≥n de ruta propia + "explorer.exe"	Posible intento de persistencia, enga√±o, o ejecuci√≥n indirecta (por ejemplo, mediante copia renombrada o creaci√≥n de procesos falsos).
Uso de DisableThreadLibraryCalls	T√©cnica com√∫n en malware para evitar notificaciones innecesarias a DllMain, simplificando el flujo de ejecuci√≥n y reduciendo puntos de detecci√≥n.
Esquema personalizado en lugar de DllMain	Suele indicar c√≥digo inyectado, loader o packer.
‚úÖ Conclusi√≥n

Esta funci√≥n:

    Se ejecuta solo en DLL_PROCESS_ATTACH.

    Obtiene su propia ruta, calcula su longitud.

    Si la longitud lo permite, modifica el final del buffer para incluir "explorer.exe", lo cual es muy sospechoso.

    Usa protecciones de seguridad t√≠picas de ejecutables leg√≠timos, lo que sugiere que fue compilado con Visual Studio y quiz√° empaquetado/modificado.
    
------------------------
üß† Comportamiento clave
1. Evita llamadas a DllMain de hilos adicionales

CALL dword ptr [KERNEL32.DLL::DisableThreadLibraryCalls]

üëâ Esto es t√≠pico en malware: evita que el sistema invoque DllMain innecesariamente para nuevos hilos.
2. Obtiene la ruta del ejecutable

CALL dword ptr [KERNEL32.DLL::GetModuleFileNameW]

üëâ Guarda la ruta completa del m√≥dulo cargado (suele ser el path del proceso o DLL).
3. Busca si el proceso se llama explorer.exe

CALL ConvertStringToBSTR("explorer.exe")
CALL FUN_10001550(&ptr_modulename)
CALL FUN_10001610(BSTR("explorer.exe"), resultado_anterior)

üëâ Compara el nombre del ejecutable actual con la cadena "explorer.exe".
4. Act√∫a seg√∫n si est√° en explorer.exe

    Si NO est√° en explorer.exe ‚Üí retorna 0

    Si est√° en explorer.exe:

        Inicia COM: CoInitialize(NULL)

        Ejecuta funci√≥n FUN_10001ad0 (clave: instala l√≥gica maliciosa, como dropper o C2)

        Libera objetos COM

        Finaliza COM: CoUninitialize

üìå Funciones auxiliares clave
Funci√≥n	Descripci√≥n
FUN_10001550	Devuelve un puntero a una estructura con el nombre del archivo ejecutable actual
FUN_10001610	Compara si dos cadenas son iguales (probablemente wcscmp)
ConvertStringToBSTR	Crea un objeto BSTR para usarlo con funciones de COM
FUN_10001ad0	Muy importante: es el payload. Suele iniciar la carga maliciosa principal
