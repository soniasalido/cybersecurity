# 02 – Análisis Estático  
**Muestra:** Lab_03-2.malware  
**Curso/Lab:** RPISEC – Investigating Malware – Lab 3.2

---

## 1. Resumen Ejecutivo

El binario analizado corresponde a un **malware Windows de 32 bits**, no empaquetado, con funcionalidades claras de **Command & Control (C2)**, **ejecución remota de comandos**, **transferencia de archivos**, **persistencia mediante el registro** y **enumeración exhaustiva del sistema**.

El análisis estático revela que se trata de un **backdoor clásico**, probablemente de carácter **educativo/laboratorio**, pero con una implementación realista:

- Comunicación directa por sockets TCP (Winsock)
- Protocolo propietario basado en **opcodes**
- Uso de **XOR simple (0x55)** como mecanismo de ofuscación
- Configuración embebida en un **overlay no cifrado**

No se observan técnicas avanzadas de evasión (packing, cifrado fuerte, anti-VM agresivo), lo que facilita el análisis y confirma su naturaleza didáctica.

---

## 2. Identificación General del Binario

| Característica | Valor |
|---------------|------|
| Tipo | PE32 (GUI) |
| Arquitectura | x86 (32 bits) |
| Compilador | Microsoft Visual C++ 6.0 |
| Tamaño | ~37 KB |
| Empaquetado | No |
| Entropía | Media (≈6.3) |
| Firma digital | No |
| SHA-256 | d1bfc02db9922f89da0cef14b514b63af3703f1ab7bd88d558431151bfac92e2 |

**Conclusión:**  
El binario no está ofuscado ni empaquetado, lo que permite un análisis directo del flujo de ejecución y de las funciones internas.

---

## 3. Indicadores de Compromiso (IOCs)

### Hashes
- **SHA-256:** d1bfc02db9922f89da0cef14b514b63af3703f1ab7bd88d558431151bfac92e2
- **Imphash:** F8474D31EC781CFACB7E8F62D7E1F468

### Strings relevantes
- `fxftest`
- `configserver`
- `SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run`
- `cmd.exe`
- `java.exe`
- Rutas en formato corto (`DOCUME~1`)

### Dominio C2
- **us.t28.net**

---

## 4. Arquitectura del Malware

### Flujo General

1. Inicialización del entorno de red (Winsock)
2. Enumeración básica del sistema
3. Resolución DNS del servidor C2
4. Establecimiento de conexión TCP
5. Entrada en bucle principal controlado por opcodes

---

## 5. Comunicación C2

### Características

- **Tipo:** TCP client
- **Puerto:** 443
- **Formato:** binario / texto plano
- **Ofuscación:** XOR con clave 0x55
- **Handshake inicial:** envío de la cadena `fxftest`
- **Respuesta esperada:** 8 bytes

**Hipótesis:**  
El malware depende de una respuesta válida del servidor para continuar la ejecución. En ausencia de esta respuesta, entra en un bucle de espera basado en llamadas a `recv()`.

---

## 6. Protocolo de Comandos (Opcodes)

El análisis estático permitió identificar **13 opcodes**, cada uno asociado a una función específica:

| Opcode | Funcionalidad |
|------|--------------|
| 1 | Enumeración de discos |
| 2 | Listado de archivos |
| 3 | Ejecución de binarios |
| 4 | Eliminación de archivos |
| 5 | Descarga de archivo desde el C2 |
| 6 | Creación de archivo |
| 7 | Enumeración de procesos |
| 8 | Terminación de procesos |
| 9 | Ejecución de comandos del sistema |
| 10 | Interpretación de comandos de texto |
| 11 | Cierre de sesión |
| 12 | Recepción genérica de datos |
| 13 | Control remoto del tiempo de espera (Sleep) |

**Conclusión:**  
La estructura del código confirma que se trata de un **backdoor completamente funcional**, con control remoto detallado del sistema comprometido.

---

## 7. Persistencia

### Técnica identificada

El malware establece persistencia mediante la modificación del registro:

```HKCU\Software\Microsoft\Windows\CurrentVersion\Run```


### API utilizada
- `RegSetValueExA`

**Hipótesis:**  
El malware se ejecutará automáticamente en cada inicio de sesión del usuario.

---

## 8. Uso del Overlay

El binario contiene un **overlay de aproximadamente 512 bytes**, no cifrado y con entropía baja.

Ejemplo de contenido:
```configserver)/r(ndr29(xhhoxxx2)00xAAAAAAAA...```


**Conclusiones:**
- El overlay no contiene código ejecutable
- Actúa como **almacén de configuración**
- Posiblemente contiene identificadores internos o parámetros de ejecución

---

## 9. Técnicas de Evasión y Anti-Análisis

### Observadas
- Enumeración de procesos
- Enumeración de discos
- Uso de pausas (`Sleep`)

### No observadas
- Anti-debug avanzado
- Anti-VM
- Packing
- Cifrado fuerte

**Conclusión:**  
Las técnicas de evasión son mínimas y coherentes con un entorno educativo.

---

## 10. Clasificación MITRE ATT&CK (Resumen)

### Tácticas
- Command and Control
- Discovery
- Persistence
- Execution

### Tipo MAEC
- Backdoor / Remote Access Trojan (RAT)

---

## 11. Hipótesis Finales

1. El malware está diseñado como ejercicio didáctico, pero replica técnicas reales.
2. El servidor C2 controla completamente el flujo mediante opcodes.
3. El overlay funciona como configuración persistente.
4. El análisis dinámico es imprescindible para validar el protocolo y forzar la ejecución.

---

## 12. Relación con el Análisis Dinámico

Este análisis estático:
- Identifica capacidades antes de la ejecución
- Define puntos clave para breakpoints
- Permite simular correctamente el servidor C2
- Sirve de base para los documentos:
  - `03-analisis-dinamico.md`
  - `04-comunicacion-c2.md`
  - Análisis individuales de opcodes


---

## 13. Análisis estático en crudo:
[Análisis Estátíco](../analisis-estatico/
