
Para la preparaci√≥n de este laboratorio necesitamos:
- Una MV Windows Flare.
- Una MV Linux, REMux.
- La MV Windows debe estar en la misma red que REMnux (ej. REMux 10.0.0.3 ‚Üî Windows 10.0.0.4).



## Adaptador 1
- Tipo: Host-Only (o ‚ÄúRed interna‚Äù, pero igual en ambas VMs)
- DHCP: s√≠ (o IP fija, pero coherente)

## Linux
- Listener b√°sico para que la m√°quina REMux escuche en el puerto 443:
  ```
  import socket
  s=socket.socket()
  s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
  s.bind(('',443))
  s.listen(5)
  print('[*] Listening on 0.0.0.0:443')
  while True:
      c,a=s.accept()
      print('[+] Connection from',a)
      data=c.recv(4096)
      print('[*] Received:',data)
      c.sendall(b'12345678')
      c.close()
  ```
- Comprobamos si alguien escucha en 443. Debe dar positivo: `sudo ss -lntp | grep :443`.
- Activamos la escucha en ese puerto: `sudo tcpdump -i any port 443`.
  - Cuando se lance desde Windows el comando para comprobar que se comunica con ese puerto, deber√° verse el movimiento: `Test-NetConnection us.t28.net -Port 443` .


## Resoluci√≥n del dominio us.t28.net
- Este lab NO depende de DNS real. Se fuerza con hosts.
- En Windows (como Administrador):
  - Archivo: C:\Windows\System32\drivers\etc\hosts
  - A√±adir exactamente: `<IP_REMNUX>    us.t28.net`
  - Por ejemplo: `10.0.0.3       us.t28.net`


## Comprobaciones desde Windows
- `ping us.t28.net`.
- Debe resolver a la IP de REMnux (aunque no responda ICMP).
- `Test-NetConnection us.t28.net -Port 443`: Debe mostrar: `TcpTestSucceeded : True`.
- ‚ùå nslookup us.t28.net puede fallar ‚Üí se ignora.


## Firewall de Windows
Esto es opcional pero recomendado. Normalmente no bloquea salidas, pero para evitar problemas: `netsh advfirewall set allprofiles state off`


## Ejecuci√≥n del malware
- Ejecutamos x32dbg como Administrador.
- Ejecutamos el malware desde x32dbg.

## Qu√© espera el malware. Resumen funcional
- Cuando Windows est√° bien configurado:
  - Windows resuelve us.t28.net ‚Üí IP de REMnux
- Malware hace:
  - socket
  - connect(us.t28.net:443)
  - send("fxftest")
  - recv(8 bytes)
- Si recibe algo v√°lido ‚Üí sale del bucle
- Entra en:
  - Enumeraci√≥n de archivos
  - Posible exfiltraci√≥n (send)
- El listener ya confirma que esto funciona üëá:
  - Received: b'fxftest'
  - Sent:     b'12345678'

