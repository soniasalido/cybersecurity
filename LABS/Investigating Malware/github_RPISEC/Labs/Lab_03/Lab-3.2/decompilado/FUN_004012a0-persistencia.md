# FUN_004012A0

Crea/actualiza una entrada de inicio automático (Run) en el registro de HKLM con nombre param_1 y datos param_2 (cadena), y luego cierra la clave.
- Abre HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run (RegOpenKeyA).
- Calcula la longitud de param_2 (lstrlenA).
- Escribe param_2 como REG_SZ bajo el valor param_1 (RegSetValueExA con dwType = 1).
- Cierra la clave (RegCloseKey).
- Devuelve 0.

Análisis de la persistencia: [Persistencia](../analisis-dinamico/persistencia.md)

```

                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             undefined4 __cdecl FUN_004012a0(LPCSTR param_1, BYTE * p
                               assume FS_OFFSET = 0xffdff000
             undefined4        EAX:4          <RETURN>
             LPCSTR            Stack[0x4]:4   param_1
             BYTE *            Stack[0x8]:4   param_2
             undefined         Stack[-0x4]:1  local_4                                 XREF[1]:     004012a1(*)  
                             FUN_004012a0                                    XREF[1]:     FUN_004012f0:00401484(c)  
        004012a0 51              PUSH       ECX
        004012a1 8d 44 24 00     LEA        EAX=>local_4,[ESP]
        004012a5 56              PUSH       ESI
        004012a6 50              PUSH       EAX
        004012a7 68 dc a0        PUSH       s_SOFTWARE\Microsoft\Windows\Curre_0040a0dc      = "SOFTWARE\\Microsoft\\Windows\
                 40 00
        004012ac 68 02 00        PUSH       0x80000002
                 00 80
        004012b1 ff 15 00        CALL       dword ptr [->ADVAPI32.DLL::RegOpenKeyA]          = 00009a66
                 90 40 00
        004012b7 8b 74 24 10     MOV        ESI,dword ptr [ESP + 0x10]
        004012bb 56              PUSH       ESI
        004012bc ff 15 84        CALL       dword ptr [->KERNEL32.DLL::lstrlenA]             = 0000985a
                 90 40 00
        004012c2 8b 4c 24 0c     MOV        ECX,dword ptr [ESP + 0xc]
        004012c6 8b 54 24 04     MOV        EDX,dword ptr [ESP + 0x4]
        004012ca 50              PUSH       EAX
        004012cb 56              PUSH       ESI
        004012cc 6a 01           PUSH       0x1
        004012ce 6a 00           PUSH       0x0
        004012d0 51              PUSH       ECX
        004012d1 52              PUSH       EDX
        004012d2 ff 15 04        CALL       dword ptr [->ADVAPI32.DLL::RegSetValueExA]       = 00009a54
                 90 40 00
        004012d8 8b 44 24 04     MOV        EAX,dword ptr [ESP + 0x4]
        004012dc 50              PUSH       EAX
        004012dd ff 15 08        CALL       dword ptr [->ADVAPI32.DLL::RegCloseKey]          = 00009a46
                 90 40 00
        004012e3 33 c0           XOR        EAX,EAX
        004012e5 5e              POP        ESI
        004012e6 59              POP        ECX
        004012e7 c3              RET
        004012e8 90              ??         90h
        004012e9 90              ??         90h
        004012ea 90              ??         90h
        004012eb 90              ??         90h
        004012ec 90              ??         90h
        004012ed 90              ??         90h
        004012ee 90              ??         90h
        004012ef 90              ??         90h

```
