# FUN_00401230 

La funci√≥n FUN_00401230(undefined4 param_1) es una rutina auxiliar que opera sobre estructuras relacionadas con resoluci√≥n de nombres de red, espec√≠ficamente sobre el resultado de gethostbyname() o una funci√≥n equivalente.


**1. Llamada a Ordinal 52** ‚Üí gethostbyname: Si gethostbyname(name) falla (EAX == NULL), salta directamente a Ordinal_111, que probablemente es exit() o una funci√≥n de limpieza.

**2. Extraer IP desde la estructura hostent**
```
00401245 MOV ECX, [EAX + 0xC]     ; hostent->h_addr_list
00401248 MOV EAX, [ECX]           ; hostent->h_addr_list[0]
0040124a TEST EAX, EAX
0040124c JZ LAB_0040128e          ; si no hay IP, termina
```
Se accede al primer elemento de h_addr_list, que contiene una direcci√≥n IP en forma de puntero a struct in_addr.



**3. Llamada a funci√≥n personalizada FUN_00402d30**


```
00401250 PUSH 0x4                 ; tama√±o: 4 bytes (IPv4)
00401252 LEA EDX, [ESP + 0x10]    ; direcci√≥n destino
00401256 PUSH EAX                 ; IP (h_addr_list[0])
00401257 PUSH EDX                 ; destino
00401258 CALL FUN_00402d30
```
Posiblemente esta funci√≥n convierte la IP en una cadena, o simplemente copia los 4 bytes. Necesitar√≠amos ver FUN_00402d30 para confirmar si hace transformaci√≥n (como inet_ntoa o similar).


**4. Llamada a Ordinal 12 ‚Üí inet_ntoa**
```
00401265 CALL [WS2_32::Ordinal_12] ; probablemente inet_ntoa(struct in_addr)
```
Esta llamada convierte la IP en formato binario (4 bytes) en una cadena tipo "192.168.1.1" y devuelve un puntero.

**5. Copia de la cadena IP a un destino**
```
0040126b MOV EDI, EAX             ; puntero a cadena IP
...
0040127c MOV EDI, [ESP + 0x10]    ; destino final
...
00401283 MOVSD / MOVSB            ; copia cadena IP al destino
```
Copia la cadena con la IP generada por inet_ntoa() al destino apuntado por [ESP + 0x10] (probablemente el 2.¬∫ argumento a FUN_00402d30).



**¬øQu√© hace esta funci√≥n?**
| Etapa | Acci√≥n |
| -- | -- |
| 1. gethostbyname(param_1) | Resuelve un nombre a direcci√≥n IP |
| 2. h_addr_list[0] | Toma la primera direcci√≥n IP |
| 3. FUN_00402d30 | Posible copia o transformaci√≥n de la IP (m√°scara, cifrado, etc.) |
| 4. inet_ntoa() | Convierte la IP a una cadena ASCII |
| 5. Copia a destino | Escribe la cadena IP en un buffer externo |


**Esta funci√≥n sirve para:**
- Resolver un nombre de host (como "google.com" o "fxftest").
- Obtener su primera direcci√≥n IP.
- Convertirla a string "X.X.X.X".
- Guardarla en un buffer que le pas√≥ el caller.

**üîê Uso en malware:**
- Permite conectarse a servidores din√°micos sin codificar IPs.
- Puede integrarse en l√≥gica C2 (Command and Control).
- Si se le pasa un hostname del C2 (por ejemplo "fxftest"), esta funci√≥n prepara la direcci√≥n para conectarse.


[FUN_00402d30](../decompilado/FUN_00402d30.md)

```
                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             undefined4 __cdecl FUN_00401230(undefined4 param_1)
                               assume FS_OFFSET = 0xffdff000
             undefined4        EAX:4          <RETURN>
             undefined4        Stack[0x4]:4   param_1                                 XREF[1]:     00401230(R)
                             FUN_00401230                                    XREF[1]:     FUN_004012f0:004014a5(c)
        00401230 8b 44 24 04     MOV        EAX,dword ptr [ESP + param_1]
        00401234 50              PUSH       EAX
        00401235 ff 15 64        CALL       dword ptr [->WS2_32.DLL::Ordinal_52]             = 80000034
                 91 40 00
        0040123b 85 c0           TEST       EAX,EAX
        0040123d 75 06           JNZ        LAB_00401245
        0040123f ff 25 4c        JMP        dword ptr [->WS2_32.DLL::Ordinal_111]
                 91 40 00
                             LAB_00401245                                    XREF[1]:     0040123d(j)
        00401245 8b 48 0c        MOV        ECX,dword ptr [EAX + 0xc]
        00401248 8b 01           MOV        EAX,dword ptr [ECX]
        0040124a 85 c0           TEST       EAX,EAX
        0040124c 74 40           JZ         LAB_0040128e
        0040124e 56              PUSH       ESI
        0040124f 57              PUSH       EDI
        00401250 6a 04           PUSH       0x4
        00401252 8d 54 24 10     LEA        EDX,[ESP + 0x10]
        00401256 50              PUSH       EAX
        00401257 52              PUSH       EDX
        00401258 e8 d3 1a        CALL       FUN_00402d30                                     undefined4 * FUN_00402d30(undefi
                 00 00
        0040125d 8b 44 24 18     MOV        EAX,dword ptr [ESP + 0x18]
        00401261 83 c4 0c        ADD        ESP,0xc
        00401264 50              PUSH       EAX
        00401265 ff 15 50        CALL       dword ptr [->WS2_32.DLL::Ordinal_12]             = 8000000c
                 91 40 00
        0040126b 8b f8           MOV        EDI,EAX
        0040126d 83 c9 ff        OR         ECX,0xffffffff
        00401270 33 c0           XOR        EAX,EAX
        00401272 f2 ae           SCASB.RE   ES:EDI
        00401274 f7 d1           NOT        ECX
        00401276 2b f9           SUB        EDI,ECX
        00401278 8b d1           MOV        EDX,ECX
        0040127a 8b f7           MOV        ESI,EDI
        0040127c 8b 7c 24 10     MOV        EDI,dword ptr [ESP + 0x10]
        00401280 c1 e9 02        SHR        ECX,0x2
        00401283 f3 a5           MOVSD.REP  ES:EDI,ESI
        00401285 8b ca           MOV        ECX,EDX
        00401287 83 e1 03        AND        ECX,0x3
        0040128a f3 a4           MOVSB.REP  ES:EDI,ESI
        0040128c 5f              POP        EDI
        0040128d 5e              POP        ESI
                             LAB_0040128e                                    XREF[1]:     0040124c(j)
        0040128e 33 c0           XOR        EAX,EAX
        00401290 c3              RET
```

