Se configura un MV Linux con Fakenet para que responda a la llamada del malware : resersingrocks:1234

Si hay respuesta en reversing.rocks entonces el malware --> FUN_00401000 --> lista los ficheros de c: --> cierra conexiones y termina.


```
MV linux:
192.168.100.1
255.255.255.0
0.0.0.0
Configuracion de /etc/hosts --> 192.168.100.1 resersing.rocks
ConfiguraciÃ³n de Fakenet --> fichero default.init
Hay que arrancar FakeNet
--------------------------------------


MV Win
192.168.100.5
255.255.255.0
192.168.100.1
En c:\Windows\System32\drivers\etc\hosts --> 192.168.100.1 reversing.rocks


Comprobar en Windws que se comunica con la MV Linux:
ping 192.168.100.1
nslookup reversing.rocks
Mostrar capturas de pantala de la activaciÃ³n.
```

---------------------
Capturar el trÃ¡fico desde la MV Linux:
sudo tcpdump -i enp0s3 -w trafico-MV-Linux.pcap



-------------------------------------
## AÃ±adiendo breakpoints en x32dbg para ver el funcionamiento del malware 

ğŸ”¹ 1. FUN_00401000 â€“ ExfiltraciÃ³n HTTP
ğŸ”¸ DirecciÃ³n: 00401000
AcciÃ³n: Ctrl+G â†’ escribe 00401000

Puntos importantes para F2 (breakpoint):

0040101b â†’ llamada a FindFirstFileA

0040104e â†’ llamada a HttpOpenRequestA

0040105f â†’ llamada a HttpSendRequestExA

0040108b â†’ llamada a InternetWriteFile (envÃ­o de datos)

004010f8 â†’ HttpEndRequestA

00401104 â†’ InternetCloseHandle

0040110b â†’ FindClose

ğŸ” Objetivo: Ver cÃ³mo itera archivos y los exfiltra por HTTP.

ğŸ”¹ 2. FUN_00401130 â€“ FunciÃ³n puente
ğŸ”¸ DirecciÃ³n: 00401130
AcciÃ³n: Ctrl+G â†’ escribe 00401130

Pon breakpoint en 00401185 â†’ es donde se llama a FUN_00401000.

ğŸ” Objetivo: Ver cuÃ¡ndo se lanza el envÃ­o de archivos.

ğŸ”¹ 3. FUN_004011a0 â€“ InicializaciÃ³n / Setup
ğŸ”¸ DirecciÃ³n: 004011a0
AcciÃ³n: Ctrl+G â†’ escribe 004011a0

Marca F2 en la primera instrucciÃ³n

Observa si hay llamadas como CreateThread, LoadLibrary, GetProcAddress, Sleep, etc.

ğŸ” Objetivo: Analizar si esta funciÃ³n configura el entorno antes de lanzar la lÃ³gica maliciosa.



ğŸ”¸ DirecciÃ³n: 00401080  - Donde carga un nuevo fichero de la carpeta c:

------------------------------

![activando-reversingrocks.png](capturas/activando-reversingrocks.png)


![](capturas/Captura1.png)


![](capturas/Captura2.png)

![](capturas/Captura3.png)

![](capturas/Captura4.png)

![](capturas/Captura5.png)


![](capturas/Captura6.png)


![](capturas/Captura7.png)


![](capturas/wireshark-lab2.1.png)

