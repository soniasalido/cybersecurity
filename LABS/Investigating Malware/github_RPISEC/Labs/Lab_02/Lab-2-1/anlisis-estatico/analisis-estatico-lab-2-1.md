## Firma
```
file > sha256,0D6CA46A1D62C6A7FCADB184AEE9F06444E7F80FA6098826B750933E2AF1B393
dos-stub > sha256,9850A5D1895AB183A36BE63E13C714520E8FC7C3012CAF7E418AB1AE1126265F
dos-header > sha256,210B2252926993EB830A688134BC0CD853D923AFEF76F135325FC7C750E0991D
rich-header > sha256,C8411138BF5AFBE0551CC01AF28818CECD9B722FE5E547E11AF43D84A9E73F90
section > .text > sha256,16D715E918C51FB869750496FD8D52F8814DC79118C9A7FABC6F99F7D140CBB5
section > .rdata > sha256,C5A1F138B15FFB27C672BA0F33D012D3B2017CB796E0D7EBB949BDEC7B4FF3CE
section > .data > sha256,D3F192652C950386DD3AF0B1E17094A335CB200E30750869806B3C91491F5929
section > .rsrc > sha256,BE30993728CF7B6046D5C0511706C3272DA7548620BF079E9DC854EF47DFC4E2
manifest > sha256,4BB79DCEA0A901F7D9EAC5AA05728AE92ACB42E0CB22E5DD14134F4421A3D8DF
,
special,
imphash > md5,068859BE3EA70BEFCB551D490B17BBAB

```


## Info General
```
file > name,c:\users\usuario\desktop\lab_02\lab_02\lab_02-1.malware
file > signature,Microsoft Linker 12.0 | Visual Studio 2013
file > sha256,0D6CA46A1D62C6A7FCADB184AEE9F06444E7F80FA6098826B750933E2AF1B393
file > info,size: 6656 bytes, entropy: 5.012
file > type,executable, 32-bit, console
virustotal > score,No se pudo resolver el nombre de servidor o su direcci√≥n
stamp > compiler,Mon Jul 13 05:41:48 2015
languages > names,English-US
resources > info,count: 1, size: 381 bytes, file-ratio: 5.72%
manifest > general,name: n/a, description: n/a, severity: asInvoker
file > version,n/a
entry-point > location,0x00001432 (section: .text)
string > url-pattern,http://reversing.rocks/
certificate,n/a
libraries > flag,WININET.dll (Internet Extensions for Win32 Library)
imports > flag,FindFirstFileA | FindNextFileA | GetCurrentProcessId | GetCurrentThreadId | HttpEndRequestA | HttpOpenRequestA | ...
imphash > md5,068859BE3EA70BEFCB551D490B17BBAB
exports,n/a
overlay,n/a
```


## VirusTotal
https://www.virustotal.com/gui/file/0d6ca46a1d62c6a7fcadb184aee9f06444e7f80fa6098826b750933e2af1b393

## ¬øEst√° empaquetado?
‚îî‚îÄ$ pepack Lab_02-1.malware -d db_packer.txt
packer:                          Microsoft Visual C++ 8
                                                                                                                                                           
Esto indica que el binario no est√° empaquetado con un packer ofuscador o compresor de c√≥digo (como UPX, ASPack, etc.), sino que probablemente ha sido compilado con el compilador de Microsoft Visual C++ versi√≥n 8 (que corresponde a Visual Studio 2005).                                                                                                                                                      


Usa CRT de Visual C++ 8: Es posible que veamos funciones auxiliares del runtime (__security_init_cookie, __amsg_exit, etc.) al principio del binario.

ü™õ Posibles funciones C est√°ndar: Veremos llamadas a funciones de la libc de Visual C++, como memcpy, strncpy, exit, etc.


## FUN_00401000.md
[FUN_00401000.md](decompilado/FUN_00401000.md)


Esta funci√≥n (FUN_00401000) representa un **comportamiento de tipo dropper o exfiltrador de informaci√≥n**, con uso expl√≠cito de la API de Windows para recorrer archivos y hacer peticiones HTTP usando WININET.DLL. Vamos a desglosarla paso a paso:

### üìå RESUMEN GENERAL DE LO QUE HACE

- Usa FindFirstFileA y FindNextFileA para recorrer archivos de una carpeta.
- Crea una conexi√≥n HTTP con HttpOpenRequestA y la env√≠a con HttpSendRequestExA.
- Usa InternetWriteFile para enviar el nombre (o contenido) de archivos a trav√©s de la conexi√≥n HTTP.
- Finaliza la petici√≥n con HttpEndRequestA, cierra el handle HTTP y los handles de archivos.

### üß† AN√ÅLISIS DETALLADO  
**üîπ Inicio t√≠pico de funci√≥n C compilada**
```
00401000 PUSH       EBP
00401001 MOV        EBP,ESP
00401003 AND        ESP,0xfffffff8
00401006 SUB        ESP,0x144
```
Reserva stack y alinea el puntero de pila.

**üîπ Inicializaci√≥n y primer acceso a archivos**
```
0040100f LEA        EAX,[ESP + 0x10]      ; puntero a estructura WIN32_FIND_DATA
00401013 MOV        ESI,ECX               ; copia ECX (par√°metro oculto stdcall)
00401015 PUSH       EAX                   ; arg para FindFirstFileA
00401016 PUSH       DAT_00402128          ; patr√≥n de b√∫squeda (probable "*.*")
0040101b CALL       [FindFirstFileA]
```

> [!IMPORTANT]  
> Est√° **recorriendo archivos en alguna carpeta.**

**DAT_00402128** contiene el patr√≥n, probablemente "*" o "C:\\algo\\*".

**üîπ Comprobaci√≥n si se encontr√≥ alg√∫n archivo**
```
0040102b TEST       EDI,EDI
0040102d JZ         LAB_00401118
```

Si FindFirstFileA falla, se hace exit(1).

--------------------
### üåê Inicio de comunicaci√≥n HTTP
```
0040104e CALL       [HttpOpenRequestA] ; crea la petici√≥n HTTP (GET, POST, etc.)
0040105f CALL       [HttpSendRequestExA] ; env√≠a cabecera HTTP
```
Par√°metros previos incluyen:
- "text/html" como tipo de contenido.
- Otros datos de la URL en DAT_004020fc, DAT_00402100...

> [!IMPORTANT]  
> Est√° iniciando una conexi√≥n HTTP POST/GET a un servidor remoto, probablemente para enviar datos de los archivos encontrados.**

-----------------------------
###  üßæ Env√≠a contenido a trav√©s de InternetWriteFile
```
MOV        EBX,[WININET.DLL::InternetWriteFile]
CALL       EBX
```
Este patr√≥n aparece tres veces:
- Una vez por cada archivo encontrado.
- Incluye:
    - Nombre del archivo
    - Contenido asociado (posiblemente no el contenido del archivo, sino solo metadatos).

-----------------------------------

###  üîÅ Bucle de b√∫squeda de archivos
```
CALL       [FindNextFileA]
JLE        -> rompe el bucle si ya no hay m√°s archivos
JG         -> sigue al siguiente archivo
```

--------------------------------------------
### üßπ Limpieza y cierre
```
HttpEndRequestA
InternetCloseHandle
FindClose
RET
```

-----------------------------------------------
###  ‚ùå Comportamiento si falla FindFirstFileA:
```
00401118 PUSH 0x1
CALL [MSVCR120.DLL::exit]
```
Termina el proceso con exit(1).

--------------------------------------------
### üïµÔ∏è INDICIOS DE COMPORTAMIENTO MALICIOSO
| Evidencia	 | Implicaci√≥n |
| -- | -- |
| FindFirstFileA y FindNextFileA	| Recorre el sistema de archivos |
| HttpOpenRequestA, HttpSendRequestExA	| Establece comunicaci√≥n HTTP |
| InternetWriteFile	| Env√≠a datos al servidor |
| HttpEndRequestA + InternetCloseHandle	| Limpieza de conexi√≥n |
| MSVCR120.DLL::exit(1) en error	| Finaliza discretamente si falla algo |

üîé Posible uso  
- Este binario recorre archivos en el sistema y los exfiltra a un servidor remoto a trav√©s de peticiones HTTP.
- Es un comportamiento cl√°sico de un infostealer o dropper que recopila informaci√≥n antes de descargar m√°s payloads.



## FUN_00401130
[FUN_00401130](decompilado/FUN_00401130.md)

