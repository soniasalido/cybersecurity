
# FUN_0040113b
no es “lógica bancaria” como tal, sino código de soporte típico de malware tipo Zeus: resolución/ocultación de APIs, caching de punteros, parsing de cabeceras PE y basura/opaque predicates para dificultar el análisis.


```
                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             undefined __stdcall FUN_0040113b(void)
                               assume FS_OFFSET = 0xffdff000
             undefined         <UNASSIGNED>   <RETURN>
             undefined1        Stack[-0x5]:1  local_5                                 XREF[6]:     00401221(W),
                                                                                                   00401231(R),
                                                                                                   00401246(W),
                                                                                                   0040128d(R),
                                                                                                   00401299(W),
                                                                                                   004012af(R)
             undefined4        Stack[-0xc]:4  local_c                                 XREF[6]:     00401146(W),
                                                                                                   00401162(RW),
                                                                                                   00401165(R),
                                                                                                   004011bf(W),
                                                                                                   004011c6(R),
                                                                                                   0040126d(W)
             undefined4        Stack[-0x10]:4 local_10                                XREF[4]:     004011b8(W),
                                                                                                   004011c9(R),
                                                                                                   0040121e(W),
                                                                                                   00401225(R)
             undefined4        Stack[-0x14]:4 local_14                                XREF[2]:     004011e0(W),
                                                                                                   004011e3(R)
             undefined4        Stack[-0x18]:4 local_18                                XREF[5]:     00401175(W),
                                                                                                   004011ed(W),
                                                                                                   00401203(W),
                                                                                                   00401280(R),
                                                                                                   004012c1(W)
                             FUN_0040113b
        0040113b 55              PUSH       EBP
        0040113c 8b ec           MOV        EBP,ESP
        0040113e 83 ec 14        SUB        ESP,0x14
        00401141 a1 a0 00        MOV        EAX,[->SHLWAPI.DLL::ChrCmpIW]                    = 0002037a
                 42 00
        00401146 89 45 f8        MOV        dword ptr [EBP + local_c],EAX
        00401149 a1 c0 f7        MOV        EAX,[DAT_0040f7c0]                               = 0000702Dh
                 40 00
        0040114e 8b 0d bc        MOV        ECX,dword ptr [DAT_0040f7bc]                     = 00001649h
                 f7 40 00
        00401154 0d 28 2d        OR         EAX,0x2d28
                 00 00
        00401159 0f af c8        IMUL       ECX,EAX
        0040115c 81 f1 d5        XOR        ECX,0xae58fd5
                 8f e5 0a
        00401162 01 4d f8        ADD        dword ptr [EBP + local_c],ECX
        00401165 8b 45 f8        MOV        EAX,dword ptr [EBP + local_c]
        00401168 6a 72           PUSH       0x72
        0040116a 6a 79           PUSH       0x79
        0040116c ff d0           CALL       EAX
        0040116e f6 05 70        TEST       byte ptr [DAT_00410b70],0x1
                 0b 41 00 01
        00401175 c7 45 ec        MOV        dword ptr [EBP + local_18],0x6f7345
                 45 73 6f 00
        0040117c 75 11           JNZ        LAB_0040118f
        0040117e a1 2c 01        MOV        EAX,[->USER32.DLL::GetWindowTextLengthW]         = 00020818
                 42 00
        00401183 83 0d 70        OR         dword ptr [DAT_00410b70],0x1
                 0b 41 00 01
        0040118a a3 44 06        MOV        [DAT_00410644],EAX
                 41 00
                             LAB_0040118f                                    XREF[1]:     0040117c(j)
        0040118f a1 c8 f7        MOV        EAX,[DAT_0040f7c8]                               = 0000711Dh
                 40 00
        00401194 8a 0d c4        MOV        CL,byte ptr [DAT_0040f7c4]                       = 01h
                 f7 40 00
        0040119a c1 e8 02        SHR        EAX,0x2
        0040119d 25 45 03        AND        EAX,0x345
                 00 00
        004011a2 d3 e0           SHL        EAX,CL
        004011a4 8b 0d 44        MOV        ECX,dword ptr [DAT_00410644]
                 06 41 00
        004011aa 33 d2           XOR        EDX,EDX
        004011ac 8d 84 01        LEA        EAX,[ECX + EAX*0x1 + 0xffffff76]
                 76 ff ff ff
        004011b3 a3 44 06        MOV        [DAT_00410644],EAX
                 41 00
        004011b8 c7 45 f4        MOV        dword ptr [EBP + local_10],0x574d
                 4d 57 00 00
        004011bf c7 45 f8        MOV        dword ptr [EBP + local_c],0x4719
                 19 47 00 00
        004011c6 8b 4d f8        MOV        ECX,dword ptr [EBP + local_c]
        004011c9 8b 45 f4        MOV        EAX,dword ptr [EBP + local_10]
        004011cc 2b c1           SUB        EAX,ECX
        004011ce 8b 0d cc        MOV        ECX,dword ptr [DAT_0040f7cc]                     = 00000001h
                 f7 40 00
        004011d4 35 2d 68        XOR        EAX,0x682d
                 00 00
        004011d9 f7 f1           DIV        ECX
        004011db 2d 8a 32        SUB        EAX,0x2c0d328a
                 0d 2c
        004011e0 89 45 f0        MOV        dword ptr [EBP + local_14],EAX
        004011e3 ff 75 f0        PUSH       dword ptr [EBP + local_14]
        004011e6 a1 44 06        MOV        EAX,[DAT_00410644]
                 41 00
        004011eb ff d0           CALL       EAX
        004011ed c7 45 ec        MOV        dword ptr [EBP + local_18],0x6f6302
                 02 63 6f 00
        004011f4 a1 d0 f7        MOV        EAX,[DAT_0040f7d0]                               = 00004E3Bh
                 40 00
        004011f9 0d 70 54        OR         EAX,0x5470
                 00 00
        004011fe 2d 7a 5e        SUB        EAX,0x5e7a
                 00 00
        00401203 89 45 ec        MOV        dword ptr [EBP + local_18],EAX
        00401206 a1 e0 f7        MOV        EAX,[DAT_0040f7e0]                               = 0000327Fh
                 40 00
        0040120b c1 e0 1d        SHL        EAX,0x1d
        0040120e 33 d2           XOR        EDX,EDX
        00401210 b9 86 4c        MOV        ECX,0x4c86
                 00 00
        00401215 f7 f1           DIV        ECX
        00401217 b8 52 25        MOV        EAX,0x2552
                 00 00
        0040121c 2b c2           SUB        EAX,EDX
        0040121e 89 45 f4        MOV        dword ptr [EBP + local_10],EAX
        00401221 c6 45 ff 6c     MOV        byte ptr [EBP + local_5],0x6c
        00401225 8b 45 f4        MOV        EAX,dword ptr [EBP + local_10]
        00401228 8a 80 e4        MOV        AL,byte ptr [EAX + DAT_0040f7e4]                 = ACh
                 f7 40 00
        0040122e 0f b6 c8        MOVZX      ECX,AL
        00401231 8a 45 ff        MOV        AL,byte ptr [EBP + local_5]
        00401234 04 21           ADD        AL,0x21
        00401236 0f b6 c0        MOVZX      EAX,AL
        00401239 33 c1           XOR        EAX,ECX
        0040123b 99              CDQ
        0040123c b9 f0 00        MOV        ECX,0xf0
                 00 00
        00401241 f7 f9           IDIV       ECX
        00401243 83 c2 10        ADD        EDX,0x10
        00401246 88 55 ff        MOV        byte ptr [EBP + local_5],DL
        00401249 eb 51           JMP        LAB_0040129c
                             LAB_0040124b                                    XREF[1]:     004012b8(j)
        0040124b 66 a1 f0        MOV        AX,[DAT_0040f7f0]                                = 0680h
                 f7 40 00
        00401251 66 c1 e8 06     SHR        AX,0x6
        00401255 b9 28 76        MOV        ECX,0x7628
                 00 00
        0040125a 66 03 c1        ADD        AX,CX
        0040125d 66 8b 0d        MOV        CX,word ptr [DAT_0040f7ec]                       = 0009h
                 ec f7 40 00
        00401264 0f b7 c0        MOVZX      EAX,AX
        00401267 99              CDQ
        00401268 0f b7 c9        MOVZX      ECX,CX
        0040126b f7 f9           IDIV       ECX
        0040126d 66 89 45 f8     MOV        word ptr [EBP + local_c],AX
        00401271 a0 d5 f7        MOV        AL,[DAT_0040f7d5]                                = 05h
                 40 00
        00401276 0f b6 c8        MOVZX      ECX,AL
        00401279 a0 d4 f7        MOV        AL,[DAT_0040f7d4]                                = 13h
                 40 00
        0040127e d2 e0           SHL        AL,CL
        00401280 8b 4d ec        MOV        ECX,dword ptr [EBP + local_18]
        00401283 8a 89 d8        MOV        CL,byte ptr [ECX + 0x40f7d8]=>DAT_0040f7d9       = 01h
                 f7 40 00
        00401289 d0 e8           SHR        AL,0x1
        0040128b d2 e0           SHL        AL,CL
        0040128d 0f b6 4d ff     MOVZX      ECX,byte ptr [EBP + local_5]
        00401291 0f b6 c0        MOVZX      EAX,AL
        00401294 83 f0 61        XOR        EAX,0x61
        00401297 03 c8           ADD        ECX,EAX
        00401299 88 4d ff        MOV        byte ptr [EBP + local_5],CL
                             LAB_0040129c                                    XREF[1]:     00401249(j)
        0040129c 8a 0d dd        MOV        CL,byte ptr [DAT_0040f7dd]                       = 04h
                 f7 40 00
        004012a2 8a 15 dc        MOV        DL,byte ptr [DAT_0040f7dc]                       = A9h
                 f7 40 00
        004012a8 a0 db f7        MOV        AL,[DAT_0040f7db]                                = 29h
                 40 00
        004012ad d2 ea           SHR        DL,CL
        004012af 8a 4d ff        MOV        CL,byte ptr [EBP + local_5]
        004012b2 f6 ea           IMUL       DL
        004012b4 2c 58           SUB        AL,0x58
        004012b6 3a c8           CMP        CL,AL
        004012b8 76 91           JBE        LAB_0040124b
        004012ba f6 05 70        TEST       byte ptr [DAT_00410b70],0x2
                 0b 41 00 02
        004012c1 c7 45 ec        MOV        dword ptr [EBP + local_18],0x6f6301
                 01 63 6f 00
        004012c8 75 11           JNZ        LAB_004012db
        004012ca a1 b8 00        MOV        EAX,[->SHLWAPI.DLL::Ordinal_29]                  = 8000001d
                 42 00
        004012cf 83 0d 70        OR         dword ptr [DAT_00410b70],0x2
                 0b 41 00 02
        004012d6 a3 40 06        MOV        [DAT_00410640],EAX
                 41 00
                             LAB_004012db                                    XREF[1]:     004012c8(j)
        004012db c9              LEAVE
        004012dc c2 18 00        RET        0x18
                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             char * __stdcall FUN_004012df(char * param_1)
                               assume FS_OFFSET = 0xffdff000
             char *            EAX:4          <RETURN>
             char *            Stack[0x4]:4   param_1                                 XREF[9,5]:   004012f2(R),
                                                                                                   00401303(R),
                                                                                                   00401306(R),
                                                                                                   0040134f(W),
                                                                                                   0040135a(W),
                                                                                                   00401361(R),
                                                                                                   0040137a(W),
                                                                                                   0040137d(R),
                                                                                                   00401412(W),
                                                                                                   0040132b(W),
                                                                                                   004013a2(W),
                                                                                                   004013d3(R),
                                                                                                   004013de(W),
                                                                                                   004013fb(R)
             undefined1        Stack[-0x5]:1  local_5                                 XREF[2]:     00401356(W),
                                                                                                   004013ee(R)
             undefined1        Stack[-0x6]:1  local_6                                 XREF[2]:     00401352(W),
                                                                                                   004013bc(R)
             undefined4        Stack[-0xc]:4  local_c                                 XREF[4]:     00401311(W),
                                                                                                   00401331(R),
                                                                                                   00401342(R),
                                                                                                   004013b8(W)
             undefined4        Stack[-0x10]:4 local_10                                XREF[4]:     004012ea(W),
                                                                                                   0040132e(R),
                                                                                                   00401404(R),
                                                                                                   0040141b(R)
                             FUN_004012df                                    XREF[1]:     FUN_0040592c:00405c54(c)
        004012df 55              PUSH       EBP
        004012e0 8b ec           MOV        EBP,ESP
        004012e2 83 ec 0c        SUB        ESP,0xc
        004012e5 53              PUSH       EBX
        004012e6 56              PUSH       ESI
        004012e7 57              PUSH       EDI
        004012e8 3b c3           CMP        EAX,EBX
        004012ea c7 45 f4        MOV        dword ptr [EBP + local_10],0xfff7abfe
                 fe ab f7 ff
        004012f1 93              XCHG       EAX,EBX
        004012f2 8b 45 08        MOV        EAX,dword ptr [EBP + param_1]
        004012f5 8a 00           MOV        AL,byte ptr [EAX]
        004012f7 04 32           ADD        AL,0x32
        004012f9 34 be           XOR        AL,0xbe
        004012fb 3c c1           CMP        AL,0xc1
        004012fd 0f 85 0a        JNZ        LAB_0040140d
                 01 00 00
        00401303 8b 45 08        MOV        EAX,dword ptr [EBP + param_1]
        00401306 8b 4d 08        MOV        ECX,dword ptr [EBP + param_1]
        00401309 03 48 3c        ADD        ECX,dword ptr [EAX + 0x3c]
        0040130c bf 21 e3        MOV        EDI,0x2e321
                 02 00
        00401311 89 4d f8        MOV        dword ptr [EBP + local_c],ECX
        00401314 a0 41 ea        MOV        AL,[DAT_0040ea41]                                = 7Ch
                 40 00
        00401319 0f b6 0d        MOVZX      ECX,byte ptr [DAT_0040ea40]                      = 87h
                 40 ea 40 00
        00401320 0f b6 c0        MOVZX      EAX,AL
        00401323 c1 e8 06        SHR        EAX,0x6
        00401326 33 c8           XOR        ECX,EAX
        00401328 83 c1 5e        ADD        ECX,0x5e
        0040132b 88 4d 0b        MOV        byte ptr [EBP + param_1+0x3],CL
        0040132e 8b 45 f4        MOV        EAX,dword ptr [EBP + local_10]
        00401331 8b 4d f8        MOV        ECX,dword ptr [EBP + local_c]
        00401334 33 c7           XOR        EAX,EDI
        00401336 be 21 b7        MOV        ESI,0xab721
                 0a 00
        0040133b 03 c6           ADD        EAX,ESI
        0040133d 39 41 54        CMP        dword ptr [ECX + 0x54],EAX
        00401340 74 08           JZ         LAB_0040134a
        00401342 8b 45 f8        MOV        EAX,dword ptr [EBP + local_c]
        00401345 e9 de 00        JMP        LAB_00401428
                 00 00
                             LAB_0040134a                                    XREF[1]:     00401340(j)
        0040134a a1 6c 00        MOV        EAX,[->KERNEL32.DLL::GetSystemDefaultLCID]       = 000204a8
                 42 00
        0040134f 89 45 08        MOV        dword ptr [EBP + param_1],EAX
        00401352 c6 45 fe c6     MOV        byte ptr [EBP + local_6],0xc6
        00401356 c6 45 ff de     MOV        byte ptr [EBP + local_5],0xde
        0040135a c7 45 08        MOV        dword ptr [EBP + param_1],0x792e
                 2e 79 00 00
        00401361 8b 45 08        MOV        EAX,dword ptr [EBP + param_1]
        00401364 8b 0d 48        MOV        ECX,dword ptr [DAT_0040ea48]                     = 000053FCh
                 ea 40 00
        0040136a c1 e8 0c        SHR        EAX,0xc
        0040136d 69 c0 06        IMUL       EAX,EAX,0x6406
                 64 00 00
        00401373 33 c1           XOR        EAX,ECX
        00401375 2d d2 ef        SUB        EAX,0x2efd2
                 02 00
        0040137a 89 45 08        MOV        dword ptr [EBP + param_1],EAX
        0040137d 8b 45 08        MOV        EAX,dword ptr [EBP + param_1]
        00401380 8a 80 4c        MOV        AL,byte ptr [EAX + 0x40ea4c]=>DAT_0040ea50       = 02h
                 ea 40 00
        00401386 0f b6 c8        MOVZX      ECX,AL
        00401389 a0 46 ea        MOV        AL,[DAT_0040ea46]                                = 8Fh
                 40 00
        0040138e d2 e0           SHL        AL,CL
        00401390 0f b6 0d        MOVZX      ECX,byte ptr [DAT_0040ea45]                      = 8Eh
                 45 ea 40 00
        00401397 0f b6 c0        MOVZX      EAX,AL
        0040139a 33 c8           XOR        ECX,EAX
        0040139c 81 f1 a9        XOR        ECX,0xa9
                 00 00 00
        004013a2 88 4d 0b        MOV        byte ptr [EBP + param_1+0x3],CL
        004013a5 b9 9c 00        MOV        ECX,0x9c
                 00 00
        004013aa eb 35           JMP        LAB_004013e1
                             LAB_004013ac                                    XREF[1]:     00401402(j)
        004013ac 0f b7 05        MOVZX      EAX,word ptr [DAT_0040ea54]                      = 51CEh
                 54 ea 40 00
        004013b3 05 70 65        ADD        EAX,0x6570
                 00 00
        004013b8 66 89 45 f8     MOV        word ptr [EBP + local_c],AX
        004013bc 8a 45 fe        MOV        AL,byte ptr [EBP + local_6]
        004013bf 8a 15 42        MOV        DL,byte ptr [DAT_0040ea42]                       = C0h
                 ea 40 00
        004013c5 c0 e0 06        SHL        AL,0x6
        004013c8 2a c2           SUB        AL,DL
        004013ca 0f b6 c0        MOVZX      EAX,AL
        004013cd 99              CDQ
        004013ce 6a 0c           PUSH       0xc
        004013d0 5b              POP        EBX
        004013d1 f7 fb           IDIV       EBX
        004013d3 0f b6 55 0b     MOVZX      EDX,byte ptr [EBP + param_1+0x3]
        004013d7 2c 0f           SUB        AL,0xf
        004013d9 0f b6 c0        MOVZX      EAX,AL
        004013dc 03 d0           ADD        EDX,EAX
        004013de 88 55 0b        MOV        byte ptr [EBP + param_1+0x3],DL
                             LAB_004013e1                                    XREF[1]:     004013aa(j)
        004013e1 a0 44 ea        MOV        AL,[DAT_0040ea44]                                = FCh
                 40 00
        004013e6 0f b6 c0        MOVZX      EAX,AL
        004013e9 99              CDQ
        004013ea 8b d9           MOV        EBX,ECX
        004013ec f7 fb           IDIV       EBX
        004013ee 8a 45 ff        MOV        AL,byte ptr [EBP + local_5]
        004013f1 32 c2           XOR        AL,DL
        004013f3 8a 15 43        MOV        DL,byte ptr [DAT_0040ea43]                       = 37h
                 ea 40 00
        004013f9 22 c2           AND        AL,DL
        004013fb 8a 55 0b        MOV        DL,byte ptr [EBP + param_1+0x3]
        004013fe 34 1a           XOR        AL,0x1a
        00401400 3a d0           CMP        DL,AL
        00401402 76 a8           JBE        LAB_004013ac
        00401404 8b 45 f4        MOV        EAX,dword ptr [EBP + local_10]
        00401407 33 c7           XOR        EAX,EDI
        00401409 03 c6           ADD        EAX,ESI
        0040140b eb 1b           JMP        LAB_00401428
                             LAB_0040140d                                    XREF[1]:     004012fd(j)
        0040140d a1 9c 00        MOV        EAX,[->SHLWAPI.DLL::Ordinal_14]                  = 8000000e
                 42 00
        00401412 89 45 08        MOV        dword ptr [EBP + param_1],EAX
        00401415 81 fa 07        CMP        EDX,0xf0e7a107
                 a1 e7 f0
        0040141b 8b 45 f4        MOV        EAX,dword ptr [EBP + local_10]
        0040141e 35 21 e3        XOR        EAX,0x2e321
                 02 00
        00401423 05 21 b7        ADD        EAX,0xab721
                 0a 00
                             LAB_00401428                                    XREF[2]:     00401345(j), 0040140b(j)
        00401428 5f              POP        EDI
        00401429 5e              POP        ESI
        0040142a 5b              POP        EBX
        0040142b c9              LEAVE
        0040142c c2 04 00        RET        0x4
```
