
# FUN_0040166b

Esta FUN_0040166b(param_1, param_2) tiene tres bloques claros y todos encajan con el “estilo Zeus/loader” que ya vienes mostrando: delay/anti-emulación, resolución ofuscada de APIs, y validación/transformación de un “token/valor” usando tablas y bytes.

Importante: aunque Ghidra la tipa como int __stdcall (undefined4,int), por el RET 0x8 al final sí son 2 parámetros (8 bytes). Aquí el prototipo cuadra.

1) Bloque A (0040166b–00401773): bucle de espera/anti-emulación + llamada API ofuscada

Arranca leyendo un puntero importado PathMakeSystemFolderA, pero lo convierte en basura (lo sobreescribe con aritmética en local_10). Esto es típico de “noise”.

Construye local_8 a partir de constantes + un DIV y luego entra en un bucle LAB_004016d6:


Qué es realmente:

Es un delay determinista (consume CPU) y a la vez una trampa anti-emulación (en emuladores/sandboxes el tiempo o el estado puede variar y la salida del bucle cambia).

En medio, resuelve un puntero a función con SHLWAPI Ordinal_29 + delta y hace:


2) Bloque B (00401773–0040187e): lazy-init de API + más delay

Aquí aparece un patrón ya visto:

Cache de API con bitmask global

Interpretación:

GetSysColor es un ancla “benigna”. El malware la usa para:

tener una import “normal”,

y luego moverse por memoria (sumarle un delta) para acabar en otra rutina (o para romper firmas).

Después de esa llamada, vuelve a calcular local_8 y entra en otro bucle LAB_00401819 que es otra espera/anti-emulación.

Dentro de ese bucle también resuelve/calla a GetConsoleAliasExesLengthW pero sumándole un delta (otra vez API-ofuscación).


3) Bloque C (0040187e–fin): check de integridad / “token match” y post-procesado por bytes

Aquí cambia el objetivo: usa 4 dwords inicializados a valores “sentinel”:

local_24 = 0xFF3FFFE1

local_20 = 0xFFFFFFFF

local_2c = 0xFF3FFF9E

local_28 = 0xFFFFFFFF

Y calcula un producto “firma”:
```
EAX = (local_24 XOR ESI) + ECX
EDX = (local_2c XOR ESI) + ECX
EAX = EAX * EDX
CMP param_2, EAX
```

➡️ Esto es un comparador tipo “cookie/checksum”: si param_2 coincide con el valor derivado del estado, entra en la rama “OK”; si no, entra en la rama “fallback”.

Rama OK (match)

Escribe/transforma solo el byte alto (+0x3) de param_2:
```
[param_2+3] = 0x1e
AL = [param_2+3]
AL = (AL - 0x74 + DAT_0040eab4) & 0x84
AL += 0xB7
[param_2+3] = AL
```


Luego entra en un bucle LAB_004018c7 que:

mezcla bytes constantes (DAT_0040eab6, ...b5, ...b0, etc.),

escribe un byte en [param_1+3],

vuelve a ajustar [param_2+3],

y repite hasta que [param_2+3] sea ≥ a un umbral derivado de AL.

Interpretación: rama “OK” parece derivar 1 byte de salida (en param_1+3) y ajustar un byte estado en param_2+3. Esto huele a:

“marcador”/flag de validación,

o un mini-KDF/byte-key para la siguiente etapa.


----------------

Rama fallback (no match)

Trata param_2 como puntero y hace un lookup con un offset ofuscado:
```
EAX = (0xFFF7ABFE XOR 0x2E321)
EAX = EAX*8 + 0x55B980
param_2 = *( (uint8*)param_2 + EAX )
```
Es decir: redirecciona param_2 a un valor leído de memoria.

Luego repite el cálculo de la “firma” y vuelve a comparar; si no cuadra, entra en un bloque con LOOP y, crucialmente, aparece un tramo que el desensamblador muestra como instrucciones basura/ilegibles (PUSHAD, OUTSD, secuencias ASCII-like como “Jzn…” etc.).

Ese tramo (004019d7 en adelante) es muy típico de:

junk bytes embebidos como datos para romper el disassembly lineal,

o opaque control-flow donde el camino real nunca ejecuta esas “instrucciones” y en runtime son datos/constantes.

--------------

Lectura “alta” (qué hace en el malware)

Antes: gasta tiempo y complica emulación (dos bucles de espera con divisiones y shifts).

Durante: inicializa/cacha APIs y llama a punteros “derivados” (anti-IAT / anti-firma).

Después: valida param_2 contra una firma; si coincide, produce un byte de salida en param_1+3 y ajusta un byte estado en param_2+3; si no coincide, reinterpreta param_2 como puntero y busca otro valor, repitiendo la validación. Si sigue sin cuadrar, cae en basura anti-disassembly.



```
                             **************************************************************
                             *                          FUNCTION                          *
                             **************************************************************
                             int __stdcall FUN_0040166b(undefined4 param_1, int param
                               assume FS_OFFSET = 0xffdff000
             int               EAX:4          <RETURN>
             undefined4        Stack[0x4]:4   param_1                                 XREF[0,1]:   004018dc(W)  
             int               Stack[0x8]:4   param_2                                 XREF[3,6]:   0040189f(R), 
                                                                                                   00401929(R), 
                                                                                                   0040193b(W), 
                                                                                                   004018a6(W), 
                                                                                                   004018aa(R), 
                                                                                                   004018c2(W), 
                                                                                                   004018f0(R), 
                                                                                                   004018f6(W), 
                                                                                                   00401910(R)  
             undefined4        Stack[-0x8]:4  local_8                                 XREF[10]:    00401687(W), 
                                                                                                   00401698(R), 
                                                                                                   004016d3(W), 
                                                                                                   004016e9(R), 
                                                                                                   0040174d(RW), 
                                                                                                   00401761(R), 
                                                                                                   00401816(W), 
                                                                                                   0040181e(R), 
                                                                                                   00401867(RW), 
                                                                                                   0040186f(R)  
             undefined4        Stack[-0xc]:4  local_c                                 XREF[9]:     0040168e(W), 
                                                                                                   00401695(R), 
                                                                                                   004016fc(W), 
                                                                                                   0040170c(R), 
                                                                                                   00401718(W), 
                                                                                                   0040171b(R), 
                                                                                                   00401832(W), 
                                                                                                   00401844(RW), 
                                                                                                   00401847(R)  
             undefined4        Stack[-0x10]:4 local_10                                XREF[5]:     00401676(W), 
                                                                                                   004016ac(W), 
                                                                                                   00401722(R), 
                                                                                                   004017b6(W), 
                                                                                                   004017b9(R)  
             undefined4        Stack[-0x14]:4 local_14                                XREF[2]:     004017f0(W), 
                                                                                                   004017f3(R)  
             undefined4        Stack[-0x18]:4 local_18                                XREF[2]:     0040191f(W), 
                                                                                                   00401926(R)  
             undefined4        Stack[-0x20]:4 local_20                                XREF[3]:     00401781(W), 
                                                                                                   00401881(R), 
                                                                                                   00401a45(R)  
             undefined4        Stack[-0x24]:4 local_24                                XREF[4]:     0040177a(W), 
                                                                                                   0040187e(R), 
                                                                                                   004019f5(*), 
                                                                                                   00401a42(R)  
             undefined4        Stack[-0x28]:4 local_28                                XREF[3]:     00401680(W), 
                                                                                                   00401887(R), 
                                                                                                   00401a4b(R)  
             undefined4        Stack[-0x2c]:4 local_2c                                XREF[3]:     00401679(W), 
                                                                                                   00401884(R), 
                                                                                                   00401a48(R)  
                             FUN_0040166b                                    XREF[1]:     FUN_0040592c:00405d29(c)  
        0040166b 55              PUSH       EBP
        0040166c 8b ec           MOV        EBP,ESP
        0040166e 83 ec 28        SUB        ESP,0x28
        00401671 a1 88 00        MOV        EAX,[->SHLWAPI.DLL::PathMakeSystemFolderA]       = 000203be
                 42 00
        00401676 89 45 f4        MOV        dword ptr [EBP + local_10],EAX
        00401679 c7 45 d8        MOV        dword ptr [EBP + local_2c],0xff3fff9e
                 9e ff 3f ff
        00401680 c7 45 dc        MOV        dword ptr [EBP + local_28],0xffffffff
                 ff ff ff ff
        00401687 c7 45 fc        MOV        dword ptr [EBP + local_8],0x7075
                 75 70 00 00
        0040168e c7 45 f8        MOV        dword ptr [EBP + local_c],0x6e3d
                 3d 6e 00 00
        00401695 8b 45 f8        MOV        EAX,dword ptr [EBP + local_c]
        00401698 8b 4d fc        MOV        ECX,dword ptr [EBP + local_8]
        0040169b 35 bf dd        XOR        EAX,0xffffddbf
                 ff ff
        004016a0 25 53 7a        AND        EAX,0x7a53
                 00 00
        004016a5 2b c1           SUB        EAX,ECX
        004016a7 05 74 3e        ADD        EAX,0x3e74
                 00 00
        004016ac 89 45 f4        MOV        dword ptr [EBP + local_10],EAX
        004016af a1 74 ea        MOV        EAX,[DAT_0040ea74]                               = 00004AFDh
                 40 00
        004016b4 33 d2           XOR        EDX,EDX
        004016b6 b9 40 0a        MOV        ECX,0xa40
                 00 00
        004016bb f7 f1           DIV        ECX
        004016bd 56              PUSH       ESI
        004016be b8 b7 26        MOV        EAX,0xc1426b7
                 14 0c
        004016c3 57              PUSH       EDI
        004016c4 bf c5 20        MOV        EDI,0x20c5
                 00 00
        004016c9 be 16 9f        MOV        ESI,0xce89f16
                 e8 0c
        004016ce c1 ea 07        SHR        EDX,0x7
        004016d1 2b c2           SUB        EAX,EDX
        004016d3 89 45 fc        MOV        dword ptr [EBP + local_8],EAX
                             LAB_004016d6                                    XREF[1]:     0040176d(j)  
        004016d6 a1 70 ea        MOV        EAX,[DAT_0040ea70]                               = 00005001h
                 40 00
        004016db 8b 0d 6c        MOV        ECX,dword ptr [DAT_0040ea6c]                     = 00002CDFh
                 ea 40 00
        004016e1 33 c1           XOR        EAX,ECX
        004016e3 33 d2           XOR        EDX,EDX
        004016e5 8b cf           MOV        ECX,EDI
        004016e7 f7 f1           DIV        ECX
        004016e9 8b 4d fc        MOV        ECX,dword ptr [EBP + local_8]
        004016ec 8b c6           MOV        EAX,ESI
        004016ee c1 e2 0b        SHL        EDX,0xb
        004016f1 2b c2           SUB        EAX,EDX
        004016f3 3b c8           CMP        ECX,EAX
        004016f5 77 7c           JA         LAB_00401773
        004016f7 a1 b8 00        MOV        EAX,[->SHLWAPI.DLL::Ordinal_29]                  = 8000001d
                 42 00
        004016fc 89 45 f8        MOV        dword ptr [EBP + local_c],EAX
        004016ff a1 7c ea        MOV        EAX,[DAT_0040ea7c]                               = 000069D1h
                 40 00
        00401704 8b 0d 78        MOV        ECX,dword ptr [DAT_0040ea78]                     = 000043C9h
                 ea 40 00
        0040170a 33 c1           XOR        EAX,ECX
        0040170c 8b 4d f8        MOV        ECX,dword ptr [EBP + local_c]
        0040170f 25 fc 11        AND        EAX,0x11fc
                 00 00
        00401714 8d 44 01 e8     LEA        EAX,[ECX + EAX*0x1 + -0x18]
        00401718 89 45 f8        MOV        dword ptr [EBP + local_c],EAX
        0040171b 8b 45 f8        MOV        EAX,dword ptr [EBP + local_c]
        0040171e 6a 7a           PUSH       0x7a
        00401720 ff d0           CALL       EAX
        00401722 8b 45 f4        MOV        EAX,dword ptr [EBP + local_10]
        00401725 8a 0c 85        MOV        CL,byte ptr [EAX*0x4 + 0x40ea5c]=>DAT_0040ea60   = 01h
                 5c ea 40 00
        0040172c a1 58 ea        MOV        EAX,[DAT_0040ea58]                               = 00005977h
                 40 00
        00401731 d3 e8           SHR        EAX,CL
        00401733 33 d2           XOR        EDX,EDX
        00401735 b9 86 4d        MOV        ECX,0x4d86
                 00 00
        0040173a f7 f1           DIV        ECX
        0040173c b9 0a 5d        MOV        ECX,0x5d0a
                 00 00
        00401741 8d 82 4f        LEA        EAX,[EDX + 0x304f]
                 30 00 00
        00401747 33 d2           XOR        EDX,EDX
        00401749 f7 f1           DIV        ECX
        0040174b 33 d2           XOR        EDX,EDX
        0040174d 01 45 fc        ADD        dword ptr [EBP + local_8],EAX
        00401750 a1 70 ea        MOV        EAX,[DAT_0040ea70]                               = 00005001h
                 40 00
        00401755 8b 0d 6c        MOV        ECX,dword ptr [DAT_0040ea6c]                     = 00002CDFh
                 ea 40 00
        0040175b 33 c1           XOR        EAX,ECX
        0040175d 8b cf           MOV        ECX,EDI
        0040175f f7 f1           DIV        ECX
        00401761 8b 4d fc        MOV        ECX,dword ptr [EBP + local_8]
        00401764 8b c6           MOV        EAX,ESI
        00401766 c1 e2 0b        SHL        EDX,0xb
        00401769 2b c2           SUB        EAX,EDX
        0040176b 3b c8           CMP        ECX,EAX
        0040176d 0f 86 63        JBE        LAB_004016d6
                 ff ff ff
                             LAB_00401773                                    XREF[1]:     004016f5(j)  
        00401773 f6 05 78        TEST       byte ptr [DAT_00410b78],0x1
                 0b 41 00 01
        0040177a c7 45 e0        MOV        dword ptr [EBP + local_24],0xff3fffe1
                 e1 ff 3f ff
        00401781 c7 45 e4        MOV        dword ptr [EBP + local_20],0xffffffff
                 ff ff ff ff
        00401788 75 11           JNZ        LAB_0040179b
        0040178a a1 e8 00        MOV        EAX,[->USER32.DLL::GetSysColor]                  = 000206f8
                 42 00
        0040178f 83 0d 78        OR         dword ptr [DAT_00410b78],0x1
                 0b 41 00 01
        00401796 a3 5c 06        MOV        [DAT_0041065c],EAX
                 41 00
                             LAB_0040179b                                    XREF[1]:     00401788(j)  
        0040179b a1 84 ea        MOV        EAX,[DAT_0040ea84]                               = 000045B2h
                 40 00
        004017a0 33 d2           XOR        EDX,EDX
        004017a2 6a 13           PUSH       0x13
        004017a4 59              POP        ECX
        004017a5 f7 f1           DIV        ECX
        004017a7 8b 0d 80        MOV        ECX,dword ptr [DAT_0040ea80]                     = 000031C6h
                 ea 40 00
        004017ad 33 d2           XOR        EDX,EDX
        004017af 2b c1           SUB        EAX,ECX
        004017b1 35 e5 d1        XOR        EAX,0xffffd1e5
                 ff ff
        004017b6 89 45 f4        MOV        dword ptr [EBP + local_10],EAX
        004017b9 8b 45 f4        MOV        EAX,dword ptr [EBP + local_10]
        004017bc 8b 04 85        MOV        EAX,dword ptr [EAX*0x4 + DAT_0040ea88]           = 3Dh    =
                 88 ea 40 00
        004017c3 05 1a 0c        ADD        EAX,0xc1a
                 00 00
        004017c8 b9 50 21        MOV        ECX,0x2150
                 00 00
        004017cd f7 f1           DIV        ECX
        004017cf a1 94 ea        MOV        EAX,[DAT_0040ea94]                               = 00002A60h
                 40 00
        004017d4 25 0d 1a        AND        EAX,0x1a0d
                 00 00
        004017d9 69 c0 0d        IMUL       EAX,EAX,0x540d
                 54 00 00
        004017df 05 50 b7        ADD        EAX,0x41aab750
                 aa 41
        004017e4 81 f2 b7        XOR        EDX,0x13b7
                 13 00 00
        004017ea 01 15 5c        ADD        dword ptr [DAT_0041065c],EDX
                 06 41 00
        004017f0 89 45 f0        MOV        dword ptr [EBP + local_14],EAX
        004017f3 ff 75 f0        PUSH       dword ptr [EBP + local_14]
        004017f6 a1 5c 06        MOV        EAX,[DAT_0041065c]
                 41 00
        004017fb ff d0           CALL       EAX
        004017fd a1 a8 ea        MOV        EAX,[DAT_0040eaa8]                               = 000006D9h
                 40 00
        00401802 0d 4d 62        OR         EAX,0x624d
                 00 00
        00401807 33 d2           XOR        EDX,EDX
        00401809 b9 d7 72        MOV        ECX,0x72d7
                 00 00
        0040180e f7 f1           DIV        ECX
        00401810 81 c2 85        ADD        EDX,0x6123d385
                 d3 23 61
        00401816 89 55 fc        MOV        dword ptr [EBP + local_8],EDX
                             LAB_00401819                                    XREF[1]:     0040187c(j)  
        00401819 a1 a4 ea        MOV        EAX,[DAT_0040eaa4]                               = 00005E8Ah
                 40 00
        0040181e 8b 4d fc        MOV        ECX,dword ptr [EBP + local_8]
        00401821 c1 e0 16        SHL        EAX,0x16
        00401824 05 f1 3a        ADD        EAX,0xbea43af1
                 a4 be
        00401829 3b c8           CMP        ECX,EAX
        0040182b 73 51           JNC        LAB_0040187e
        0040182d a1 30 00        MOV        EAX,[->KERNEL32.DLL::GetConsoleAliasExesLengthW] = 00020548
                 42 00
        00401832 89 45 f8        MOV        dword ptr [EBP + local_c],EAX
        00401835 a1 ac ea        MOV        EAX,[DAT_0040eaac]                               = 0000007Bh
                 40 00
        0040183a 0d d7 60        OR         EAX,0x60d7
                 00 00
        0040183f 35 ff 60        XOR        EAX,0x60ff
                 00 00
        00401844 01 45 f8        ADD        dword ptr [EBP + local_c],EAX
        00401847 8b 45 f8        MOV        EAX,dword ptr [EBP + local_c]
        0040184a ff d0           CALL       EAX
        0040184c a1 a0 ea        MOV        EAX,[DAT_0040eaa0]                               = 00004F7Fh
                 40 00
        00401851 8b 0d 9c        MOV        ECX,dword ptr [DAT_0040ea9c]                     = 00003315h
                 ea 40 00
        00401857 0f af c1        IMUL       EAX,ECX
        0040185a 8b 0d 98        MOV        ECX,dword ptr [DAT_0040ea98]                     = 000010DFh
                 ea 40 00
        00401860 05 b7 1c        ADD        EAX,0xf0231cb7
                 23 f0
        00401865 03 c1           ADD        EAX,ECX
        00401867 01 45 fc        ADD        dword ptr [EBP + local_8],EAX
        0040186a a1 a4 ea        MOV        EAX,[DAT_0040eaa4]                               = 00005E8Ah
                 40 00
        0040186f 8b 4d fc        MOV        ECX,dword ptr [EBP + local_8]
        00401872 c1 e0 16        SHL        EAX,0x16
        00401875 05 f1 3a        ADD        EAX,0xbea43af1
                 a4 be
        0040187a 3b c8           CMP        ECX,EAX
        0040187c 72 9b           JC         LAB_00401819
                             LAB_0040187e                                    XREF[1]:     0040182b(j)  
        0040187e 8b 45 e0        MOV        EAX,dword ptr [EBP + local_24]
        00401881 8b 4d e4        MOV        ECX,dword ptr [EBP + local_20]
        00401884 8b 55 d8        MOV        EDX,dword ptr [EBP + local_2c]
        00401887 8b 7d dc        MOV        EDI,dword ptr [EBP + local_28]
        0040188a be 21 62        MOV        ESI,0x3126221
                 12 03
        0040188f 33 c6           XOR        EAX,ESI
        00401891 33 d6           XOR        EDX,ESI
        00401893 b9 41 62        MOV        ECX,0x3d26241
                 d2 03
        00401898 03 d1           ADD        EDX,ECX
        0040189a 03 c1           ADD        EAX,ECX
        0040189c 0f af c2        IMUL       EAX,EDX
        0040189f 8b 55 0c        MOV        EDX,dword ptr [EBP + param_2]
        004018a2 3b d0           CMP        EDX,EAX
        004018a4 75 78           JNZ        LAB_0040191e
        004018a6 c6 45 0f 1e     MOV        byte ptr [EBP + param_2+0x3],0x1e
        004018aa 0f b6 45 0f     MOVZX      EAX,byte ptr [EBP + param_2+0x3]
        004018ae 8a 15 b4        MOV        DL,byte ptr [DAT_0040eab4]                       = 9Ch
                 ea 40 00
        004018b4 2c 74           SUB        AL,0x74
        004018b6 02 c2           ADD        AL,DL
        004018b8 25 84 00        AND        EAX,0x84
                 00 00
        004018bd 05 b7 00        ADD        EAX,0xb7
                 00 00
        004018c2 88 45 0f        MOV        byte ptr [EBP + param_2+0x3],AL
        004018c5 eb 32           JMP        LAB_004018f9
                             LAB_004018c7                                    XREF[1]:     00401917(j)  
        004018c7 a0 b6 ea        MOV        AL,[DAT_0040eab6]                                = A5h
                 40 00
        004018cc b2 d6           MOV        DL,0xd6
        004018ce f6 ea           IMUL       DL
        004018d0 0f b6 15        MOVZX      EDX,byte ptr [DAT_0040eab5]                      = 8Bh
                 b5 ea 40 00
        004018d7 0f b6 c0        MOVZX      EAX,AL
        004018da 0b d0           OR         EDX,EAX
        004018dc 88 55 0b        MOV        byte ptr [EBP + param_1+0x3],DL
        004018df a0 b0 ea        MOV        AL,[DAT_0040eab0]                                = 63h
                 40 00
        004018e4 24 fd           AND        AL,0xfd
        004018e6 c0 e0 05        SHL        AL,0x5
        004018e9 b2 21           MOV        DL,0x21
        004018eb 2a d0           SUB        DL,AL
        004018ed 0f b6 c2        MOVZX      EAX,DL
        004018f0 0f b6 55 0f     MOVZX      EDX,byte ptr [EBP + param_2+0x3]
        004018f4 03 d0           ADD        EDX,EAX
        004018f6 88 55 0f        MOV        byte ptr [EBP + param_2+0x3],DL
                             LAB_004018f9                                    XREF[1]:     004018c5(j)  
        004018f9 8a 15 b3        MOV        DL,byte ptr [DAT_0040eab3]                       = 31h
                 ea 40 00
        004018ff a0 b2 ea        MOV        AL,[DAT_0040eab2]                                = 8Fh
                 40 00
        00401904 0a d0           OR         DL,AL
        00401906 a0 b1 ea        MOV        AL,[DAT_0040eab1]                                = 73h
                 40 00
        0040190b 80 e2 61        AND        DL,0x61
        0040190e f6 ea           IMUL       DL
        00401910 8a 55 0f        MOV        DL,byte ptr [EBP + param_2+0x3]
        00401913 34 1f           XOR        AL,0x1f
        00401915 3a d0           CMP        DL,AL
        00401917 72 ae           JC         LAB_004018c7
        00401919 e9 24 01        JMP        LAB_00401a42
                 00 00
                             LAB_0040191e                                    XREF[1]:     004018a4(j)  
        0040191e 42              INC        EDX
        0040191f c7 45 ec        MOV        dword ptr [EBP + local_18],0xfff7abfe
                 fe ab f7 ff
        00401926 8b 45 ec        MOV        EAX,dword ptr [EBP + local_18]
        00401929 8b 55 0c        MOV        EDX,dword ptr [EBP + param_2]
        0040192c 35 21 e3        XOR        EAX,0x2e321
                 02 00
        00401931 8d 04 c5        LEA        EAX,[EAX*0x8 + 0x55b980]
                 80 b9 55 00
        00401938 8b 04 02        MOV        EAX,dword ptr [EDX + EAX*0x1]
        0040193b 89 45 0c        MOV        dword ptr [EBP + param_2],EAX
        0040193e 0f bd c3        BSR        EAX,EBX
        00401941 8b 45 e0        MOV        EAX,dword ptr [EBP + -0x20]
        00401944 8b 55 e4        MOV        EDX,dword ptr [EBP + -0x1c]
        00401947 8b 55 d8        MOV        EDX,dword ptr [EBP + -0x28]
        0040194a 8b 7d dc        MOV        EDI,dword ptr [EBP + -0x24]
        0040194d 33 c6           XOR        EAX,ESI
        0040194f 33 d6           XOR        EDX,ESI
        00401951 03 d1           ADD        EDX,ECX
        00401953 03 c1           ADD        EAX,ECX
        00401955 0f af c2        IMUL       EAX,EDX
        00401958 8b 55 0c        MOV        EDX,dword ptr [EBP + 0xc]
        0040195b 3b d0           CMP        EDX,EAX
                             LAB_0040195d                                    XREF[1]:     004019d3(j)  
        0040195d 0f 84 db        JZ         LAB_00401a3e
                 00 00 00
        00401963 a1 64 00        MOV        EAX,[->KERNEL32.DLL::HeapFree]                   = 00020488
                 42 00
        00401968 89 45 f4        MOV        dword ptr [EBP + -0xc],EAX
        0040196b 8b 45 e0        MOV        EAX,dword ptr [EBP + -0x20]
        0040196e 8b 55 e4        MOV        EDX,dword ptr [EBP + -0x1c]
        00401971 33 c6           XOR        EAX,ESI
        00401973 03 c1           ADD        EAX,ECX
        00401975 8b 4d 0c        MOV        ECX,dword ptr [EBP + 0xc]
        00401978 0f af c1        IMUL       EAX,ECX
        0040197b 03 45 08        ADD        EAX,dword ptr [EBP + 0x8]
        0040197e 89 45 f4        MOV        dword ptr [EBP + -0xc],EAX
        00401981 f7 d9           NEG        ECX
        00401983 a1 bc ea        MOV        EAX,[DAT_0040eabc]                               = 00003788h
                 40 00
        00401988 8b 0d b8        MOV        ECX,dword ptr [DAT_0040eab8]                     = 00006303h
                 ea 40 00
        0040198e c1 e0 1a        SHL        EAX,0x1a
        00401991 0f af c8        IMUL       ECX,EAX
        00401994 81 f1 03        XOR        ECX,0x60000003
                 00 00 60
        0040199a 89 4d 08        MOV        dword ptr [EBP + 0x8],ECX
        0040199d c6 45 0f 7a     MOV        byte ptr [EBP + 0xf],0x7a
        004019a1 8b 45 08        MOV        EAX,dword ptr [EBP + 0x8]
        004019a4 8a 80 c0        MOV        AL,byte ptr [EAX + 0x40eac0]=>DAT_0040eac3       = 27h
                 ea 40 00
        004019aa 0f b6 4d 0f     MOVZX      ECX,byte ptr [EBP + 0xf]
        004019ae 0f b6 c0        MOVZX      EAX,AL
        004019b1 d1 e9           SHR        ECX,0x1
        004019b3 83 e1 66        AND        ECX,0x66
        004019b6 2b c8           SUB        ECX,EAX
        004019b8 88 4d 0f        MOV        byte ptr [EBP + 0xf],CL
        004019bb a0 c6 ea        MOV        AL,[DAT_0040eac6]                                = 0Eh
                 40 00
        004019c0 8a 0d c5        MOV        CL,byte ptr [DAT_0040eac5]                       = 13h
                 ea 40 00
        004019c6 24 bd           AND        AL,0xbd
        004019c8 04 5a           ADD        AL,0x5a
        004019ca 0a c8           OR         CL,AL
        004019cc 8a 45 0f        MOV        AL,byte ptr [EBP + 0xf]
        004019cf 3a c1           CMP        AL,CL
        004019d1 77 66           JA         LAB_00401a39
        004019d3 e2 88           LOOP       LAB_0040195d
        004019d5 73 2a           JNC        LAB_00401a01
        004019d7 b9 42 1b        MOV        ECX,0x46d31b42
                 d3 46
        004019dc 0d 5c d9        OR         EAX,0x9a62d95c
                 62 9a
        004019e1 4a              DEC        EDX
        004019e2 23 00           AND        EAX=>DAT_9a62d9fd,dword ptr [EAX]
        004019e4 00 00           ADD        byte ptr [EAX],AL
        004019e6 00 4a 00        ADD        byte ptr [EDX],CL
        004019e9 00 00           ADD        byte ptr [EAX],AL
        004019eb 60              PUSHAD
        004019ec 00 3d 23        ADD        byte ptr [DAT_77454e23],BH
                 4e 45 77
        004019f2 31 7a 55        XOR        dword ptr [EDX + 0x55],EDI
        004019f5 54              PUSH       ESP=>local_24
        004019f6 4d              DEC        EBP
        004019f7 4e              DEC        ESI
        004019f8 4e              DEC        ESI
        004019f9 4f              DEC        EDI
        004019fa 4e              DEC        ESI
        004019fb 76 4a           JBE        LAB_00401a45+2
        004019fd 32 4e 52        XOR        CL,byte ptr [ESI + 0x52]
        00401a00 6f              OUTSD      DX,ESI
                             LAB_00401a01                                    XREF[1]:     004019d5(j)  
        00401a01 2b 4f 6a        SUB        ECX,dword ptr [EDI + 0x6a]
        00401a04 4a              DEC        EDX
        00401a05 7a 6e           JP         LAB_00401a74+1
        00401a07 64 6f           OUTSD      DX,FS:ESI
        00401a09 34 64           XOR        AL,0x64
        00401a0b 6a 51           PUSH       0x51
        00401a0d 65 59           POP        ECX
        00401a0f 6f              OUTSD      DX,ESI
        00401a10 4a              DEC        EDX
        00401a11 6c              INSB       ES:EDI,DX
        00401a12 55              PUSH       EBP
        00401a13 6f              OUTSD      DX,ESI
        00401a14 71 69           JNO        LAB_00401a7e+1
        00401a16 51              PUSH       ECX
        00401a17 65 4a           DEC        EDX
        00401a19 33 67 79        XOR        ESP,dword ptr [EDI + 0x79]
        00401a1c 4b              DEC        EBX
        00401a1d 38 52 70        CMP        byte ptr [EDX + 0x70],DL
        00401a20 71 52           JNO        LAB_00401a74
        00401a22 51              PUSH       ECX
        00401a23 39 47 79        CMP        dword ptr [EDI + 0x79],EAX
        00401a26 57              PUSH       EDI
        00401a27 44              INC        ESP
        00401a28 44              INC        ESP
        00401a29 7a 65           JP         LAB_00401a8d+3
        00401a2b 74 6f           JZ         LAB_00401a9b+1
        00401a2d 6c              INSB       ES:EDI,DX
        00401a2e 6d              INSD       ES:EDI,DX
        00401a2f 6e              OUTSB      DX,ESI
        00401a30 52              PUSH       EDX
        00401a31 37              AAA
        00401a32 74 4c           JZ         LAB_00401a7e+2
        00401a34 53              PUSH       EBX
        00401a35 4d              DEC        EBP
        00401a36 37              AAA
        00401a37 53              PUSH       EBX
        00401a38 4c              DEC        ESP
                             LAB_00401a39                                    XREF[1]:     004019d1(j)  
        00401a39 8b 45 f4        MOV        EAX,dword ptr [EBP + -0xc]
        00401a3c eb 1b           JMP        LAB_00401a59
                             LAB_00401a3e                                    XREF[1]:     0040195d(j)  
        00401a3e 0f ac c8 13     SHRD       EAX,ECX,0x13
                             LAB_00401a42                                    XREF[1]:     00401919(j)  
        00401a42 8b 45 e0        MOV        EAX,dword ptr [EBP + local_24]
                             LAB_00401a45+2                                  XREF[0,1]:   004019fb(j)  
        00401a45 8b 55 e4        MOV        EDX,dword ptr [EBP + local_20]
        00401a48 8b 55 d8        MOV        EDX,dword ptr [EBP + local_2c]
        00401a4b 8b 7d dc        MOV        EDI,dword ptr [EBP + local_28]
        00401a4e 33 d6           XOR        EDX,ESI
        00401a50 33 c6           XOR        EAX,ESI
        00401a52 03 d1           ADD        EDX,ECX
        00401a54 03 c1           ADD        EAX,ECX
        00401a56 0f af c2        IMUL       EAX,EDX
                             LAB_00401a59                                    XREF[1]:     00401a3c(j)  
        00401a59 5f              POP        EDI
        00401a5a 5e              POP        ESI
        00401a5b c9              LEAVE
        00401a5c c2 08 00        RET        0x8
``` 