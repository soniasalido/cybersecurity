# Antecedentes
La aplicación VUPLAYER, un reproductor de audio de windows que en su version 2.49 incorpora un desbordamiento de buffer de stack. Este problema se producía en la rutina encargada de procesar una lista de reproducción cargada desde un fichero `M3Y`. 

Si el fichero M3U contiene una línea con un tamaño superior a 1000 bytes, el contenido de la pila comienza a ser sobrescrito, lo que permitiría a un atacante sobreescribir la dirección de retorno si continua sobreescribiendo hasta ella. Este ejemplo es simple y al mismo tiempo nos permite ver lo peligroso que puede ser una vulnerabilidad de este tipo, ya que un usuario pensaría que no hay peligro al cargar una lista de reproducción en un reproductor, sin embargo, la existencia de esta vulnerabilidad permite que un atacante pueda acabar ejecutando código malicioso en el sistema.


Los fallos están documentados en CVE (por ejemplo CVE-2009-0174 y CVE-2009-0182) y hay entradas en NVD / bases de vulnerabilidades y repositorios de exploits. También se han publicado pruebas de concepto y exploits en Exploit-DB y mirrors: https://nvd.nist.gov/vuln/detail/CVE-2009-0174

Si un usuario abre un fichero malicioso con VUPlayer vulnerable, un atacante puede lograr ejecución remota de código en el contexto del usuario (es decir, controlar el proceso y potencialmente ejecutar payloads). Dependiendo del sistema y privilegios, el impacto puede ser alto. Hay ejemplos públicos que abordan técnicas para saltarse DEP/ASLR en entornos antiguos.

Exploits públicos - weaponized: existen exploits y writeups públicos (Exploit-DB, PacketStorm, blogs técnicos) que muestran generación de ficheros maliciosos y técnicas de explotación, incluidos intentos de bypass de protecciones modernas en sistemas antiguos: https://www.exploit-db.com/exploits/40172

Si confeccionamos un fichero M3U con una línea que contenga 1.016 A, podremos ver que efectivamente somos capaces de sobreescribir tanto EBP como la dirección de retorno (EIP).


# Análisis estático del binario VUPlayer
Descargamos el instalador de la aplicación e instalamos el programa. El binario queda en `C:\Program Files (x86)\VUPlayer\vuplayer.exe`. Copiamos este binario a una carpeta para realizar un análisis del mismo.


Analizamos el binario en Ghidra/IDA para localizar la rutina que parsea .asx/.pls/.m3u. Identificaremos cómo procesa cadenas el binario y detectaremos dónde hay gestión insuficiente de longitud.

## Buscamos strings para buscar pistas
Buscamos en strings cualquier literal relacionado con playlists o tags, por ejemplo:
- .asx, .pls, .m3u, .wax
- File=, Title=, HREF=, Ref=, URL=, o extensiones .asf/.asx
Cuando localicemos una string relevante, miramos sus Xrefs (referencias) para encontrar las funciones que la usan. En IDA: selecciona string → X o botón “Show xrefs to”. En Ghidra: clic derecho → References → Show References To.

``` 
DEFINED	0051fef0	s_NAME=_0051fef0	ds "NAME="	"NAME="	string	6	true
DEFINED	0051ff00	s_*.vpl;*.m3u;*.pls;*.asx;*.wax;*._0051ff00	ds "*.vpl;*.m3u;*.pls;*.asx;*.wax;*.cue"	"*.vpl;*.m3u;*.pls;*.asx;*.wax;*.cue"	string	36	false
DEFINED	0051ff24	s_(*.vpl;*.m3u;*.pls;*.asx;*.wax;*_0051ff24	ds " (*.vpl;*.m3u;*.pls;*.asx;*.wax;*.cue)"	" (*.vpl;*.m3u;*.pls;*.asx;*.wax;*.cue)"	string	39	false
DEFINED	0051ff4c	s_*.m3u_0051ff4c	ds "*.m3u"	"*.m3u"	string	6	false
DEFINED	0051ff54	s_(*.m3u)_0051ff54	ds " (*.m3u)"	" (*.m3u)"	string	9	false
DEFINED	0051ff60	s_*.vpl_0051ff60	ds "*.vpl"	"*.vpl"	string	6	false
DEFINED	0051ff68	s_(*.vpl)_0051ff68	ds " (*.vpl)"	" (*.vpl)"	string	9	false
DEFINED	0051ff78	s_CPlayerView_0051ff78	ds "CPlayerView"	"CPlayerView"	string	12	true

```

